"use strict";(self.webpackChunkkontokorrent=self.webpackChunkkontokorrent||[]).push([[502],{4502:function(t,e,n){n.r(e),n.d(e,{Login:function(){return c}}),n(3948),n(285);var i=n(9773),s=n(2204),o=n(2887),r=(n(4227),n(1480),n(6604)),a=n(6047);n(2545);class c extends HTMLElement{constructor(){super(),this.rendered=!1}addServices(t){this.store=t.store,this.routingActionCreator=(0,i.b)(t),this.accountActionCreator=(0,o.gg)(t),this.kontokorrentHinzufuegenActionCreator=(0,r.Jj)(t)}connectedCallback(){if(!this.rendered){this.rendered=!0,this.innerHTML='<div class="login-error-box"> <div id="eventMissingError" class="alert alert--error" style="display:none">Kontokorrentnamen eingeben</div> <div id="notFoundError" class="alert alert--error" style="display:none">Kontokorrent wurde nicht gefunden</div> <div id="account-creation-failed" class="alert alert--error" style="display:none">Account konnte nicht erstellt werden</div> </div> <div class="login-box" id="login-box"> <div class="login-box__event-input"> <input type="text" id="eventInput" placeholder="Kontokorrentname"> <tip-button popup-id="oeffentlicherNameExplainer" title="öffentlicher Name Erklärung"> <span class="material-icons"> info </span> </tip-button> <app-popup id="oeffentlicherNameExplainer" class="tip tip--with-input"> Gib hier den Namen des öffentlichen Kontokorrents ein. <ul> <li>frag die anderen Event-/Gruppen- Teilnehmer nach dem Namen</li> <li>such in eurem Chat nach dem Namen oder einem geteilten Link</li> </ul> </app-popup> </div> <div> <button id="loginButton" class="button button--raised login-box__login-button"> Login </button> <div id="processing" class="login-box__processing" style="display:none"> <app-spinner></app-spinner> </div> </div> <a id="createEventButton" class="button" href="create-event"> <span class="material-icons"> add </span> Gruppe erstellen </a> <a id="home-button" class="button" href=""> <span class="material-icons"> home </span> zurück </a> </div>',this.loginButton=this.querySelector("#loginButton"),this.homeButton=this.querySelector("#home-button"),this.loginBox=this.querySelector("#login-box"),this.eventMissingError=this.querySelector("#eventMissingError"),this.accountCreationFailed=this.querySelector("#account-creation-failed"),this.notFoundError=this.querySelector("#notFoundError"),this.processing=this.querySelector("#processing"),this.eventInput=this.querySelector("#eventInput");let t=new URLSearchParams(window.location.search);t.has(a.Cc)&&(this.eventInput.value=t.get(a.Cc)),(0,s.G)(this.querySelectorAll("a"),this.routingActionCreator)}this.loginButton.addEventListener("click",this.loginFuerEvent.bind(this)),this.subscription=this.store.subscribe(null,(t=>this.applyStoreState(t))),this.applyStoreState(this.store.state),this.accountActionCreator.initializeAccount(),this.kontokorrentHinzufuegenActionCreator.loginPageGeoeffnet()}async loginFuerEvent(){let t=this.eventInput.value;if(this.eventMissingError.style.display=t?"none":"block",t&&await this.accountActionCreator.ensureAccount()){let e=await this.kontokorrentHinzufuegenActionCreator.kontokorrentHinzufuegen(t.toLowerCase());e&&await this.routingActionCreator.navigateKontokorrentById(e)}}applyStoreState(t){this.accountCreationFailed.style.display=!t.account.accountCreating&&t.account.accountCreationFailed?"block":"none",this.notFoundError.style.display=!t.kontokorrents.hinzufuegen&&t.kontokorrents.hinzufuegenFailed&&t.kontokorrents.hinzufuegenFailed.kontokorrentNotFound?"block":"none";let e=t.kontokorrents.hinzufuegen||t.account.accountCreating;this.processing.style.display=e?"flex":"none",this.homeButton.style.visibility=t.account.accountCreated&&Object.keys(t.kontokorrents.kontokorrents).length?"visible":"hidden",this.loginButton.style.display=e?"none":"inline-flex"}disconnectedCallback(){this.subscription()}}customElements.define("app-login",c)},2545:function(){class t extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}).innerHTML='<style>.spinner{animation:rotate 2s linear infinite;height:100%}.spinner .path{stroke:var(--spinner-color);stroke-linecap:round;animation:dash 1.5s ease-in-out infinite}@keyframes rotate{100%{transform:rotate(360deg)}}@keyframes dash{0%{stroke-dasharray:1,150;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-35}100%{stroke-dasharray:90,150;stroke-dashoffset:-124}}</style> <svg class="spinner" viewBox="0 0 50 50"> <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle> </svg>'}connectedCallback(){}disconnectedCallback(){}}customElements.define("app-spinner",t)},2204:function(t,e,n){function i(t,e){t.forEach((t=>{t.addEventListener("click",(n=>{n.preventDefault(),e.navigate(t.getAttribute("href"))}))}))}n.d(e,{G:function(){return i}})},4227:function(t,e,n){class i extends HTMLElement{constructor(){super(),this.popupShown=!1,this.keyListener=this.keyListener.bind(this),this.clickListener=this.clickListener.bind(this)}connectedCallback(){this.updateStyles()}keyListener(t){"Escape"==t.key&&this.hide()}clickListener(t){this.contains(event.target)||this.hide()}hide(){this.popupShown&&(document.removeEventListener("keydown",this.keyListener),document.removeEventListener("click",this.clickListener),this.popupShown=!1,this.updateStyles())}show(){this.popupShown||(document.addEventListener("keydown",this.keyListener),document.addEventListener("click",this.clickListener),this.popupShown=!0,this.updateStyles())}updateStyles(){this.style.display=this.popupShown?"block":"none"}toggle(){this.popupShown?this.hide():this.show()}disconnectedCallback(){this.hide()}}customElements.define("app-popup",i)},1480:function(t,e,n){const i="popup-id";class s extends HTMLElement{constructor(){super(),this.clickListener=this.clickListener.bind(this)}attributeChangedCallback(){this.updateAttributes()}updateAttributes(){this.popupId=this.getAttribute(i)}static get observedAttributes(){return[i]}connectedCallback(){this.addEventListener("click",this.clickListener)}clickListener(t){document.querySelector("#".concat(this.popupId)).toggle(),t.stopPropagation()}disconnectedCallback(){this.removeEventListener("click",this.clickListener)}}customElements.define("tip-button",s)},6604:function(t,e,n){n.d(e,{Jj:function(){return p}});var i=n(886);class s{constructor(t){this.exists=t,this.type=7}}class o{constructor(){this.type=8}}class r{constructor(t){this.kontokorrent=t,this.type=21}}class a{constructor(t){this.notFound=t,this.type=9}}class c{constructor(){this.type=10}}class l{constructor(t){this.kontokorrents=t,this.type=20}}class h{constructor(){this.type=18}}class u{constructor(){this.type=37}}class d{constructor(t,e,n){this.store=t,this.apiClient=e,this.db=n}loginPageGeoeffnet(){this.store.dispatch(new h)}nichtGefundenPageGeoeffnet(){this.store.dispatch(new u)}async kontokorrentErstellen(t,e,n,a){let c={name:e,id:t,oeffentlicherName:n,personen:a.map((t=>({name:t,id:(0,i.Z)()})))};this.store.dispatch(new o);let l=await this.apiClient.neuerKontokorrent(c);return l.success?(await this.db.addKontokorrent({id:t,name:e,personen:c.personen,oeffentlicherName:n}),this.store.dispatch(new r({id:t,name:e,personen:c.personen,oeffentlicherName:n})),!0):(this.store.dispatch(new s(l.exists)),!1)}async kontokorrentHinzufuegen(t){let e=await this.db.getPerOeffentlichName(t);if(null!=e)return e.id;this.store.dispatch(new c);try{let e=await this.apiClient.kontokorrentHinzufuegen(t,null);if(null!=e){let t=await this.db.setKontokorrents(e.map((t=>({id:t.id,name:t.name,personen:t.personen,oeffentlicherName:t.oeffentlicherName}))));return this.store.dispatch(new l(e)),t[0]}this.store.dispatch(new a(!0))}catch(t){this.store.dispatch(new a(!1))}return!1}}function p(t){return t.get("KontokorrentHinzufuegenActionCreator",(t=>new d(t.store,t.apiClient,t.db)))}}}]);
//# sourceMappingURL=3600848cce0a165c0fbf.bundle.js.map