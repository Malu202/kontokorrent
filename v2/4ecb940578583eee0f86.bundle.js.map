{"version":3,"sources":["webpack://kontokorrent/../src/comlink.ts","webpack://kontokorrent/./node_modules/date-fns/esm/_lib/requiredArgs/index.js","webpack://kontokorrent/./node_modules/date-fns/esm/_lib/toInteger/index.js","webpack://kontokorrent/./node_modules/date-fns/esm/startOfDay/index.js","webpack://kontokorrent/./node_modules/date-fns/esm/toDate/index.js","webpack://kontokorrent/./src/components/KontokorrentSelect/KontokorrentSelectListEntry.ts","webpack://kontokorrent/./src/components/KontokorrentSelect/KontokorrentSelectList.ts","webpack://kontokorrent/./src/components/KontokorrentSelect/KontokorrentSelect.ts","webpack://kontokorrent/./src/components/AppBar/AppBar.ts","webpack://kontokorrent/./src/components/BalanceAnzeige/BalanceAnzeigeElement.ts","webpack://kontokorrent/./src/components/BalanceAnzeige/BalanceAnzeige.ts","webpack://kontokorrent/./src/components/BezahlungCard/BezahlungCard.ts","webpack://kontokorrent/./node_modules/date-fns/esm/startOfWeek/index.js","webpack://kontokorrent/./src/utils/groupBy.ts","webpack://kontokorrent/./src/components/BezahlungenView/BezahlungenGroup.ts","webpack://kontokorrent/./src/components/BezahlungenView/BezahlungenView.ts","webpack://kontokorrent/./node_modules/date-fns/esm/addDays/index.js","webpack://kontokorrent/./node_modules/date-fns/esm/startOfToday/index.js","webpack://kontokorrent/./node_modules/date-fns/esm/endOfWeek/index.js","webpack://kontokorrent/./src/state/actions/KontokorrentActionCreator.ts","webpack://kontokorrent/./src/lib/filterBezahlungen.ts","webpack://kontokorrent/./src/components/KontokorrentPage/KontokorrentPage.ts","webpack://kontokorrent/./src/components/convertLinks.ts","webpack://kontokorrent/./src/components/ui-components/popup/popup.ts","webpack://kontokorrent/./src/lib/WorkerService.ts","webpack://kontokorrent/./src/utils/ArrayToElementRenderer.ts","webpack://kontokorrent/./src/utils/ReuseableTemplate.ts","webpack://kontokorrent/./src/utils/formatCurrency.ts","webpack://kontokorrent/./src/utils/round.ts","webpack://kontokorrent/./src/components/AppBar/AppBar.html","webpack://kontokorrent/./src/components/BalanceAnzeige/BalanceAnzeige.html","webpack://kontokorrent/./src/components/BalanceAnzeige/BalanceAnzeigeElement.html","webpack://kontokorrent/./src/components/BezahlungCard/BezahlungCard.html","webpack://kontokorrent/./src/components/BezahlungenView/BezahlungenGroup.html","webpack://kontokorrent/./src/components/BezahlungenView/BezahlungenView.html","webpack://kontokorrent/./src/components/KontokorrentPage/KontokorrentPage.html","webpack://kontokorrent/./src/components/KontokorrentSelect/KontokorrentSelect.html","webpack://kontokorrent/./src/components/KontokorrentSelect/KontokorrentSelectList.html","webpack://kontokorrent/./src/components/KontokorrentSelect/KontokorrentSelectListEntry.html"],"names":["proxyMarker","Symbol","createEndpoint","releaseProxy","throwMarker","isObject","val","transferHandlers","Map","canHandle","obj","port1","port2","MessageChannel","expose","deserialize","port","start","wrap","value","serialized","Error","isError","message","name","stack","Object","assign","ep","self","addEventListener","callback","ev","data","id","type","path","argumentList","map","fromWireValue","returnValue","parent","slice","reduce","prop","rawValue","apply","proxy","transfers","transferCache","set","transfer","undefined","Promise","resolve","catch","then","wireValue","transferables","toWireValue","postMessage","removeEventListener","closeEndPoint","endpoint","constructor","isMessagePort","close","target","createProxy","throwIfProxyReleased","isReleased","isProxyReleased","Proxy","_target","requestResponseMessage","p","toString","length","r","bind","_thisArg","rawArgumentList","last","processArguments","processed","v","arr","Array","prototype","concat","WeakMap","handler","serializedValue","serialize","get","msg","fill","Math","floor","random","Number","MAX_SAFE_INTEGER","join","l","requiredArgs","required","args","TypeError","toInteger","dirtyNumber","NaN","number","isNaN","ceil","startOfDay","dirtyDate","arguments","date","toDate","setHours","argument","argStr","call","Date","getTime","console","warn","KontokorrentSelectListEntry","HTMLElement","super","this","innerHTML","querySelector","link","clickEvent","e","preventDefault","dispatchEvent","CustomEvent","detail","kontokorrent","bubbles","isActive","innerText","href","classList","toggle","customElements","define","KontokorrentSelectList","list","_kontokorrents","kontokorrentsRenderer","ArrayToElementRenderer","k","li","document","createElement","appendChild","update","firstChild","_activeKontokorrentId","kontokorrents","sortBy","KontokorrentSelectListTagName","KontokorrentSelect","kontokorrentName","kontokorrentSelectList","addButton","popup","updateAttributes","contains","event","stopPropagation","hide","activeKontokorrentId","getAttribute","updatesStyle","activeKontokorrent","find","KontokorrentSelectTagName","AppBar","kontokorrentSelect","logoutDialog","async","accountActionCreator","logout","convertLinks","querySelectorAll","routingActionCreator","subscription","store","subscribe","state","applyStoreState","navigateLogin","values","setAttribute","serviceLocator","AppBarTagName","PersonNameAttribute","BalanceAttribute","BalanceRangeAttribute","template","ReuseableTemplate","personNameElement","balanceTextElement","balanceContainerElement","barElement","requestAnimationFrame","style","transform","personName","balance","parseFloat","balanceRange","max","formatCurrency","scale","sign","abs","balanceTransform","add","remove","BalanceAnzeige","personenRenderer","b","personen","BeschreibungAttribute","WertAttribute","BezahlendePersonAttribute","EmpfaengerAttribute","StatusAttribute","BezahlungIdAttribute","attributeStore","beschreibung","bezahlendePerson","empfaenger","wert","status","beschreibungElement","bezahlendePersonElement","empfaengerElement","wertElement","doneElement","doneAllElement","syncElement","clickListener","onClick","getAtt","att","checkChanged","some","display","startOfWeek","dirtyOptions","options","locale","localeWeekStartsOn","weekStartsOn","defaultWeekStartsOn","RangeError","day","getDay","diff","setDate","getDate","groupBy","key","forEach","item","collection","push","BezahlungenGroup","container","titleElement","bezahlungenRenderer","bezahlungen","bezahlendePersonName","t","BezahlungenView","minTage","minEintraege","all","bezahlungenContainer","showMoreButton","showMoreClick","groupRenderer","s","anzahlEintraege","lastElementChild","scrollIntoView","behavior","setShowMoreButtonDisplay","z","empfaengerIds","render","sorted","sort","a","zeitpunkt","filtered","filter","dirtyAmount","amount","addDays","now","mapped","bezahlendePersonId","formatEmpfaenger","tag","woche","isWeek","grouped","of","entries","c","sortedGroups","d","setBezahlungen","title","formatWeek","formatDay","weekformat","endWeek","endOfWeek","dayAndMonth","Intl","DateTimeFormat","month","format","getMonth","weekday","year","KontokorrentGeoeffnet","KontokorrentBezahlungen","kontokorrentId","KontokorrentSynchronisieren","KontokorrentSynchronisiert","KontokorrentBalanceAktualisiert","KontokorrentActionCreator","apiClient","db","workerService","aktionen","bezahlungenMap","ordered","laufendeNummer","bearbeiteteBezahlungId","geloeschteBezahlungId","bezahlung","filterBezahlungen","getAktionen","zwischengespeicherte","getZwischengespeicherteBezahlungenForKontokorrent","dispatch","getWorker","calculateBalance","refreshBezahlungen","getLaufendeNummer","res","success","addAktionen","refreshKontokorrent","getKontokorrent","tasks","setZuletztGesehenerKontokorrentId","kontokorrentSynchronisieren","KontokorrentPage","appBar","balanceAnzeige","bezahlungenView","kontokorrentSpinner","kontokorrentActionCreator","kontokorrentActionCreatorFactory","kontokorrentListenActionCreator","addServices","navigateBezahlung","kontokorrentIdParameter","navigiereZuLetztGesehenem","navigateKontokorrent","bezahlungClickListener","bezahlungClick","setBalance","synchronisieren","kontokorrentOeffnen","elements","navigate","Popup","popupShown","keyListener","updateStyles","show","WorkerService","workerApi","worker","Worker","URL","workerServiceFactory","listElement","keySelector","keyToElement","elementToKey","updateElement","keyCache","getKey","x","from","children","el","i","removeChild","before","nextKeyToElement","childElement","firstElementChild","prepend","nextElementSibling","insertAdjacentElement","instance","importNode","content","valueString","indexOfE","indexOfe","power","Betrag","indexOf","substring","round","Kommaindex","module","exports"],"mappings":"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","file":"4ecb940578583eee0f86.bundle.js","sourcesContent":["/**\n * Copyright 2019 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *     http://www.apache.org/licenses/LICENSE-2.0\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Endpoint,\n  EventSource,\n  Message,\n  MessageType,\n  PostMessageWithOrigin,\n  WireValue,\n  WireValueType,\n} from \"./protocol\";\nexport { Endpoint };\n\nexport const proxyMarker = Symbol(\"Comlink.proxy\");\nexport const createEndpoint = Symbol(\"Comlink.endpoint\");\nexport const releaseProxy = Symbol(\"Comlink.releaseProxy\");\n\nconst throwMarker = Symbol(\"Comlink.thrown\");\n\n/**\n * Interface of values that were marked to be proxied with `comlink.proxy()`.\n * Can also be implemented by classes.\n */\nexport interface ProxyMarked {\n  [proxyMarker]: true;\n}\n\n/**\n * Takes a type and wraps it in a Promise, if it not already is one.\n * This is to avoid `Promise<Promise<T>>`.\n *\n * This is the inverse of `Unpromisify<T>`.\n */\ntype Promisify<T> = T extends Promise<unknown> ? T : Promise<T>;\n/**\n * Takes a type that may be Promise and unwraps the Promise type.\n * If `P` is not a Promise, it returns `P`.\n *\n * This is the inverse of `Promisify<T>`.\n */\ntype Unpromisify<P> = P extends Promise<infer T> ? T : P;\n\n/**\n * Takes the raw type of a remote property and returns the type that is visible to the local thread on the proxy.\n *\n * Note: This needs to be its own type alias, otherwise it will not distribute over unions.\n * See https://www.typescriptlang.org/docs/handbook/advanced-types.html#distributive-conditional-types\n */\ntype RemoteProperty<T> =\n  // If the value is a method, comlink will proxy it automatically.\n  // Objects are only proxied if they are marked to be proxied.\n  // Otherwise, the property is converted to a Promise that resolves the cloned value.\n  T extends Function | ProxyMarked ? Remote<T> : Promisify<T>;\n\n/**\n * Takes the raw type of a property as a remote thread would see it through a proxy (e.g. when passed in as a function\n * argument) and returns the type that the local thread has to supply.\n *\n * This is the inverse of `RemoteProperty<T>`.\n *\n * Note: This needs to be its own type alias, otherwise it will not distribute over unions. See\n * https://www.typescriptlang.org/docs/handbook/advanced-types.html#distributive-conditional-types\n */\ntype LocalProperty<T> = T extends Function | ProxyMarked\n  ? Local<T>\n  : Unpromisify<T>;\n\n/**\n * Proxies `T` if it is a `ProxyMarked`, clones it otherwise (as handled by structured cloning and transfer handlers).\n */\nexport type ProxyOrClone<T> = T extends ProxyMarked ? Remote<T> : T;\n/**\n * Inverse of `ProxyOrClone<T>`.\n */\nexport type UnproxyOrClone<T> = T extends RemoteObject<ProxyMarked>\n  ? Local<T>\n  : T;\n\n/**\n * Takes the raw type of a remote object in the other thread and returns the type as it is visible to the local thread\n * when proxied with `Comlink.proxy()`.\n *\n * This does not handle call signatures, which is handled by the more general `Remote<T>` type.\n *\n * @template T The raw type of a remote object as seen in the other thread.\n */\nexport type RemoteObject<T> = { [P in keyof T]: RemoteProperty<T[P]> };\n/**\n * Takes the type of an object as a remote thread would see it through a proxy (e.g. when passed in as a function\n * argument) and returns the type that the local thread has to supply.\n *\n * This does not handle call signatures, which is handled by the more general `Local<T>` type.\n *\n * This is the inverse of `RemoteObject<T>`.\n *\n * @template T The type of a proxied object.\n */\nexport type LocalObject<T> = { [P in keyof T]: LocalProperty<T[P]> };\n\n/**\n * Additional special comlink methods available on each proxy returned by `Comlink.wrap()`.\n */\nexport interface ProxyMethods {\n  [createEndpoint]: () => Promise<MessagePort>;\n  [releaseProxy]: () => void;\n}\n\n/**\n * Takes the raw type of a remote object, function or class in the other thread and returns the type as it is visible to\n * the local thread from the proxy return value of `Comlink.wrap()` or `Comlink.proxy()`.\n */\nexport type Remote<T> =\n  // Handle properties\n  RemoteObject<T> &\n    // Handle call signature (if present)\n    (T extends (...args: infer TArguments) => infer TReturn\n      ? (\n          ...args: { [I in keyof TArguments]: UnproxyOrClone<TArguments[I]> }\n        ) => Promisify<ProxyOrClone<Unpromisify<TReturn>>>\n      : unknown) &\n    // Handle construct signature (if present)\n    // The return of construct signatures is always proxied (whether marked or not)\n    (T extends { new (...args: infer TArguments): infer TInstance }\n      ? {\n          new (\n            ...args: {\n              [I in keyof TArguments]: UnproxyOrClone<TArguments[I]>;\n            }\n          ): Promisify<Remote<TInstance>>;\n        }\n      : unknown) &\n    // Include additional special comlink methods available on the proxy.\n    ProxyMethods;\n\n/**\n * Expresses that a type can be either a sync or async.\n */\ntype MaybePromise<T> = Promise<T> | T;\n\n/**\n * Takes the raw type of a remote object, function or class as a remote thread would see it through a proxy (e.g. when\n * passed in as a function argument) and returns the type the local thread has to supply.\n *\n * This is the inverse of `Remote<T>`. It takes a `Remote<T>` and returns its original input `T`.\n */\nexport type Local<T> =\n  // Omit the special proxy methods (they don't need to be supplied, comlink adds them)\n  Omit<LocalObject<T>, keyof ProxyMethods> &\n    // Handle call signatures (if present)\n    (T extends (...args: infer TArguments) => infer TReturn\n      ? (\n          ...args: { [I in keyof TArguments]: ProxyOrClone<TArguments[I]> }\n        ) => // The raw function could either be sync or async, but is always proxied automatically\n        MaybePromise<UnproxyOrClone<Unpromisify<TReturn>>>\n      : unknown) &\n    // Handle construct signature (if present)\n    // The return of construct signatures is always proxied (whether marked or not)\n    (T extends { new (...args: infer TArguments): infer TInstance }\n      ? {\n          new (\n            ...args: {\n              [I in keyof TArguments]: ProxyOrClone<TArguments[I]>;\n            }\n          ): // The raw constructor could either be sync or async, but is always proxied automatically\n          MaybePromise<Local<Unpromisify<TInstance>>>;\n        }\n      : unknown);\n\nconst isObject = (val: unknown): val is object =>\n  (typeof val === \"object\" && val !== null) || typeof val === \"function\";\n\n/**\n * Customizes the serialization of certain values as determined by `canHandle()`.\n *\n * @template T The input type being handled by this transfer handler.\n * @template S The serialized type sent over the wire.\n */\nexport interface TransferHandler<T, S> {\n  /**\n   * Gets called for every value to determine whether this transfer handler\n   * should serialize the value, which includes checking that it is of the right\n   * type (but can perform checks beyond that as well).\n   */\n  canHandle(value: unknown): value is T;\n\n  /**\n   * Gets called with the value if `canHandle()` returned `true` to produce a\n   * value that can be sent in a message, consisting of structured-cloneable\n   * values and/or transferrable objects.\n   */\n  serialize(value: T): [S, Transferable[]];\n\n  /**\n   * Gets called to deserialize an incoming value that was serialized in the\n   * other thread with this transfer handler (known through the name it was\n   * registered under).\n   */\n  deserialize(value: S): T;\n}\n\n/**\n * Internal transfer handle to handle objects marked to proxy.\n */\nconst proxyTransferHandler: TransferHandler<object, MessagePort> = {\n  canHandle: (val): val is ProxyMarked =>\n    isObject(val) && (val as ProxyMarked)[proxyMarker],\n  serialize(obj) {\n    const { port1, port2 } = new MessageChannel();\n    expose(obj, port1);\n    return [port2, [port2]];\n  },\n  deserialize(port) {\n    port.start();\n    return wrap(port);\n  },\n};\n\ninterface ThrownValue {\n  [throwMarker]: unknown; // just needs to be present\n  value: unknown;\n}\ntype SerializedThrownValue =\n  | { isError: true; value: Error }\n  | { isError: false; value: unknown };\n\n/**\n * Internal transfer handler to handle thrown exceptions.\n */\nconst throwTransferHandler: TransferHandler<\n  ThrownValue,\n  SerializedThrownValue\n> = {\n  canHandle: (value): value is ThrownValue =>\n    isObject(value) && throwMarker in value,\n  serialize({ value }) {\n    let serialized: SerializedThrownValue;\n    if (value instanceof Error) {\n      serialized = {\n        isError: true,\n        value: {\n          message: value.message,\n          name: value.name,\n          stack: value.stack,\n        },\n      };\n    } else {\n      serialized = { isError: false, value };\n    }\n    return [serialized, []];\n  },\n  deserialize(serialized) {\n    if (serialized.isError) {\n      throw Object.assign(\n        new Error(serialized.value.message),\n        serialized.value\n      );\n    }\n    throw serialized.value;\n  },\n};\n\n/**\n * Allows customizing the serialization of certain values.\n */\nexport const transferHandlers = new Map<\n  string,\n  TransferHandler<unknown, unknown>\n>([\n  [\"proxy\", proxyTransferHandler],\n  [\"throw\", throwTransferHandler],\n]);\n\nexport function expose(obj: any, ep: Endpoint = self as any) {\n  ep.addEventListener(\"message\", function callback(ev: MessageEvent) {\n    if (!ev || !ev.data) {\n      return;\n    }\n    const { id, type, path } = {\n      path: [] as string[],\n      ...(ev.data as Message),\n    };\n    const argumentList = (ev.data.argumentList || []).map(fromWireValue);\n    let returnValue;\n    try {\n      const parent = path.slice(0, -1).reduce((obj, prop) => obj[prop], obj);\n      const rawValue = path.reduce((obj, prop) => obj[prop], obj);\n      switch (type) {\n        case MessageType.GET:\n          {\n            returnValue = rawValue;\n          }\n          break;\n        case MessageType.SET:\n          {\n            parent[path.slice(-1)[0]] = fromWireValue(ev.data.value);\n            returnValue = true;\n          }\n          break;\n        case MessageType.APPLY:\n          {\n            returnValue = rawValue.apply(parent, argumentList);\n          }\n          break;\n        case MessageType.CONSTRUCT:\n          {\n            const value = new rawValue(...argumentList);\n            returnValue = proxy(value);\n          }\n          break;\n        case MessageType.ENDPOINT:\n          {\n            const { port1, port2 } = new MessageChannel();\n            expose(obj, port2);\n            returnValue = transfer(port1, [port1]);\n          }\n          break;\n        case MessageType.RELEASE:\n          {\n            returnValue = undefined;\n          }\n          break;\n      }\n    } catch (value) {\n      returnValue = { value, [throwMarker]: 0 };\n    }\n    Promise.resolve(returnValue)\n      .catch((value) => {\n        return { value, [throwMarker]: 0 };\n      })\n      .then((returnValue) => {\n        const [wireValue, transferables] = toWireValue(returnValue);\n        ep.postMessage({ ...wireValue, id }, transferables);\n        if (type === MessageType.RELEASE) {\n          // detach and deactive after sending release response above.\n          ep.removeEventListener(\"message\", callback as any);\n          closeEndPoint(ep);\n        }\n      });\n  } as any);\n  if (ep.start) {\n    ep.start();\n  }\n}\n\nfunction isMessagePort(endpoint: Endpoint): endpoint is MessagePort {\n  return endpoint.constructor.name === \"MessagePort\";\n}\n\nfunction closeEndPoint(endpoint: Endpoint) {\n  if (isMessagePort(endpoint)) endpoint.close();\n}\n\nexport function wrap<T>(ep: Endpoint, target?: any): Remote<T> {\n  return createProxy<T>(ep, [], target) as any;\n}\n\nfunction throwIfProxyReleased(isReleased: boolean) {\n  if (isReleased) {\n    throw new Error(\"Proxy has been released and is not useable\");\n  }\n}\n\nfunction createProxy<T>(\n  ep: Endpoint,\n  path: (string | number | symbol)[] = [],\n  target: object = function () {}\n): Remote<T> {\n  let isProxyReleased = false;\n  const proxy = new Proxy(target, {\n    get(_target, prop) {\n      throwIfProxyReleased(isProxyReleased);\n      if (prop === releaseProxy) {\n        return () => {\n          return requestResponseMessage(ep, {\n            type: MessageType.RELEASE,\n            path: path.map((p) => p.toString()),\n          }).then(() => {\n            closeEndPoint(ep);\n            isProxyReleased = true;\n          });\n        };\n      }\n      if (prop === \"then\") {\n        if (path.length === 0) {\n          return { then: () => proxy };\n        }\n        const r = requestResponseMessage(ep, {\n          type: MessageType.GET,\n          path: path.map((p) => p.toString()),\n        }).then(fromWireValue);\n        return r.then.bind(r);\n      }\n      return createProxy(ep, [...path, prop]);\n    },\n    set(_target, prop, rawValue) {\n      throwIfProxyReleased(isProxyReleased);\n      // FIXME: ES6 Proxy Handler `set` methods are supposed to return a\n      // boolean. To show good will, we return true asynchronously ¯\\_(ツ)_/¯\n      const [value, transferables] = toWireValue(rawValue);\n      return requestResponseMessage(\n        ep,\n        {\n          type: MessageType.SET,\n          path: [...path, prop].map((p) => p.toString()),\n          value,\n        },\n        transferables\n      ).then(fromWireValue) as any;\n    },\n    apply(_target, _thisArg, rawArgumentList) {\n      throwIfProxyReleased(isProxyReleased);\n      const last = path[path.length - 1];\n      if ((last as any) === createEndpoint) {\n        return requestResponseMessage(ep, {\n          type: MessageType.ENDPOINT,\n        }).then(fromWireValue);\n      }\n      // We just pretend that `bind()` didn’t happen.\n      if (last === \"bind\") {\n        return createProxy(ep, path.slice(0, -1));\n      }\n      const [argumentList, transferables] = processArguments(rawArgumentList);\n      return requestResponseMessage(\n        ep,\n        {\n          type: MessageType.APPLY,\n          path: path.map((p) => p.toString()),\n          argumentList,\n        },\n        transferables\n      ).then(fromWireValue);\n    },\n    construct(_target, rawArgumentList) {\n      throwIfProxyReleased(isProxyReleased);\n      const [argumentList, transferables] = processArguments(rawArgumentList);\n      return requestResponseMessage(\n        ep,\n        {\n          type: MessageType.CONSTRUCT,\n          path: path.map((p) => p.toString()),\n          argumentList,\n        },\n        transferables\n      ).then(fromWireValue);\n    },\n  });\n  return proxy as any;\n}\n\nfunction myFlat<T>(arr: (T | T[])[]): T[] {\n  return Array.prototype.concat.apply([], arr);\n}\n\nfunction processArguments(argumentList: any[]): [WireValue[], Transferable[]] {\n  const processed = argumentList.map(toWireValue);\n  return [processed.map((v) => v[0]), myFlat(processed.map((v) => v[1]))];\n}\n\nconst transferCache = new WeakMap<any, Transferable[]>();\nexport function transfer(obj: any, transfers: Transferable[]) {\n  transferCache.set(obj, transfers);\n  return obj;\n}\n\nexport function proxy<T>(obj: T): T & ProxyMarked {\n  return Object.assign(obj, { [proxyMarker]: true }) as any;\n}\n\nexport function windowEndpoint(\n  w: PostMessageWithOrigin,\n  context: EventSource = self,\n  targetOrigin = \"*\"\n): Endpoint {\n  return {\n    postMessage: (msg: any, transferables: Transferable[]) =>\n      w.postMessage(msg, targetOrigin, transferables),\n    addEventListener: context.addEventListener.bind(context),\n    removeEventListener: context.removeEventListener.bind(context),\n  };\n}\n\nfunction toWireValue(value: any): [WireValue, Transferable[]] {\n  for (const [name, handler] of transferHandlers) {\n    if (handler.canHandle(value)) {\n      const [serializedValue, transferables] = handler.serialize(value);\n      return [\n        {\n          type: WireValueType.HANDLER,\n          name,\n          value: serializedValue,\n        },\n        transferables,\n      ];\n    }\n  }\n  return [\n    {\n      type: WireValueType.RAW,\n      value,\n    },\n    transferCache.get(value) || [],\n  ];\n}\n\nfunction fromWireValue(value: WireValue): any {\n  switch (value.type) {\n    case WireValueType.HANDLER:\n      return transferHandlers.get(value.name)!.deserialize(value.value);\n    case WireValueType.RAW:\n      return value.value;\n  }\n}\n\nfunction requestResponseMessage(\n  ep: Endpoint,\n  msg: Message,\n  transfers?: Transferable[]\n): Promise<WireValue> {\n  return new Promise((resolve) => {\n    const id = generateUUID();\n    ep.addEventListener(\"message\", function l(ev: MessageEvent) {\n      if (!ev.data || !ev.data.id || ev.data.id !== id) {\n        return;\n      }\n      ep.removeEventListener(\"message\", l as any);\n      resolve(ev.data);\n    } as any);\n    if (ep.start) {\n      ep.start();\n    }\n    ep.postMessage({ id, ...msg }, transfers);\n  });\n}\n\nfunction generateUUID(): string {\n  return new Array(4)\n    .fill(0)\n    .map(() => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16))\n    .join(\"-\");\n}\n","export default function requiredArgs(required, args) {\n  if (args.length < required) {\n    throw new TypeError(required + ' argument' + (required > 1 ? 's' : '') + ' required, but only ' + args.length + ' present');\n  }\n}","export default function toInteger(dirtyNumber) {\n  if (dirtyNumber === null || dirtyNumber === true || dirtyNumber === false) {\n    return NaN;\n  }\n\n  var number = Number(dirtyNumber);\n\n  if (isNaN(number)) {\n    return number;\n  }\n\n  return number < 0 ? Math.ceil(number) : Math.floor(number);\n}","import toDate from '../toDate/index.js';\nimport requiredArgs from '../_lib/requiredArgs/index.js';\n/**\n * @name startOfDay\n * @category Day Helpers\n * @summary Return the start of a day for the given date.\n *\n * @description\n * Return the start of a day for the given date.\n * The result will be in the local timezone.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the original date\n * @returns {Date} the start of a day\n * @throws {TypeError} 1 argument required\n *\n * @example\n * // The start of a day for 2 September 2014 11:55:00:\n * var result = startOfDay(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Tue Sep 02 2014 00:00:00\n */\n\nexport default function startOfDay(dirtyDate) {\n  requiredArgs(1, arguments);\n  var date = toDate(dirtyDate);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}","import requiredArgs from '../_lib/requiredArgs/index.js';\n/**\n * @name toDate\n * @category Common Helpers\n * @summary Convert the given argument to an instance of Date.\n *\n * @description\n * Convert the given argument to an instance of Date.\n *\n * If the argument is an instance of Date, the function returns its clone.\n *\n * If the argument is a number, it is treated as a timestamp.\n *\n * If the argument is none of the above, the function returns Invalid Date.\n *\n * **Note**: *all* Date arguments passed to any *date-fns* function is processed by `toDate`.\n *\n * @param {Date|Number} argument - the value to convert\n * @returns {Date} the parsed date in the local time zone\n * @throws {TypeError} 1 argument required\n *\n * @example\n * // Clone the date:\n * const result = toDate(new Date(2014, 1, 11, 11, 30, 30))\n * //=> Tue Feb 11 2014 11:30:30\n *\n * @example\n * // Convert the timestamp to date:\n * const result = toDate(1392098430000)\n * //=> Tue Feb 11 2014 11:30:30\n */\n\nexport default function toDate(argument) {\n  requiredArgs(1, arguments);\n  var argStr = Object.prototype.toString.call(argument); // Clone the date\n\n  if (argument instanceof Date || typeof argument === 'object' && argStr === '[object Date]') {\n    // Prevent the date to lose the milliseconds when passed to new Date() in IE10\n    return new Date(argument.getTime());\n  } else if (typeof argument === 'number' || argStr === '[object Number]') {\n    return new Date(argument);\n  } else {\n    if ((typeof argument === 'string' || argStr === '[object String]') && typeof console !== 'undefined') {\n      // eslint-disable-next-line no-console\n      console.warn(\"Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule\"); // eslint-disable-next-line no-console\n\n      console.warn(new Error().stack);\n    }\n\n    return new Date(NaN);\n  }\n}","import template from \"./KontokorrentSelectListEntry.html\";\nimport { KontokorrentState } from \"../../state/State\";\n\n\nexport class KontokorrentSelectListEntry extends HTMLElement {\n    private name: HTMLSpanElement;\n    private link: HTMLAnchorElement;\n    private kontokorrent: KontokorrentState;\n\n    constructor() {\n        super();\n        this.innerHTML = template;\n        this.name = this.querySelector(`[data-ref=\"name\"]`);\n        this.link = this.querySelector(`[data-ref=\"link\"]`);\n        this.clickEvent = this.clickEvent.bind(this);\n    }\n\n    connectedCallback() {\n        this.link.addEventListener(\"click\", this.clickEvent);\n    }\n\n    private clickEvent(e: MouseEvent): void {\n        e.preventDefault();\n        this.dispatchEvent(new CustomEvent(\"gotokontokorrent\", { detail: this.kontokorrent.id, bubbles: true }));\n    }\n\n    disconnectedCallback() {\n        this.link.removeEventListener(\"click\", this.clickEvent);\n    }\n\n    update(kontokorrent: KontokorrentState, isActive: boolean) {\n        this.kontokorrent = kontokorrent;\n        this.name.innerText = kontokorrent.name;\n        this.link.href = `kontokorrents/${kontokorrent.id}`;\n        this.link.classList.toggle(\"kontokorrent-select-list__entry--active\", isActive);\n    }\n}\nexport const KontokorrentSelectListEntryTagName = \"kontokorrent-select-list-entry\";\ncustomElements.define(KontokorrentSelectListEntryTagName, KontokorrentSelectListEntry);\n","import template from \"./KontokorrentSelectList.html\";\nimport \"./KontokorrentSelectList.scss\";\nimport { KontokorrentState } from \"../../state/State\";\nimport { sortByAlphabetically } from \"../../utils/sortBy\";\nimport { ArrayToElementRenderer } from \"../../utils/ArrayToElementRenderer\";\nimport { KontokorrentSelectListEntry } from \"./KontokorrentSelectListEntry\";\n\nexport class KontokorrentSelectList extends HTMLElement {\n    private list: HTMLOListElement;\n    private _kontokorrents: KontokorrentState[];\n    private _activeKontokorrentId: string;\n    private kontokorrentsRenderer: ArrayToElementRenderer<KontokorrentState, HTMLLIElement, string>;\n\n\n    constructor() {\n        super();\n        this.innerHTML = template;\n        this.list = this.querySelector(`[data-ref=\"list\"]`);\n        this._kontokorrents = [];\n        this.kontokorrentsRenderer = new ArrayToElementRenderer(this.list,\n            (k: KontokorrentState) => k.id,\n            () => {\n                let li = document.createElement(\"li\");\n                li.appendChild(new KontokorrentSelectListEntry());\n                return li;\n            });\n    }\n\n    connectedCallback() {\n    }\n\n    disconnectedCallback() {\n\n    }\n\n    private update() {\n        this.kontokorrentsRenderer.update(this._kontokorrents,\n            (li, kontokorrent) => {\n                let x: KontokorrentSelectListEntry = <KontokorrentSelectListEntry>li.firstChild;\n                x.update(kontokorrent, this._activeKontokorrentId == kontokorrent.id);\n            });\n    }\n\n    set kontokorrents(kontokorrents: KontokorrentState[]) {\n        this._kontokorrents = sortByAlphabetically(kontokorrents, k => k.name);\n        this.update();\n    }\n\n    set activeKontokorrentId(id: string) {\n        this._activeKontokorrentId = id;\n        this.update();\n    }\n}\nexport const KontokorrentSelectListTagName = \"kontokorrent-select-list\";\ncustomElements.define(KontokorrentSelectListTagName, KontokorrentSelectList);\n","import template from \"./KontokorrentSelect.html\";\nimport \"./KontokorrentSelect.scss\";\nimport \"./KontokorrentSelectList\";\nimport { KontokorrentState } from \"../../state/State\";\nimport { KontokorrentSelectListTagName, KontokorrentSelectList } from \"./KontokorrentSelectList\";\nimport { Popup } from \"../ui-components/popup/popup\";\nimport \"../ui-components/popup/popup\";\n\nexport class KontokorrentSelect extends HTMLElement {\n    private kontokorrentName: HTMLHeadingElement;\n    private popup: Popup;\n    private kontokorrentSelectList: KontokorrentSelectList;\n    private addButton: HTMLButtonElement;\n    private activeKontokorrentId: string;\n    private _kontokorrents: KontokorrentState[];\n\n    constructor() {\n        super();\n        this.innerHTML = template;\n        this.kontokorrentName = this.querySelector(`[data-ref=\"kontokorrent-name\"]`);\n        this.kontokorrentSelectList = this.querySelector(KontokorrentSelectListTagName);\n        this.addButton = this.querySelector(`#add-kontokorrent`);\n        this._kontokorrents = null;\n    }\n\n    connectedCallback() {\n        this.popup = this.querySelector(`app-popup`);\n        this.updateAttributes();\n        this.addEventListener(\"click\", e => {\n            if (!this.popup.contains(<Element>(event.target))) {\n                this.popup.toggle();\n                e.stopPropagation();\n            }\n        });\n        this.addButton.addEventListener(\"click\", e => {\n            this.dispatchEvent(new CustomEvent(\"addkontokorrent\"));\n        });\n        this.kontokorrentSelectList.addEventListener(\"gotokontokorrent\", () => {\n            this.popup.hide();\n        })\n    }\n\n    disconnectedCallback() {\n\n    }\n\n    attributeChangedCallback() {\n        this.updateAttributes();\n    }\n\n    private updateAttributes() {\n        this.activeKontokorrentId = this.getAttribute(\"active-kontokorrent-id\");\n        this.kontokorrentSelectList.activeKontokorrentId = this.activeKontokorrentId;\n        this.updatesStyle();\n    }\n\n    static get observedAttributes() {\n        return [\"active-kontokorrent-id\"];\n    }\n\n    set kontokorrents(kontokorrents: KontokorrentState[]) {\n        this.kontokorrentSelectList.kontokorrents = kontokorrents;\n        this._kontokorrents = kontokorrents;\n        this.updatesStyle();\n    }\n\n    private updatesStyle() {\n        if (this._kontokorrents && this._kontokorrents.length) {\n            let activeKontokorrent = this._kontokorrents.find(k => k.id == this.activeKontokorrentId);\n            if (activeKontokorrent) {\n                this.kontokorrentName.innerText = activeKontokorrent.name;\n            }\n            else {\n                this.kontokorrentName.innerText = \"(Kontokorrent wählen)\";\n            }\n        }\n    }\n\n}\nexport const KontokorrentSelectTagName = \"kontokorrent-select\";\ncustomElements.define(KontokorrentSelectTagName, KontokorrentSelect);\n","import template from \"./AppBar.html\";\nimport \"./AppBar.scss\";\nimport { RoutingActionCreator, routingActionCreatorFactory } from \"../../state/actions/RoutingActionCreator\";\nimport { convertLinks } from \"../convertLinks\";\nimport \"../KontokorrentSelect/KontokorrentSelect\";\nimport { KontokorrentSelectTagName, KontokorrentSelect } from \"../KontokorrentSelect/KontokorrentSelect\";\nimport { ServiceLocator } from \"../../ServiceLocator\";\nimport { AccountActionCreator, accountActionCreatorFactory } from \"../../state/actions/AccountActionCreator\";\nimport { Store } from \"../../state/Store\";\nimport { State } from \"../../state/State\";\nimport { Popup } from \"../ui-components/popup/popup\";\n\nexport class AppBar extends HTMLElement {\n    private kontokorrentSelect: KontokorrentSelect;\n    private store: Store;\n    private routingActionCreator: RoutingActionCreator;\n    private accountActionCreator: AccountActionCreator;\n    private logoutDialog: Popup;\n    private subscription: () => void;\n\n\n    constructor() {\n        super();\n        this.innerHTML = template;\n        this.kontokorrentSelect = this.querySelector(KontokorrentSelectTagName);\n        this.logoutDialog = this.querySelector(\"#logout-dialog\");\n    }\n\n    connectedCallback() {\n        this.querySelector(\"#logout-button\").addEventListener(\"click\", (e: MouseEvent) => {\n            this.logoutDialog.toggle();\n            e.stopPropagation();\n        });\n        this.querySelector(\"#confirm-logout\").addEventListener(\"click\", async () => {\n            await this.accountActionCreator.logout();\n        });\n        this.querySelector(\"#abort-logout\").addEventListener(\"click\", () => {\n            this.logoutDialog.hide();\n        });\n        convertLinks(this.querySelectorAll(\"a\"), this.routingActionCreator);\n        this.subscription = this.store.subscribe(null, state => this.applyStoreState(state));\n        this.applyStoreState(this.store.state);\n        this.kontokorrentSelect.addEventListener(\"addkontokorrent\", () => {\n            this.routingActionCreator.navigateLogin();\n        });\n    }\n\n    applyStoreState(state: State): void {\n        this.kontokorrentSelect.kontokorrents = Object.values(state.kontokorrents.kontokorrents);\n        this.kontokorrentSelect.setAttribute(\"active-kontokorrent-id\", state.kontokorrents.activeKontokorrentId);\n    }\n\n    addServices(serviceLocator: ServiceLocator) {\n        this.store = serviceLocator.store;\n        this.routingActionCreator = routingActionCreatorFactory(serviceLocator);\n        this.accountActionCreator = accountActionCreatorFactory(serviceLocator);\n    }\n\n    disconnectedCallback() {\n        this.subscription();\n    }\n}\nexport const AppBarTagName = \"app-bar\";\ncustomElements.define(AppBarTagName, AppBar);\n","import templateContent from \"./BalanceAnzeigeElement.html\";\nimport \"./BalanceAnzeigeElement.scss\";\nimport { formatCurrency } from \"../../utils/formatCurrency\";\nimport { ReuseableTemplate } from \"../../utils/ReuseableTemplate\";\n\nexport const PersonNameAttribute = \"person-name\";\nexport const BalanceAttribute = \"balance\";\nexport const BalanceRangeAttribute = \"balance-range\";\n\nconst template = new ReuseableTemplate(templateContent);\n\nexport class BalanceAnzeigeElement extends HTMLElement {\n    private personName: string;\n    private balance: number;\n    private personNameElement: HTMLSpanElement;\n    private balanceTextElement: HTMLSpanElement;\n    private balanceRange: number;\n    private barElement: HTMLDivElement;\n    private balanceContainerElement: HTMLSpanElement;\n\n    constructor() {\n        super();\n        this.appendChild(template.get());\n        this.personNameElement = this.querySelector(`[data-ref=\"person-name\"]`);\n        this.balanceTextElement = this.querySelector(`[data-ref=\"balance-text\"]`);\n        this.balanceContainerElement = this.querySelector(`[data-ref=\"balance-container\"]`);\n        this.barElement = this.querySelector(`[data-ref=\"bar\"]`);\n    }\n\n    connectedCallback() {\n        requestAnimationFrame(() => {\n            this.barElement.style.transform = `scaleY(0)`;\n            this.updatesStyle();\n        });\n    }\n\n    disconnectedCallback() {\n\n    }\n\n    attributeChangedCallback() {\n        this.updateAttributes();\n    }\n\n    private updateAttributes() {\n        this.personName = this.getAttribute(PersonNameAttribute);\n        this.balance = parseFloat(this.getAttribute(BalanceAttribute));\n        this.balanceRange = Math.max(2, parseFloat(this.getAttribute(BalanceRangeAttribute)));\n        this.updatesStyle();\n    }\n\n    static get observedAttributes() {\n        return [PersonNameAttribute, BalanceAttribute, BalanceRangeAttribute];\n    }\n\n    private updatesStyle() {\n        requestAnimationFrame(() => {\n            this.personNameElement.innerText = this.personName;\n            this.balanceTextElement.innerText = formatCurrency(this.balance);\n            let scale = Math.sign(this.balance) * Math.abs(this.balance) / this.balanceRange;\n            let balanceTransform = scale * 1.9;\n            this.barElement.style.transform = `scaleY(${scale})`;\n            this.balanceContainerElement.style.transform = Math.sign(this.balance) < 0 ? `translateY(calc(${balanceTransform}em - 150%))`\n                : `translateY(calc(${balanceTransform}em + 50%))`;\n            if (scale > 0) {\n                this.barElement.classList.add(\"balance-anzeige-element__bar--negative\");\n                this.barElement.classList.remove(\"balance-anzeige-element__bar--positive\");\n            }\n            else {\n                this.barElement.classList.remove(\"balance-anzeige-element__bar--negative\");\n                this.barElement.classList.add(\"balance-anzeige-element__bar--positive\");\n            }\n        });\n    }\n\n}\nexport const BalanceAnzeigeElementTagName = \"balance-anzeige-element\";\ncustomElements.define(BalanceAnzeigeElementTagName, BalanceAnzeigeElement);\n","import template from \"./BalanceAnzeige.html\";\nimport { ArrayToElementRenderer } from \"../../utils/ArrayToElementRenderer\";\nimport { BalanceAnzeigeElement, PersonNameAttribute, BalanceAttribute, BalanceRangeAttribute } from \"./BalanceAnzeigeElement\";\nimport { Person } from \"../../state/State\";\n\nexport class BalanceAnzeige extends HTMLElement {\n    private balanceRange: number;\n    private personen: Person[];\n    private personenRenderer: ArrayToElementRenderer<Person, HTMLElement, string>;\n\n    constructor() {\n        super();\n        this.innerHTML = template;\n        this.personenRenderer = new ArrayToElementRenderer(this,\n            (b: Person) => b.id,\n            b => new BalanceAnzeigeElement());\n    }\n\n    connectedCallback() {\n\n    }\n\n    disconnectedCallback() {\n\n    }\n\n    setBalance(personen: Person[]) {\n        this.personen = personen;\n        this.balanceRange = Math.max(...Object.values(personen).map(v => Math.abs(v.balance)));\n        this.updatesStyle();\n    }\n\n    private updatesStyle() {\n        this.personenRenderer.update(this.personen,\n            (e, b) => {\n                e.setAttribute(PersonNameAttribute, b.name);\n                e.setAttribute(BalanceAttribute, \"\" + b.balance);\n                e.setAttribute(BalanceRangeAttribute, \"\" + this.balanceRange);\n            });\n    }\n\n}\nexport const BalanceAnzeigeTagName = \"balance-anzeige\";\ncustomElements.define(BalanceAnzeigeTagName, BalanceAnzeige);\n","import templateContent from \"./BezahlungCard.html\";\nimport \"./BezahlungCard.scss\";\nimport { formatCurrency } from \"../../utils/formatCurrency\";\nimport { ReuseableTemplate } from \"../../utils/ReuseableTemplate\";\nimport { BezahlungStatus } from \"../../state/State\";\n\nexport const BeschreibungAttribute = \"beschreibung\";\nexport const WertAttribute = \"wert\";\nexport const BezahlendePersonAttribute = \"bezahlende-person\";\nexport const EmpfaengerAttribute = \"empfaenger\";\nexport const StatusAttribute = \"status\";\nexport const BezahlungIdAttribute = \"bezahlung-id\";\n\ninterface AttributeStore {\n    bezahlendePerson: string;\n    beschreibung: string;\n    wert: number;\n    empfaenger: string;\n    status: string;\n}\n\nconst template = new ReuseableTemplate(templateContent);\n\nexport class BezahlungCard extends HTMLElement {\n    private attributeStore: AttributeStore;\n    private wertElement: HTMLSpanElement;\n    private empfaengerElement: HTMLSpanElement;\n    private bezahlendePersonElement: HTMLSpanElement;\n    private beschreibungElement: HTMLDivElement;\n    private doneElement: HTMLSpanElement;\n    private doneAllElement: HTMLSpanElement;\n    private syncElement: HTMLSpanElement;\n    private clickListener: (e: MouseEvent) => void;\n\n    constructor() {\n        super();\n        this.attributeStore = {\n            beschreibung: null,\n            bezahlendePerson: null,\n            empfaenger: null,\n            wert: null,\n            status: null\n        };\n        this.appendChild(template.get());\n        this.beschreibungElement = this.querySelector(`[data-ref=\"beschreibung\"]`);\n        this.bezahlendePersonElement = this.querySelector(`[data-ref=\"bezahlende-person\"]`);\n        this.empfaengerElement = this.querySelector(`[data-ref=\"empfaenger\"]`);\n        this.wertElement = this.querySelector(`[data-ref=\"wert\"]`);\n        this.doneElement = this.querySelector(`[data-ref=\"icon-done\"]`);\n        this.doneAllElement = this.querySelector(`[data-ref=\"icon-done-all\"]`);\n        this.syncElement = this.querySelector(`[data-ref=\"icon-sync\"]`);\n    }\n\n    private onClick(e: MouseEvent) {\n        this.dispatchEvent(new CustomEvent(\"bezahlungclick\", { detail: this.getAttribute(BezahlungIdAttribute), bubbles: true }));\n    }\n\n    connectedCallback() {\n        this.clickListener = e => this.onClick(e);\n        this.addEventListener(\"click\", this.clickListener);\n    }\n\n    disconnectedCallback() {\n        this.removeEventListener(\"click\", this.clickListener);\n    }\n\n    attributeChangedCallback() {\n        this.updateAttributes();\n    }\n\n    private checkChanged<K extends keyof AttributeStore>(prop: K, getAtt: () => AttributeStore[K]) {\n        let att = getAtt();\n        if (this.attributeStore[prop] != att) {\n            this.attributeStore[prop] = att;\n            return true;\n        }\n        return false;\n    }\n\n    private updateAttributes() {\n        let changed = [\n            this.checkChanged(\"bezahlendePerson\", () => this.getAttribute(BezahlendePersonAttribute)),\n            this.checkChanged(\"beschreibung\", () => this.getAttribute(BeschreibungAttribute)),\n            this.checkChanged(\"wert\", () => parseFloat(this.getAttribute(WertAttribute))),\n            this.checkChanged(\"empfaenger\", () => this.getAttribute(EmpfaengerAttribute)),\n            this.checkChanged(\"status\", () => this.getAttribute(StatusAttribute))\n        ].some(v => v);\n        if (changed) {\n            this.updatesStyle();\n        }\n    }\n\n    static get observedAttributes() {\n        return [BeschreibungAttribute, BezahlendePersonAttribute, WertAttribute, EmpfaengerAttribute, StatusAttribute];\n    }\n\n    private updatesStyle() {\n        this.beschreibungElement.innerText = this.attributeStore.beschreibung;\n        this.bezahlendePersonElement.innerText = this.attributeStore.bezahlendePerson;\n        this.wertElement.innerText = formatCurrency(this.attributeStore.wert);\n        this.empfaengerElement.innerText = this.attributeStore.empfaenger;\n        this.doneAllElement.style.display = this.attributeStore.status == BezahlungStatus.Gespeichert ? \"inline\" : \"none\";\n        this.doneElement.style.display = this.attributeStore.status == BezahlungStatus.Zwischengespeichert ? \"inline\" : \"none\";\n        this.syncElement.style.display = this.attributeStore.status == BezahlungStatus.Speichern ? \"inline\" : \"none\";\n    }\n\n}\nexport const BezahlungCardTagName = \"bezahlung-card\";\ncustomElements.define(BezahlungCardTagName, BezahlungCard);\n","import toDate from '../toDate/index.js';\nimport toInteger from '../_lib/toInteger/index.js';\nimport requiredArgs from '../_lib/requiredArgs/index.js';\n/**\n * @name startOfWeek\n * @category Week Helpers\n * @summary Return the start of a week for the given date.\n *\n * @description\n * Return the start of a week for the given date.\n * The result will be in the local timezone.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the original date\n * @param {Object} [options] - an object with options.\n * @param {Locale} [options.locale=defaultLocale] - the locale object. See [Locale]{@link https://date-fns.org/docs/Locale}\n * @param {0|1|2|3|4|5|6} [options.weekStartsOn=0] - the index of the first day of the week (0 - Sunday)\n * @returns {Date} the start of a week\n * @throws {TypeError} 1 argument required\n * @throws {RangeError} `options.weekStartsOn` must be between 0 and 6\n *\n * @example\n * // The start of a week for 2 September 2014 11:55:00:\n * var result = startOfWeek(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Sun Aug 31 2014 00:00:00\n *\n * @example\n * // If the week starts on Monday, the start of the week for 2 September 2014 11:55:00:\n * var result = startOfWeek(new Date(2014, 8, 2, 11, 55, 0), { weekStartsOn: 1 })\n * //=> Mon Sep 01 2014 00:00:00\n */\n\nexport default function startOfWeek(dirtyDate, dirtyOptions) {\n  requiredArgs(1, arguments);\n  var options = dirtyOptions || {};\n  var locale = options.locale;\n  var localeWeekStartsOn = locale && locale.options && locale.options.weekStartsOn;\n  var defaultWeekStartsOn = localeWeekStartsOn == null ? 0 : toInteger(localeWeekStartsOn);\n  var weekStartsOn = options.weekStartsOn == null ? defaultWeekStartsOn : toInteger(options.weekStartsOn); // Test if weekStartsOn is between 0 and 6 _and_ is not NaN\n\n  if (!(weekStartsOn >= 0 && weekStartsOn <= 6)) {\n    throw new RangeError('weekStartsOn must be between 0 and 6 inclusively');\n  }\n\n  var date = toDate(dirtyDate);\n  var day = date.getDay();\n  var diff = (day < weekStartsOn ? 7 : 0) + day - weekStartsOn;\n  date.setDate(date.getDate() - diff);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}","export function groupBy<T, K extends keyof T>(list: T[], key: K) {\n    const map = new Map<T[K], T[]>();\n    list.forEach((item) => {\n        const k = item[key];\n        const collection = map.get(k);\n        if (!collection) {\n            map.set(k, [item]);\n        } else {\n            collection.push(item);\n        }\n    });\n    return map;\n}\n","import template from \"./BezahlungenGroup.html\";\nimport \"../BezahlungCard/BezahlungCard\";\nimport { BezahlungViewModel } from \"./BezahlungViewModel\";\nimport { ArrayToElementRenderer } from \"../../utils/ArrayToElementRenderer\";\nimport { BeschreibungAttribute, BezahlendePersonAttribute, BezahlungCard, BezahlungIdAttribute, EmpfaengerAttribute, StatusAttribute, WertAttribute } from \"../BezahlungCard/BezahlungCard\";\n\nexport class BezahlungenGroup extends HTMLElement {\n    private container: HTMLDivElement;\n    private titleElement: HTMLHeadingElement;\n    private bezahlungenRenderer: ArrayToElementRenderer<BezahlungViewModel, BezahlungCard, string>;\n\n\n    constructor() {\n        super();\n        this.innerHTML = template;\n        this.container = this.querySelector(`[data-ref=\"container\"]`);\n        this.titleElement = this.querySelector(`[data-ref=\"title\"]`);\n        this.bezahlungenRenderer = new ArrayToElementRenderer(this.container,\n            (b: BezahlungViewModel) => b.id,\n            b => new BezahlungCard());\n    }\n\n    connectedCallback() {\n\n    }\n\n    disconnectedCallback() {\n\n    }\n\n\n    setBezahlungen(bezahlungen: BezahlungViewModel[]) {\n        this.bezahlungenRenderer.update(bezahlungen, (e, b) => {\n            e.setAttribute(BeschreibungAttribute, b.beschreibung);\n            e.setAttribute(WertAttribute, \"\" + b.wert);\n            e.setAttribute(BezahlendePersonAttribute, b.bezahlendePersonName);\n            e.setAttribute(EmpfaengerAttribute, b.empfaenger);\n            e.setAttribute(StatusAttribute, b.status);\n            e.setAttribute(BezahlungIdAttribute, b.id);\n        });\n    }\n\n    set title(t: string) {\n        this.titleElement.innerText = t;\n    }\n\n}\nexport const BezahlungenGroupTagName = \"bezahlungen-group\";\ncustomElements.define(BezahlungenGroupTagName, BezahlungenGroup);\n","import template from \"./BezahlungenView.html\";\nimport \"./BezahlungenView.scss\";\nimport \"../BezahlungCard/BezahlungCard\";\nimport { Bezahlung, Person } from \"../../state/State\";\nimport { addDays, startOfToday, startOfDay, startOfWeek, endOfWeek } from \"date-fns\";\nimport { groupBy } from \"../../utils/groupBy\";\nimport \"./BezahlungenGroup\";\nimport { BezahlungViewModel } from \"./BezahlungViewModel\";\nimport { ArrayToElementRenderer } from \"../../utils/ArrayToElementRenderer\";\nimport { BezahlungenGroup } from \"./BezahlungenGroup\";\n\nexport class BezahlungenView extends HTMLElement {\n    private minEintraege: number;\n    private minTage: number;\n    private all: boolean;\n    private bezahlungen: Bezahlung[];\n    private personen: Person[];\n    private bezahlungenContainer: HTMLDivElement;\n    private showMoreButton: HTMLButtonElement;\n    private groupRenderer: ArrayToElementRenderer<[number, BezahlungViewModel[]], BezahlungenGroup, string>;\n\n    constructor() {\n        super();\n        this.minTage = 3;\n        this.minEintraege = 20;\n        this.all = false;\n        this.innerHTML = template;\n        this.bezahlungenContainer = this.querySelector(\"#bezahlungen-container\");\n        this.showMoreButton = this.querySelector(\"#show-more\");\n        this.showMoreClick = this.showMoreClick.bind(this);\n        this.groupRenderer = new ArrayToElementRenderer(this.bezahlungenContainer,\n            (s: [number, BezahlungViewModel[]]) => \"\" + s[0], () => new BezahlungenGroup());\n    }\n\n    connectedCallback() {\n        this.showMoreButton.addEventListener(\"click\", this.showMoreClick);\n    }\n\n    disconnectedCallback() {\n\n    }\n\n    private setShowMoreButtonDisplay() {\n        if (this.bezahlungen) {\n            this.showMoreButton.style.display = this.bezahlungen.length > this.anzahlEintraege ? \"inline\" : \"none\";\n        }\n    }\n\n    showMoreClick() {\n        let last: BezahlungenGroup = <BezahlungenGroup>this.bezahlungenContainer.lastElementChild;\n        this.anzahlEintraege += 20;\n        if (last) {\n            last.scrollIntoView({ behavior: \"smooth\" });\n        }\n        this.setShowMoreButtonDisplay();\n    }\n\n    private formatEmpfaenger(z: Bezahlung, personen: Person[]) {\n        if (z.empfaengerIds.length == personen.length) {\n            return \"alle\";\n        }\n        return z.empfaengerIds.map(id => personen.find(p => p.id == id).name).join(\", \");\n    }\n\n    setBezahlungen(bezahlungen: Bezahlung[], personen: Person[]) {\n        this.bezahlungen = bezahlungen;\n        this.personen = personen;\n        this.setShowMoreButtonDisplay();\n        this.render();\n    }\n\n    private render() {\n        let sorted = this.bezahlungen.sort((a, b) => +b.zeitpunkt - +a.zeitpunkt);\n\n        let filtered = sorted;\n        if (!this.all) {\n            filtered = sorted.filter(z => z.zeitpunkt > addDays(startOfToday(), -this.minTage));\n            if (filtered.length < this.minEintraege) {\n                filtered = sorted.slice(0, this.minEintraege)\n            }\n        }\n\n        let mapped = filtered.map(z => {\n            let x: BezahlungViewModel = {\n                bezahlendePersonName: this.personen.find(p => p.id == z.bezahlendePersonId).name,\n                wert: z.wert,\n                beschreibung: z.beschreibung,\n                empfaenger: this.formatEmpfaenger(z, this.personen),\n                tag: +startOfDay(z.zeitpunkt),\n                id: z.id,\n                woche: +startOfWeek(z.zeitpunkt),\n                status: z.status\n            };\n            return x;\n        });\n\n        let isWeek = false;\n        let grouped = Array.of(...groupBy(mapped, \"tag\").entries());\n        let avgGroupSize = grouped.reduce((p, c) => p + c[1].length, 0) / grouped.length;\n        if (avgGroupSize < 3) {\n            grouped = Array.of(...groupBy(mapped, \"woche\").entries());\n            isWeek = true;\n        }\n        let sortedGroups = grouped.sort((a, b) => b[0] - a[0]);\n        this.groupRenderer.update(sortedGroups,\n            (e, d) => {\n                e.setBezahlungen(d[1]);\n                if (isWeek) {\n                    e.title = this.formatWeek(new Date(d[0]));\n                }\n                else {\n\n                    e.title = this.formatDay(new Date(d[0]));\n                }\n            });\n\n    }\n\n    get anzahlEintraege() {\n        return this.minEintraege;\n    }\n\n    set anzahlEintraege(val: number) {\n        this.minEintraege = val;\n        this.render();\n    }\n\n\n    private formatWeek(date: Date) {\n        let endWeek = endOfWeek(date);\n        let weekformat: string;\n        const dayAndMonth = (d: Date) => new Intl.DateTimeFormat([\"de-AT\"], { day: \"numeric\", month: \"long\" }).format(d);\n        if (endWeek.getMonth() == date.getMonth()) {\n            weekformat = `${new Intl.DateTimeFormat([\"de-AT\"], { day: \"numeric\" }).format(date)}. - ${dayAndMonth(endWeek)}`;\n        }\n        else {\n            weekformat = `${dayAndMonth(date)} - ${dayAndMonth(endWeek)}`;\n        }\n        return weekformat;\n    }\n\n    private formatDay(date: Date) {\n        return new Intl.DateTimeFormat([\"de-AT\"], { weekday: \"short\", year: \"numeric\", month: \"2-digit\", day: \"2-digit\" }).format(date);\n    }\n}\nexport const BezahlungenViewTagName = \"bezahlungen-view\";\ncustomElements.define(BezahlungenViewTagName, BezahlungenView);\n","import toInteger from '../_lib/toInteger/index.js';\nimport toDate from '../toDate/index.js';\nimport requiredArgs from '../_lib/requiredArgs/index.js';\n/**\n * @name addDays\n * @category Day Helpers\n * @summary Add the specified number of days to the given date.\n *\n * @description\n * Add the specified number of days to the given date.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the date to be changed\n * @param {Number} amount - the amount of days to be added. Positive decimals will be rounded using `Math.floor`, decimals less than zero will be rounded using `Math.ceil`.\n * @returns {Date} the new date with the days added\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // Add 10 days to 1 September 2014:\n * var result = addDays(new Date(2014, 8, 1), 10)\n * //=> Thu Sep 11 2014 00:00:00\n */\n\nexport default function addDays(dirtyDate, dirtyAmount) {\n  requiredArgs(2, arguments);\n  var date = toDate(dirtyDate);\n  var amount = toInteger(dirtyAmount);\n\n  if (isNaN(amount)) {\n    return new Date(NaN);\n  }\n\n  if (!amount) {\n    // If 0 days, no-op to avoid changing times in the hour before end of DST\n    return date;\n  }\n\n  date.setDate(date.getDate() + amount);\n  return date;\n}","import startOfDay from '../startOfDay/index.js';\n/**\n * @name startOfToday\n * @category Day Helpers\n * @summary Return the start of today.\n * @pure false\n *\n * @description\n * Return the start of today.\n *\n * > ⚠️ Please note that this function is not present in the FP submodule as\n * > it uses `Date.now()` internally hence impure and can't be safely curried.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @returns {Date} the start of today\n *\n * @example\n * // If today is 6 October 2014:\n * var result = startOfToday()\n * //=> Mon Oct 6 2014 00:00:00\n */\n\nexport default function startOfToday() {\n  return startOfDay(Date.now());\n}","import toDate from '../toDate/index.js';\nimport toInteger from '../_lib/toInteger/index.js';\nimport requiredArgs from '../_lib/requiredArgs/index.js';\n/**\n * @name endOfWeek\n * @category Week Helpers\n * @summary Return the end of a week for the given date.\n *\n * @description\n * Return the end of a week for the given date.\n * The result will be in the local timezone.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the original date\n * @param {Object} [options] - an object with options.\n * @param {Locale} [options.locale=defaultLocale] - the locale object. See [Locale]{@link https://date-fns.org/docs/Locale}\n * @param {0|1|2|3|4|5|6} [options.weekStartsOn=0] - the index of the first day of the week (0 - Sunday)\n * @returns {Date} the end of a week\n * @throws {TypeError} 1 argument required\n * @throws {RangeError} `options.weekStartsOn` must be between 0 and 6\n *\n * @example\n * // The end of a week for 2 September 2014 11:55:00:\n * var result = endOfWeek(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Sat Sep 06 2014 23:59:59.999\n *\n * @example\n * // If the week starts on Monday, the end of the week for 2 September 2014 11:55:00:\n * var result = endOfWeek(new Date(2014, 8, 2, 11, 55, 0), { weekStartsOn: 1 })\n * //=> Sun Sep 07 2014 23:59:59.999\n */\n\nexport default function endOfWeek(dirtyDate, dirtyOptions) {\n  requiredArgs(1, arguments);\n  var options = dirtyOptions || {};\n  var locale = options.locale;\n  var localeWeekStartsOn = locale && locale.options && locale.options.weekStartsOn;\n  var defaultWeekStartsOn = localeWeekStartsOn == null ? 0 : toInteger(localeWeekStartsOn);\n  var weekStartsOn = options.weekStartsOn == null ? defaultWeekStartsOn : toInteger(options.weekStartsOn); // Test if weekStartsOn is between 0 and 6 _and_ is not NaN\n\n  if (!(weekStartsOn >= 0 && weekStartsOn <= 6)) {\n    throw new RangeError('weekStartsOn must be between 0 and 6 inclusively');\n  }\n\n  var date = toDate(dirtyDate);\n  var day = date.getDay();\n  var diff = (day < weekStartsOn ? -7 : 0) + 6 - (day - weekStartsOn);\n  date.setDate(date.getDate() + diff);\n  date.setHours(23, 59, 59, 999);\n  return date;\n}","import { Store } from \"../Store\";\nimport { ApiClient } from \"../../api/ApiClient\";\nimport { Action } from \"../lib/Action\";\nimport { KontokorrentDatabase } from \"../../lib/KontokorrentDatabase\";\nimport { Bezahlung, BezahlungStatus } from \"../State\";\nimport { filterBezahlungen } from \"../../lib/filterBezahlungen\";\nimport { KontokorrentBalance } from \"../../lib/KontokorrentBalance\";\nimport { ServiceLocator } from \"../../ServiceLocator\";\nimport { ActionNames } from \"./ActionNames\";\nimport { WorkerService, workerServiceFactory } from \"../../lib/WorkerService\";\n\nexport class KontokorrentGeoeffnet implements Action {\n    readonly type = ActionNames.KontokorrentGeoeffnet;\n    constructor(public id: string) {\n\n    }\n}\n\nexport class KontokorrentBezahlungen implements Action {\n    readonly type = ActionNames.KontokorrentBezahlungen;\n    constructor(public kontokorrentId: string, public bezahlungen: Bezahlung[]) {\n\n    }\n}\n\nexport class KontokorrentSynchronisieren implements Action {\n    readonly type = ActionNames.KontokorrentSynchronisieren;\n    constructor(public kontokorrentId: string) {\n\n    }\n}\n\nexport class KontokorrentSynchronisiert implements Action {\n    readonly type = ActionNames.KontokorrentSynchronisiert;\n    constructor(public kontokorrentId: string) {\n\n    }\n}\n\nexport class KontokorrentBalanceAktualisiert implements Action {\n    readonly type = ActionNames.KontokorrentBalanceAktualisiert;\n    constructor(public kontokorrentId: string, public balance: KontokorrentBalance) {\n\n    }\n}\n\nexport type KontokorrentActions =\n    | KontokorrentGeoeffnet\n    | KontokorrentBezahlungen\n    | KontokorrentSynchronisieren\n    | KontokorrentSynchronisiert\n    | KontokorrentBalanceAktualisiert;\n\nexport class KontokorrentActionCreator {\n\n    constructor(private store: Store,\n        private apiClient: ApiClient,\n        private db: KontokorrentDatabase,\n        private workerService: WorkerService) {\n\n    }\n    private async refreshBezahlungen(id: string) {\n        let aktionen = filterBezahlungen(await this.db.getAktionen(id)).map(b => {\n            return {\n                ...b,\n                status: BezahlungStatus.Gespeichert\n            };\n        });\n        let zwischengespeicherte = (await this.db.getZwischengespeicherteBezahlungenForKontokorrent(id)).map(b => {\n            let x: Bezahlung = {\n                status: BezahlungStatus.Zwischengespeichert,\n                beschreibung: b.beschreibung,\n                bezahlendePersonId: b.bezahlendePersonId,\n                empfaengerIds: b.empfaengerIds,\n                id: b.id,\n                wert: b.wert,\n                zeitpunkt: b.zeitpunkt\n            };\n            return x;\n        }).filter(b => !aktionen.some(a => a.id == b.id));\n        this.store.dispatch(new KontokorrentBezahlungen(id, [...aktionen, ...zwischengespeicherte]));\n    }\n\n    private async calculateBalance(id: string) {\n        let balance = await (await this.workerService.getWorker()).calculateBalance(id);\n        this.store.dispatch(new KontokorrentBalanceAktualisiert(id, balance));\n    }\n\n    private async refreshKontokorrent(id: string) {\n        await Promise.all([this.refreshBezahlungen(id), this.calculateBalance(id)]);\n    }\n\n    private async kontokorrentSynchronisieren(id: string) {\n        this.store.dispatch(new KontokorrentSynchronisieren(id));\n        let laufendeNummer = await (await this.workerService.getWorker()).getLaufendeNummer(id);\n        let res = await this.apiClient.getAktionen(id, laufendeNummer);\n        if (res.success) {\n            await this.db.addAktionen(id, res.aktionen);\n            if (res.aktionen.length > 0) {\n                await this.refreshKontokorrent(id);\n            }\n        }\n        this.store.dispatch(new KontokorrentSynchronisiert(id));\n    }\n\n\n\n    async kontokorrentOeffnen(id: string) {\n        let kk = await this.db.getKontokorrent(id);\n        if (null != kk) {\n            this.store.dispatch(new KontokorrentGeoeffnet(id));\n            let tasks = [];\n            tasks.push(this.db.setZuletztGesehenerKontokorrentId(id));\n            tasks.push(this.refreshKontokorrent(id));\n            tasks.push(this.kontokorrentSynchronisieren(id));\n            await Promise.all(tasks);\n        }\n    }\n}\n\nexport function kontokorrentActionCreatorFactory(serviceLocator: ServiceLocator) {\n    return serviceLocator.get(\"KontokorrentActionCreator\",\n        serviceLocator => new KontokorrentActionCreator(\n            serviceLocator.store,\n            serviceLocator.apiClient,\n            serviceLocator.db,\n            workerServiceFactory(serviceLocator)\n        ));\n}","import { BezahlungDbModel } from \"./BezahlungDbModel\";\nimport { AktionDbModel } from \"./AktionDbModel\";\n\nexport function filterBezahlungen(aktionen: AktionDbModel[]) {\n    let bezahlungenMap: { [id: string]: BezahlungDbModel } = {};\n    let ordered = aktionen.sort((a,b)=> a.laufendeNummer - b.laufendeNummer);\n    for (let b of ordered) {\n        if (b.bearbeiteteBezahlungId) {\n            delete bezahlungenMap[b.bearbeiteteBezahlungId];\n        }\n        if (b.geloeschteBezahlungId) {\n            delete bezahlungenMap[b.geloeschteBezahlungId];\n        }\n        else {\n            bezahlungenMap[b.bezahlung.id] = b.bezahlung;\n        }\n    }\n    let bezahlungen = Object.values(bezahlungenMap);\n    return bezahlungen;\n}","import template from \"./KontokorrentPage.html\";\nimport { Store } from \"../../state/Store\";\nimport { ServiceLocator } from \"../../ServiceLocator\";\nimport { RoutingActionCreator, routingActionCreatorFactory } from \"../../state/actions/RoutingActionCreator\";\nimport { KontokorrentState, State } from \"../../state/State\";\nimport { convertLinks } from \"../convertLinks\";\nimport { AppBar, AppBarTagName } from \"../AppBar/AppBar\";\nimport \"../BalanceAnzeige/BalanceAnzeigeElement\";\nimport { BalanceAnzeige } from \"../BalanceAnzeige/BalanceAnzeige\";\nimport \"../BalanceAnzeige/BalanceAnzeige\";\nimport \"../BezahlungenView/BezahlungenView\";\nimport { BezahlungenView } from \"../BezahlungenView/BezahlungenView\";\nimport \"./KontokorrentPage.scss\";\nimport { KontokorrentActionCreator, kontokorrentActionCreatorFactory } from \"../../state/actions/KontokorrentActionCreator\";\nimport { KontokorrentListenActionCreator, kontokorrentListenActionCreatorFactory } from \"../../state/actions/KontokorrentListenActionCreator\";\n\nexport class KontokorrentPage extends HTMLElement {\n    private store: Store;\n    private subscription: () => void;\n    private routingActionCreator: RoutingActionCreator;\n    private kontokorrentActionCreator: KontokorrentActionCreator;\n    private appBar: AppBar;\n    private balanceAnzeige: BalanceAnzeige;\n    private bezahlungenView: BezahlungenView;\n    private kontokorrentSpinner: HTMLSpanElement;\n    private kontokorrent: KontokorrentState;\n    private kontokorrentIdParameter: string;\n    private kontokorrentListenActionCreator: KontokorrentListenActionCreator;\n    private bezahlungClickListener: (e: CustomEvent) => void;\n\n    constructor() {\n        super();\n        this.innerHTML = template;\n        this.appBar = this.querySelector(AppBarTagName);\n        this.balanceAnzeige = this.querySelector(\"#balance-anzeige\");\n        this.bezahlungenView = this.querySelector(\"#bezahlungen-view\");\n        this.kontokorrentSpinner = this.querySelector(\"#spinner\");\n    }\n\n    addServices(serviceLocator: ServiceLocator) {\n        this.store = serviceLocator.store;\n        this.routingActionCreator = routingActionCreatorFactory(serviceLocator);\n        this.kontokorrentActionCreator = kontokorrentActionCreatorFactory(serviceLocator);\n        this.kontokorrentListenActionCreator = kontokorrentListenActionCreatorFactory(serviceLocator);\n        this.appBar.addServices(serviceLocator);\n    }\n\n    private bezahlungClick(id: string) {\n        this.routingActionCreator.navigateBezahlung(this.kontokorrentIdParameter, id);\n    }\n\n    connectedCallback() {\n        if (!this.kontokorrentIdParameter) {\n            this.kontokorrentListenActionCreator.navigiereZuLetztGesehenem(true);\n        }\n        this.subscription = this.store.subscribe(null, state => this.applyStoreState(state));\n        this.appBar.addEventListener(\"gotokontokorrent\", (e: CustomEvent) => {\n            this.routingActionCreator.navigateKontokorrent(e.detail);\n        });\n        convertLinks(this.querySelectorAll(\"#eintragen-desktop, #eintragen-mobile\"), this.routingActionCreator);\n        this.applyStoreState(this.store.state);\n        this.bezahlungClickListener = e => this.bezahlungClick(e.detail);\n        this.bezahlungenView.addEventListener(\"bezahlungclick\", this.bezahlungClickListener);\n    }\n\n    private applyStoreState(state: State) {\n        this.kontokorrent = state.kontokorrents.kontokorrents[state.kontokorrents.activeKontokorrentId];\n        if (this.kontokorrent) {\n            document.title = `${this.kontokorrent.name} - Kontokorrent`;\n            if (this.kontokorrent.personen) {\n                this.balanceAnzeige.setBalance(this.kontokorrent.personen);\n                this.bezahlungenView.setBezahlungen(this.kontokorrent.bezahlungen, this.kontokorrent.personen);\n            }\n            this.kontokorrentSpinner.style.display = this.kontokorrent.synchronisieren ? \"flex\" : \"none\";\n        }\n    }\n\n    setRouteParameters(id: string) {\n        this.kontokorrentActionCreator.kontokorrentOeffnen(id);\n        this.kontokorrentIdParameter = id;\n    }\n\n    disconnectedCallback() {\n        this.subscription();\n        this.bezahlungenView.removeEventListener(\"bezahlungclick\", this.bezahlungClickListener);\n    }\n}\n\ncustomElements.define('kontokorrent-page', KontokorrentPage);\n","import { RoutingActionCreator } from \"../state/actions/RoutingActionCreator\";\n\nexport function convertLinks(elements: Array<HTMLAnchorElement> | NodeListOf<HTMLAnchorElement>, routingActionCreator: RoutingActionCreator) {\n    elements.forEach((e: HTMLAnchorElement) => {\n        e.addEventListener(\"click\", ev => {\n            ev.preventDefault();\n            routingActionCreator.navigate(e.getAttribute(\"href\"));\n        });\n    });\n}","export class Popup extends HTMLElement {\n    private popupShown: boolean = false;\n    constructor() {\n        super();\n        this.keyListener = this.keyListener.bind(this);\n        this.clickListener = this.clickListener.bind(this);\n    }\n\n    connectedCallback() {\n        this.updateStyles();\n    }\n\n    private keyListener(ev: KeyboardEvent) {\n        if (ev.key == \"Escape\") {\n            this.hide();\n        }\n    }\n\n    private clickListener(ev: MouseEvent | TouchEvent) {\n        if (!this.contains(<Element>(event.target))) {\n            this.hide();\n        }\n    }\n\n    public hide() {\n        if (this.popupShown) {\n            document.removeEventListener(\"keydown\", this.keyListener);\n            document.removeEventListener(\"click\", this.clickListener);\n            this.popupShown = false;\n            this.updateStyles();\n        }\n    }\n\n    public show() {\n        if (!this.popupShown) {\n            document.addEventListener(\"keydown\", this.keyListener);\n            document.addEventListener(\"click\", this.clickListener);\n            this.popupShown = true;\n            this.updateStyles();\n        }\n    }\n\n    private updateStyles() {\n        this.style.display = this.popupShown ? \"block\" : \"none\";\n    }\n\n    public toggle() {\n        if (!this.popupShown) {\n            this.show();\n        }\n        else {\n            this.hide();\n\n        }\n    }\n\n    disconnectedCallback() {\n        this.hide();\n    }\n}\ncustomElements.define(\"app-popup\", Popup);\n","type KontokorrentWorkerApi = import(\"../worker/KontokorrentWorker\").KontokorrentWorkerApi;\nimport { wrap } from \"comlink\";\nimport { ServiceLocator } from \"../ServiceLocator\";\nimport { Store } from \"../state/Store\";\n\nexport class WorkerService {\n    constructor(private store: Store) {\n\n    }\n    private workerApi: KontokorrentWorkerApi;\n\n    async getWorker() {\n        if (this.workerApi) {\n            return this.workerApi;\n        }\n        const worker = new Worker(new URL(\"../worker/KontokorrentWorker\", import.meta.url));\n        worker.addEventListener(\"message\", ev => {\n            if (ev.data?.type == \"statedispatch\") {\n                let msg = ev.data.msg;\n                this.store.dispatch(msg);\n            }\n        })\n        this.workerApi = wrap<KontokorrentWorkerApi>(worker);\n        return this.workerApi;\n    }\n}\n\nexport function workerServiceFactory(serviceLocator: ServiceLocator) {\n    return serviceLocator.get(\"WorkerService\",\n        serviceLocator => new WorkerService(serviceLocator.store));\n}","export class ArrayToElementRenderer<T, E extends Element, K>{\n    private keyToElement: Map<K, E>;\n    private elementToKey: WeakMap<E, K>;\n    \n    constructor(private listElement: HTMLElement,\n        private keySelector: (x: T) => K,\n        private createElement: (x: T) => E) {\n        this.keyToElement = new Map<K, E>();\n        this.elementToKey = new WeakMap<E, K>();\n    }\n\n    update(list: T[], updateElement: (x: E, data: T) => void) {\n        let keyCache = new Map<T, K>();\n        let getKey = (d: T) => keyCache.get(d) || (() => {\n            let key = this.keySelector(d);\n            keyCache.set(d, key);\n            return key;\n        })();\n        for (let x of Array.from(this.listElement.children)) {\n            let el: E = <E>x;\n            let data = list.find(i => this.elementToKey.get(el) == getKey(i));\n            if (data) {\n                updateElement(<E>el, data);\n            }\n            else {\n                this.listElement.removeChild(el);\n            }\n        }\n        let before: Element = null;\n        let nextKeyToElement = new Map<K, E>();\n        for (let t of list) {\n            let key = getKey(t);\n            let childElement: E = this.keyToElement.get(key);\n            if (!childElement) {\n                childElement = this.createElement(t);\n                updateElement(childElement, t);\n                this.elementToKey.set(childElement, key);\n            }\n            nextKeyToElement.set(key, childElement);\n            if (null == before && childElement != this.listElement.firstElementChild) {\n                this.listElement.prepend(childElement);\n            }\n            else if (null != before && before.nextElementSibling != childElement) {\n                before.insertAdjacentElement(\"afterend\", childElement);\n            }\n            before = childElement;\n        }\n        this.keyToElement = nextKeyToElement;\n    }\n\n}","export class ReuseableTemplate {\n    private instance: HTMLTemplateElement;\n    constructor(private readonly template: string) {\n    }\n\n    get(): DocumentFragment {\n        if (null == this.instance) {\n            this.instance = document.createElement(\"template\");\n            this.instance.innerHTML = this.template;\n        }\n        return document.importNode(this.instance.content, true);\n    }\n}\n","import { round } from \"./round\";\n\nexport function formatCurrency(wert: number) {\n    var Betrag: string = \"\" + round(wert, 2);\n    var Kommaindex = Betrag.toString().indexOf(\".\");\n    var Nachkommastellen = 0;\n    if (Kommaindex != -1) {\n        Nachkommastellen = Betrag.toString().length - (Kommaindex + 1);\n        if (Nachkommastellen == 1)\n            Betrag += '0';\n    }\n    return Betrag;\n}\n","export function round(value: number, decimals: number) {\n\n    //Removing scientific notation if used:\n    var valueString = value.toString();\n    var indexOfE = valueString.indexOf(\"E\");\n    var indexOfe = valueString.indexOf(\"e\");\n    var power = 0;\n    if (indexOfe > -1) {\n        power = parseFloat(valueString.substring(indexOfe + 1));\n        valueString = valueString.substring(0, indexOfe)\n    } else if (indexOfE > -1) {\n        power = parseFloat(valueString.substring(indexOfE + 1));\n        valueString = valueString.substring(0, indexOfE)\n    }\n    //round\n    return Number(Math.round(Number(valueString + 'e' + (power + decimals))) + 'e-' + (decimals));\n}","// Module\nvar code = \"<header class=\\\"app-bar\\\"> <kontokorrent-select class=\\\"app-bar__kontokorrent-select\\\"></kontokorrent-select> <nav class=\\\"app-bar__links\\\"> <button id=\\\"logout-button\\\" class=\\\"app-bar__link\\\" title=\\\"Logout\\\"> <span class=\\\"material-icons\\\"> exit_to_app </span> </button> <a href=\\\"info\\\" class=\\\"app-bar__link\\\" title=\\\"Informationen über diese App\\\"> <span class=\\\"material-icons\\\"> info </span> </a> </nav> </header> <app-popup id=\\\"logout-dialog\\\"> <div class=\\\"dialog__backdrop\\\"></div> <div class=\\\"dialog\\\"> <p> Wirklich aus allen Kontokorrents ausloggen? </p> <div class=\\\"dialog__button-pane\\\"> <button id=\\\"abort-logout\\\" class=\\\"button\\\">Abbrechen</button> <button id=\\\"confirm-logout\\\" class=\\\"button\\\">Ausloggen</button> </div> </div> </app-popup>\";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<div class=\\\"balance-anzeige-element__graphic-container\\\"> <div class=\\\"balance-anzeige-element__bar\\\" data-ref=\\\"bar\\\"></div> <div class=\\\"balance-anzeige-element__horizontal-line\\\"></div> <span class=\\\"balance-anzeige-element__balance\\\" data-ref=\\\"balance-container\\\"> <span data-ref=\\\"balance-text\\\"></span>€ </span> </div> <div class=\\\"balance-anzeige-element__text-container\\\"> <span data-ref=\\\"person-name\\\" class=\\\"balance-anzeige-element__name\\\"></span> </div>\";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<div class=\\\"balance-anzeige-element__graphic-container\\\"> <div class=\\\"balance-anzeige-element__bar\\\" data-ref=\\\"bar\\\"></div> <div class=\\\"balance-anzeige-element__horizontal-line\\\"></div> <span class=\\\"balance-anzeige-element__balance\\\" data-ref=\\\"balance-container\\\"> <span data-ref=\\\"balance-text\\\"></span>€ </span> </div> <div class=\\\"balance-anzeige-element__text-container\\\"> <span data-ref=\\\"person-name\\\" class=\\\"balance-anzeige-element__name\\\"></span> </div>\";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<div class=\\\"bezahlung-card__beschreibung\\\"> <div data-ref=\\\"beschreibung\\\"></div> <div class=\\\"bezahlung-card__personen\\\"> <span data-ref=\\\"bezahlende-person\\\"></span> für <span data-ref=\\\"empfaenger\\\"></span> </div> </div> <div class=\\\"bezahlung-card__col2\\\"> <div class=\\\"bezahlung-card__dummy\\\"></div> <div class=\\\"bezahlung-card__wert\\\"> <span data-ref=\\\"wert\\\"></span>€ </div> <div class=\\\"bezahlung-card__status\\\"> <span class=\\\"material-icons\\\" data-ref=\\\"icon-done\\\" style=\\\"display:none\\\" title=\\\"lokal zwischengespeichert\\\"> schedule </span> <span class=\\\"material-icons\\\" data-ref=\\\"icon-done-all\\\" style=\\\"display:none\\\" title=\\\"synchronisiert\\\"> done_all </span> <span class=\\\"material-icons\\\" data-ref=\\\"icon-sync\\\" style=\\\"display:none\\\" title=\\\"synchronisieren...\\\"> sync </span> </div> </div>\";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<h3 data-ref=\\\"title\\\" class=\\\"bezahlungen-group__title\\\">Gruppe</h3> <div class=\\\"bezahlungen-group__container\\\" data-ref=\\\"container\\\"></div>\";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<div id=\\\"bezahlungen-container\\\"> </div> <button id=\\\"show-more\\\" class=\\\"button\\\">Mehr anzeigen</button>\";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<app-bar></app-bar> <div style=\\\"display:none\\\" id=\\\"login-expired\\\">Google-Login abgelaufen: zum Synchronisieren neu anmelden</div> <balance-anzeige id=\\\"balance-anzeige\\\"></balance-anzeige> <div class=\\\"kontokorrentpage-menu\\\"> <a id=\\\"eintragen-desktop\\\" class=\\\"floating-action-button floating-action-button--embed\\\" href=\\\"eintragen\\\"> <span class=\\\"material-icons\\\"> add </span> eintragen </a> <span class=\\\"kontokorrentpage-menu__sync-display\\\" id=\\\"spinner\\\" style=\\\"display:none\\\"> <div class=\\\"spinner\\\"></div> synchronisieren </span> </div> <bezahlungen-view id=\\\"bezahlungen-view\\\"></bezahlungen-view> <a id=\\\"eintragen-mobile\\\" class=\\\"floating-action-button floating-action-button--fixed\\\" href=\\\"eintragen\\\"> <span class=\\\"material-icons\\\"> add </span> eintragen </a>\";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<div class=\\\"kontokorrent-select-wrapper\\\"> <div class=\\\"kontokorrent-select\\\"> <h1 data-ref=\\\"kontokorrent-name\\\" class=\\\"kontokorrent-select__name\\\">Kontokorrent</h1> <button class=\\\"kontokorrent-select__choose\\\" title=\\\"anderen Kontokorrent wählen\\\"> <span class=\\\"material-icons\\\"> arrow_drop_down </span> </button> </div> <app-popup class=\\\"kontokorrent-select__popup\\\"> <kontokorrent-select-list></kontokorrent-select-list> <div class=\\\"kontokorrent-select__buttons\\\"> <button id=\\\"add-kontokorrent\\\" class=\\\"button\\\">weiteren hinzufügen</button> </div> </app-popup> </div>\";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<ol data-ref=\\\"list\\\" class=\\\"kontokorrent-select-list\\\"> </ol>\";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<a data-ref=\\\"link\\\" class=\\\"kontokorrent-select-list__entry\\\"> <span data-ref=\\\"name\\\"></span> </a>\";\n// Exports\nmodule.exports = code;"],"sourceRoot":""}