"use strict";(self.webpackChunkkontokorrent=self.webpackChunkkontokorrent||[]).push([[90],{6520:function(e,t,n){n.r(t),n.d(t,{AusgleichErstellen:function(){return p}}),n(3948);var r=n(423),s=n(9773),i=n(2639),o=n(6029),a=n(2033);const h="bezahlender",u="empfaenger",l="wert";class c extends HTMLElement{constructor(){super(),this.rendered=!1}connectedCallback(){this.rendered||(this.rendered=!0,this.innerHTML='<span id="bezahlende-person"></span> <span id="zahlung"></span> <span id="empfaenger-person"></span>',this.bezahlendePersonDisplay=this.querySelector("#bezahlende-person"),this.empfaengerPersonDisplay=this.querySelector("#empfaenger-person"),this.zahlung=this.querySelector("#zahlung"),this.updateAttributes())}disconnectedCallback(){}attributeChangedCallback(){this.updateAttributes()}updateAttributes(){this.bezahlendePersonName=this.getAttribute(h),this.empfaengerPersonName=this.getAttribute(u),this.wert=this.getAttribute(l),this.updatesStyle()}static get observedAttributes(){return[h,u,l]}updatesStyle(){this.rendered&&(this.bezahlendePersonDisplay.innerText=this.bezahlendePersonName,this.empfaengerPersonDisplay.innerText=this.empfaengerPersonName,this.zahlung.innerText="bezahlt ".concat((0,a.x)(parseFloat(this.wert))," an"),this.zahlung.title="bezahlt ".concat((0,a.x)(parseFloat(this.wert))," an"))}}customElements.define("ausgleichs-zahung-display",c);var d=n(2204);class p extends HTMLElement{constructor(){super(),this.rendered=!1,this.navigiertZuNichtGefunden=!1}addServices(e){this.store=e.store,this.routingActionCreator=(0,s.b)(e),this.kontokorrentActionCreator=(0,r.l)(e),this.serviceLocator=e,this.optionen={geforderteZahlungen:[],mussZahlungen:[]}}connectedCallback(){this.rendered||(this.rendered=!0,this.innerHTML='<app-bar></app-bar> <div class="ausgleich-erstellen__ausgleich"> <div class="ausgleich-menu"> <a id="zurueck-zum-kontokorrent" class="button"> <span class="material-icons"> arrow_back </span> zurück </a> </div> <h2>Ausgleich</h2> <h3>Optionen</h3> <form id="optionen-form"> <div> <input type="radio" name="typ" value="bevorzugt" id="bevorzugt" required="required"> <label for="bevorzugt">Bevorzugt</label> <input type="radio" name="typ" value="muss" id="muss" required="required"> <label for="muss">Muss</label> </div> <div> <select name="bezahlender" id="bezahlender" required></select> bezahlt an <select name="empfaenger" id="empfaenger" required></select> </div> <div> <button type="submit" id="option-hinzufuegen-button">Option hinzufügen</button> </div> </form> <div id="optionen"> </div> <div> <label for="umrechnungskurs">Umrechnungskurs</label> <input type="number" id="umrechnungskurs" value="1"> </div> <h3>Zahlungen</h3> <ol id="zahlungen"> </ol> </div> <div class="ausgleich-erstellen__progress" id="ausgleich-progress"> <span class="spinner"></span> <span id="progress-label"></span> </div>',this.appBar=this.querySelector(i.W),this.appBar.addServices(this.serviceLocator),this.ausgleichProgress=this.querySelector("#ausgleich-progress"),this.ausgleichProgressLabel=this.querySelector("#progress-label"),this.zahlungen=this.querySelector("#zahlungen"),this.zahlungenRenderer=new o.T(this.zahlungen,(e=>"".concat(e.bezahlendePersonId,"-").concat(e.empfaengerPersonId)),(e=>{let t=document.createElement("li"),n=new c;return t.appendChild(n),t})),this.bezahlenderRenderer=new o.T(this.querySelector("#bezahlender"),(e=>e.id),(e=>document.createElement("option"))),this.empfaengerRenderer=new o.T(this.querySelector("#empfaenger"),(e=>e.id),(e=>document.createElement("option"))),this.zurueckLink=this.querySelector("#zurueck-zum-kontokorrent"),this.optionenForm=this.querySelector("#optionen-form"),this.optionenDisplay=this.querySelector("#optionen"),this.umrechnungskurs=this.querySelector("#umrechnungskurs")),(0,d.G)([this.zurueckLink],this.routingActionCreator),this.subscription=this.store.subscribe(null,(e=>this.applyStoreState(e))),this.appBar.addEventListener("gotokontokorrent",(async e=>{await this.routingActionCreator.navigateKontokorrentById(e.detail)})),this.umrechnungskurs.addEventListener("input",(e=>{this.kontokorrentActionCreator.ausgleichRechnen(this.oeffentlicherNameParameter,this.optionen)})),this.optionenForm.addEventListener("submit",(e=>{e.preventDefault();let t=new FormData(this.optionenForm);"muss"==t.get("typ")?this.optionen.mussZahlungen.push({bezahlendePersonId:t.get("bezahlender"),empfaengerPersonId:t.get("empfaenger")}):this.optionen.geforderteZahlungen.push({bezahlendePersonId:t.get("bezahlender"),empfaengerPersonId:t.get("empfaenger")}),this.kontokorrentActionCreator.ausgleichRechnen(this.oeffentlicherNameParameter,this.optionen)})),this.applyStoreState(this.store.state)}applyStoreState(e){let t=!1,n=e.kontokorrents.kontokorrents[e.kontokorrents.activeKontokorrentId];if(n){document.title="".concat(n.name," - Ausgleich"),t=n.ausgleichBerechnen,this.ausgleichProgressLabel.innerText=n.synchronisieren?"".concat(n.name," wird synchronisiert"):"Ausgleich wird berechnet",n.ausgleich&&this.zahlungenRenderer.update(n.ausgleich.ausgleichZahlungen,((e,t)=>{let r=e.children[0];r.setAttribute(h,n.personen.find((e=>e.id==t.bezahlendePersonId)).name),r.setAttribute(u,n.personen.find((e=>e.id==t.empfaengerPersonId)).name),r.setAttribute(l,"".concat(t.wert/(parseFloat(this.umrechnungskurs.value)||1)))})),this.zurueckLink.href="kontokorrents/o/".concat(n.oeffentlicherName),this.bezahlenderRenderer.update(n.personen,((e,t)=>{e.value=t.id,e.innerText=t.name})),this.empfaengerRenderer.update(n.personen,((e,t)=>{e.value=t.id,e.innerText=t.name})),this.optionenDisplay.innerHTML="";for(let e of this.optionen.mussZahlungen){let t=document.createElement("div");t.innerText="".concat(n.personen.find((t=>t.id==e.bezahlendePersonId)).name," muss an ").concat(n.personen.find((t=>t.id==e.empfaengerPersonId)).name," zahlen"),this.optionenDisplay.appendChild(t)}for(let e of this.optionen.geforderteZahlungen){let t=document.createElement("div");t.innerText="Bevorzugte Zahlungen zwsichen ".concat(n.personen.find((t=>t.id==e.bezahlendePersonId)).name," und ").concat(n.personen.find((t=>t.id==e.empfaengerPersonId)).name),this.optionenDisplay.appendChild(t)}}e.kontokorrents.nichtGefunden&&!this.navigiertZuNichtGefunden&&(this.navigiertZuNichtGefunden=!0,this.routingActionCreator.navigateNichtGefunden(e.kontokorrents.nichtGefunden.oeffentlicherName)),this.ausgleichProgress.style.display=t?"":"none"}setRouteParameters(e){this.oeffentlicherNameParameter=e,this.kontokorrentActionCreator.ausgleichRechnen(e,this.optionen)}disconnectedCallback(){this.subscription()}}customElements.define("ausgleich-erstellen",p)},2204:function(e,t,n){function r(e,t){e.forEach((e=>{e.addEventListener("click",(n=>{n.preventDefault(),t.navigate(e.getAttribute("href"))}))}))}n.d(t,{G:function(){return r}})},8059:function(e,t,n){n.d(t,{G:function(){return s}}),n(3948),n(285);class r{constructor(e){this.store=e}getWorker(){return this.worker||(this.worker=new Worker(new URL(n.p+n.u(81),n.b)),this.worker.addEventListener("message",(e=>{var t;if("statedispatch"==(null===(t=e.data)||void 0===t?void 0:t.type)){let t=e.data.msg;this.store.dispatch(t)}}))),this.worker}getBeschreibungVorschlaege(e,t){let n={kontokorrentId:e,type:1,eingabe:t};this.getWorker().postMessage(n)}resetBeschreibungenCache(){this.getWorker().postMessage({type:2})}kontokorrentOeffnen(e){let t={type:0,oeffentlicherName:e};this.getWorker().postMessage(t)}ausgleichRechnen(e,t){let n={type:3,oeffentlicherName:e,ausgleichOptions:t};this.getWorker().postMessage(n)}}function s(e){return e.get("WorkerService",(e=>new r(e.store)))}},423:function(e,t,n){n.d(t,{l:function(){return i}});var r=n(8059);class s{constructor(e){this.workerService=e}kontokorrentOeffnen(e){this.workerService.kontokorrentOeffnen(e)}ausgleichRechnen(e,t){this.workerService.ausgleichRechnen(e,t)}}function i(e){return e.get("KontokorrentActionCreator",(e=>new s((0,r.G)(e))))}},2033:function(e,t,n){function r(e){var t,n,r,s,i=""+(2,n=(t=e.toString()).indexOf("E"),s=0,(r=t.indexOf("e"))>-1?(s=parseFloat(t.substring(r+1)),t=t.substring(0,r)):n>-1&&(s=parseFloat(t.substring(n+1)),t=t.substring(0,n)),Number(Math.round(Number(t+"e"+(s+2)))+"e-2")),o=i.toString().indexOf(".");return-1!=o&&1==i.toString().length-(o+1)&&(i+="0"),i}n.d(t,{x:function(){return r}})}}]);
//# sourceMappingURL=dac04ab2cc9b4dc1c818.bundle.js.map