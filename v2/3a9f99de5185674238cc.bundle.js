(self.webpackChunkkontokorrent=self.webpackChunkkontokorrent||[]).push([[785],{3059:e=>{e.exports='<h1>Event erstellen</h1> <label for="event-name">Eventname</label> <input type="text" id="event-name" name="event-name"> <label for="event-name">Oeffentlich</label> <input type="checkbox" id="oeffentlich" name="oeffentlich" checked="checked"> <div id="oeffentlich-box"> <label for="oeffentlicher-name">Öffentlicher Name</label> <input type="text" id="oeffentlicher-name" name="oeffentlicher-name"> </div> <div id="empty-name-error" style="display:none">Für alle Personen Namen angeben</div> <div id="person-count-error" style="display:none">Mindestens zwei Personen angeben</div> <div id="event-create-error" style="display:none">Kontokorrent konnte nicht erstellt werden</div> <div id="event-name-duplicate" style="display:none">Ein Kontokorrent mit diesem Namen exisitert bereits</div> <div id="event-name-error" style="display:none">Eventname angeben</div> <div id="oeffentlicher-name-error" style="display:none">Öfferntlicher Name: Nur Kleinbuchstaben und Zahlen</div> <div id="person-name-duplicate-error" style="display:none">Personennamen müssen unterschiedlich sein</div> <div id="creating" style="display:none">Wird erstellt</div> <div id="account-creation-failed" style="display:none">Account konnte nicht erstellt werden</div> <app-personen-liste id="personen-liste"></app-personen-liste> <button id="create-button">Erstellen</button>'},2648:e=>{e.exports='<ul id="personen-liste" class="mdc-list mdc-list--non-interactive"> </ul> <button type="button" id="add-person">Person hinzufügen</button>'},2267:e=>{e.exports='<input type="text" id="name" placehoder="Name"/> <button id="remove">entfernen</button>'},6785:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CreateKontokorrent:()=>v});var r=n(3059),o=n.n(r),i=n(9445),s=n(6928),a=n(2648),c=n.n(a),l=n(2267),h=n.n(l);class d extends HTMLElement{constructor(){super(),this.innerHTML=h()}connectedCallback(){this.removeButton=this.querySelector("#remove"),this.nameInput=this.querySelector("#name"),this.nameInput.addEventListener("change",(()=>{this.dispatchEvent(new Event("change"))})),this.removeButton.addEventListener("click",(()=>{this.dispatchEvent(new CustomEvent("onremove"))}))}get name(){return this.nameInput.value}disconnectedCallback(){}}const u="app-personen-listen-eintrag";customElements.define(u,d);class p extends HTMLElement{constructor(){super(),this.innerHTML=c()}get personen(){let e=[];return this.personenListe.querySelectorAll(u).forEach((t=>e.push(t.name))),e}connectedCallback(){this.addPersonButton=this.querySelector("#add-person"),this.personenListe=this.querySelector("#personen-liste"),this.addPersonButton.addEventListener("click",(()=>{let e=document.createElement("li"),t=new d;e.appendChild(t),this.personenListe.appendChild(e),t.addEventListener("onremove",(()=>{this.personenListe.removeChild(e)}))}))}disconnectedCallback(){}}customElements.define("app-personen-liste",p);var f=n(4586),m=n(364);class v extends HTMLElement{constructor(){super(),this.innerHTML=o(),this.kontokorrentId=(0,f.Z)(),this.oeffentlicherNameManuell=!1}addServices(e){this.store=e.store,this.routingActionCreator=(0,i.b)(e),this.accountActionCreator=(0,s.gg)(e),this.kontokorrentHinzufuegenActionCreator=(0,m.Jj)(e)}connectedCallback(){let e=this;this.personenListe=e.querySelector("#personen-liste"),this.emptyNameError=e.querySelector("#empty-name-error"),this.eventCreateError=e.querySelector("#event-create-error"),this.personCountError=e.querySelector("#person-count-error"),this.eventNameError=e.querySelector("#event-name-error"),this.createButton=e.querySelector("#create-button"),this.eventName=e.querySelector("#event-name"),this.creating=e.querySelector("#creating"),this.oeffentlicherName=e.querySelector("#oeffentlicher-name"),this.oeffentlich=e.querySelector("#oeffentlich"),this.oeffentlichBox=e.querySelector("#oeffentlich-box"),this.oeffentlicherNameError=e.querySelector("#oeffentlicher-name-error"),this.eventNameDuplicate=e.querySelector("#event-name-duplicate"),this.accountCreationFailed=e.querySelector("#account-creation-failed"),this.personNameDuplicateError=e.querySelector("#person-name-duplicate-error"),this.createButton.addEventListener("click",this.createEvent.bind(this)),this.oeffentlich.addEventListener("change",(()=>{this.oeffentlichBox.style.display=this.oeffentlich.checked?"block":"none"})),this.eventName.addEventListener("change",(()=>{this.oeffentlicherNameManuell||(this.oeffentlicherName.value=this.eventName.value)})),this.oeffentlicherName.addEventListener("change",(()=>{this.oeffentlicherNameManuell=!0})),this.subscription=this.store.subscribe(null,(e=>this.applyStoreState(e))),this.applyStoreState(this.store.state)}createEvent(){return e=this,t=void 0,r=function*(){let e=this.eventName.value,t=this.personenListe.personen;this.eventNameError.style.display=e?"none":"block";let n=t.length>=2;this.personCountError.style.display=n?"none":"block";let r=t.some((e=>!e));this.emptyNameError.style.display=r?"block":"none";let o=this.oeffentlich.checked&&(!this.oeffentlicherName.value||!/^[a-z0-9]+$/.test(this.oeffentlicherName.value));this.oeffentlicherNameError.style.display=o?"block":"none";let i=t.some(((e,n)=>t.indexOf(e)!=n));this.personNameDuplicateError.style.display=i?"block":"none",!e||!n||r||o||i||(yield this.accountActionCreator.ensureAccount())&&(yield this.kontokorrentHinzufuegenActionCreator.kontokorrentErstellen(this.kontokorrentId,this.eventName.value,this.oeffentlich.checked?this.oeffentlicherName.value:null,t))&&this.routingActionCreator.navigateKontokorrent(this.kontokorrentId)},new((n=void 0)||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}));var e,t,n,r}applyStoreState(e){this.creating.style.display=e.kontokorrents.creating||e.account.accountCreating?"block":"none",this.eventCreateError.style.display=e.kontokorrents.creationFailed?"block":"none",this.eventNameDuplicate.style.display=e.kontokorrents.creationFailed&&e.kontokorrents.creationFailed.exists?"block":"none",this.accountCreationFailed.style.display=!e.account.accountCreating&&e.account.accountCreationFailed?"block":"none"}disconnectedCallback(){this.subscription()}}customElements.define("app-create-event",v)},364:(e,t,n)=>{"use strict";n.d(t,{Jj:()=>p});var r=n(4586),o=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};class i{constructor(e){this.exists=e,this.type=7}}class s{constructor(){this.type=8}}class a{constructor(e){this.kontokorrent=e,this.type=21}}class c{constructor(e){this.notFound=e,this.type=9}}class l{constructor(){this.type=10}}class h{constructor(e){this.kontokorrents=e,this.type=20}}class d{constructor(){this.type=18}}class u{constructor(e,t,n){this.store=e,this.apiClient=t,this.db=n}loginPageGeoeffnet(){this.store.dispatch(new d)}kontokorrentErstellen(e,t,n,c){return o(this,void 0,void 0,(function*(){let o={name:t,id:e,oeffentlicherName:n,personen:c.map((e=>({name:e,id:(0,r.Z)()})))};this.store.dispatch(new s);let l=yield this.apiClient.neuerKontokorrent(o);return l.success?(yield this.db.addKontokorrent({id:e,name:t,personen:o.personen,oeffentlicherName:n}),this.store.dispatch(new a({id:e,name:t,personen:o.personen,oeffentlicherName:n})),!0):(this.store.dispatch(new i(l.exists)),!1)}))}kontokorrentHinzufuegen(e){return o(this,void 0,void 0,(function*(){let t=yield this.db.getPerOeffentlichName(e);if(null!=t)return t.id;this.store.dispatch(new l);try{let t=yield this.apiClient.kontokorrentHinzufuegen(e,null);if(null!=t){let e=yield this.db.setKontokorrents(t.map((e=>({id:e.id,name:e.name,personen:e.personen,oeffentlicherName:e.oeffentlicherName}))));return this.store.dispatch(new h(t)),e[0]}this.store.dispatch(new c(!0))}catch(e){this.store.dispatch(new c(!1))}return!1}))}}function p(e){return e.get("KontokorrentHinzufuegenActionCreator",(e=>new u(e.store,e.apiClient,e.db)))}}}]);
//# sourceMappingURL=3a9f99de5185674238cc.bundle.js.map