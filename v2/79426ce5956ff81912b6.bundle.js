"use strict";(self.webpackChunkkontokorrent=self.webpackChunkkontokorrent||[]).push([[502],{4502:function(t,e,n){n.r(e),n.d(e,{Login:function(){return c}});var i=n(9773),o=n(2204),s=n(2887),r=(n(4227),n(1480),n(6604));class c extends HTMLElement{constructor(){super(),this.innerHTML='<div class="login-error-box"> <div id="eventMissingError" class="alert alert--error" style="display:none">Kontokorrentnamen eingeben</div> <div id="notFoundError" class="alert alert--error" style="display:none">Kontokorrent wurde nicht gefunden</div> <div id="account-creation-failed" class="alert alert--error" style="display:none">Account konnte nicht erstellt werden</div> </div> <div class="login-box" id="login-box"> <div class="login-box__event-input"> <input type="text" id="eventInput" placeholder="Kontokorrentname"> <tip-button popup-id="oeffentlicherNameExplainer" title="öffentlicher Name Erklärung"> <span class="material-icons"> info </span> </tip-button> <app-popup id="oeffentlicherNameExplainer" class="tip tip--with-input"> Gib hier den Namen des öffentlichen Kontokorrents ein. <ul> <li>frag die anderen Event-/Gruppen- Teilnehmer nach dem Namen</li> <li>such in eurem Chat</li> </ul> </app-popup> </div> <div> <button id="loginButton" class="button button--raised login-box__login-button"> Login </button> <div id="processing" class="login-box__processing" style="display:none"> <span class="spinner"></span> </div> </div> <a id="createEventButton" class="button" href="create-event"> <span class="material-icons"> add </span> Gruppe erstellen </a> <a id="home-button" class="button" href=""> <span class="material-icons"> home </span> zurück </a> </div>'}addServices(t){this.store=t.store,this.routingActionCreator=(0,i.b)(t),this.accountActionCreator=(0,s.gg)(t),this.kontokorrentHinzufuegenActionCreator=(0,r.Jj)(t)}connectedCallback(){let t=this;(0,o.G)(t.querySelectorAll("a"),this.routingActionCreator),this.eventInput=t.querySelector("#eventInput"),this.loginButton=t.querySelector("#loginButton"),this.homeButton=t.querySelector("#home-button"),this.loginBox=t.querySelector("#login-box"),this.eventMissingError=t.querySelector("#eventMissingError"),this.accountCreationFailed=t.querySelector("#account-creation-failed"),this.notFoundError=t.querySelector("#notFoundError"),this.processing=t.querySelector("#processing"),this.loginButton.addEventListener("click",this.loginFuerEvent.bind(this)),this.subscription=this.store.subscribe(null,(t=>this.applyStoreState(t))),this.applyStoreState(this.store.state),this.accountActionCreator.initializeAccount(),this.kontokorrentHinzufuegenActionCreator.loginPageGeoeffnet()}async loginFuerEvent(){let t=this.eventInput.value;if(this.eventMissingError.style.display=t?"none":"block",t&&await this.accountActionCreator.ensureAccount()){let e=await this.kontokorrentHinzufuegenActionCreator.kontokorrentHinzufuegen(t);e&&this.routingActionCreator.navigateKontokorrent(e)}}applyStoreState(t){this.accountCreationFailed.style.display=!t.account.accountCreating&&t.account.accountCreationFailed?"block":"none",this.notFoundError.style.display=!t.kontokorrents.hinzufuegen&&t.kontokorrents.hinzufuegenFailed&&t.kontokorrents.hinzufuegenFailed.kontokorrentNotFound?"block":"none";let e=t.kontokorrents.hinzufuegen||t.account.accountCreating;this.processing.style.display=e?"flex":"none",this.homeButton.style.visibility=t.account.accountCreated&&Object.keys(t.kontokorrents.kontokorrents).length?"visible":"hidden",this.loginButton.style.display=e?"none":"inline-flex"}disconnectedCallback(){this.subscription()}}customElements.define("app-login",c)},2204:function(t,e,n){function i(t,e){t.forEach((t=>{t.addEventListener("click",(n=>{n.preventDefault(),e.navigate(t.getAttribute("href"))}))}))}n.d(e,{G:function(){return i}})},4227:function(t,e,n){class i extends HTMLElement{constructor(){super(),this.popupShown=!1,this.keyListener=this.keyListener.bind(this),this.clickListener=this.clickListener.bind(this)}connectedCallback(){this.updateStyles()}keyListener(t){"Escape"==t.key&&this.hide()}clickListener(t){this.contains(event.target)||this.hide()}hide(){this.popupShown&&(document.removeEventListener("keydown",this.keyListener),document.removeEventListener("click",this.clickListener),this.popupShown=!1,this.updateStyles())}show(){this.popupShown||(document.addEventListener("keydown",this.keyListener),document.addEventListener("click",this.clickListener),this.popupShown=!0,this.updateStyles())}updateStyles(){this.style.display=this.popupShown?"block":"none"}toggle(){this.popupShown?this.hide():this.show()}disconnectedCallback(){this.hide()}}customElements.define("app-popup",i)},1480:function(t,e,n){const i="popup-id";class o extends HTMLElement{constructor(){super(),this.clickListener=this.clickListener.bind(this)}attributeChangedCallback(){this.updateAttributes()}updateAttributes(){this.popupId=this.getAttribute(i)}static get observedAttributes(){return[i]}connectedCallback(){this.addEventListener("click",this.clickListener)}clickListener(t){document.querySelector("#".concat(this.popupId)).toggle(),t.stopPropagation()}disconnectedCallback(){this.removeEventListener("click",this.clickListener)}}customElements.define("tip-button",o)},6604:function(t,e,n){n.d(e,{Jj:function(){return p}});var i=n(886);class o{constructor(t){this.exists=t,this.type=7}}class s{constructor(){this.type=8}}class r{constructor(t){this.kontokorrent=t,this.type=21}}class c{constructor(t){this.notFound=t,this.type=9}}class a{constructor(){this.type=10}}class l{constructor(t){this.kontokorrents=t,this.type=20}}class u{constructor(){this.type=18}}class h{constructor(t,e,n){this.store=t,this.apiClient=e,this.db=n}loginPageGeoeffnet(){this.store.dispatch(new u)}async kontokorrentErstellen(t,e,n,c){let a={name:e,id:t,oeffentlicherName:n,personen:c.map((t=>({name:t,id:(0,i.Z)()})))};this.store.dispatch(new s);let l=await this.apiClient.neuerKontokorrent(a);return l.success?(await this.db.addKontokorrent({id:t,name:e,personen:a.personen,oeffentlicherName:n}),this.store.dispatch(new r({id:t,name:e,personen:a.personen,oeffentlicherName:n})),!0):(this.store.dispatch(new o(l.exists)),!1)}async kontokorrentHinzufuegen(t){let e=await this.db.getPerOeffentlichName(t);if(null!=e)return e.id;this.store.dispatch(new a);try{let e=await this.apiClient.kontokorrentHinzufuegen(t,null);if(null!=e){let t=await this.db.setKontokorrents(e.map((t=>({id:t.id,name:t.name,personen:t.personen,oeffentlicherName:t.oeffentlicherName}))));return this.store.dispatch(new l(e)),t[0]}this.store.dispatch(new c(!0))}catch(t){this.store.dispatch(new c(!1))}return!1}}function p(t){return t.get("KontokorrentHinzufuegenActionCreator",(t=>new h(t.store,t.apiClient,t.db)))}}}]);
//# sourceMappingURL=79426ce5956ff81912b6.bundle.js.map