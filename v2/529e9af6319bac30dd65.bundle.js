(self.webpackChunkkontokorrent=self.webpackChunkkontokorrent||[]).push([[417],{417:(e,t,n)=>{"use strict";let i,o;n.d(t,{x:()=>D});const r=new WeakMap,s=new WeakMap,d=new WeakMap,c=new WeakMap,a=new WeakMap;let u={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||d.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function l(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(h(this),e),f(r.get(this))}:function(...e){return f(t.apply(h(this),e))}:function(e,...n){const i=t.call(h(this),e,...n);return d.set(i,e.sort?e.sort():[e]),f(i)}:(e instanceof IDBTransaction&&function(e){if(s.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",r),e.removeEventListener("abort",r)},o=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",o),e.addEventListener("error",r),e.addEventListener("abort",r)}));s.set(e,t)}(e),n=e,(i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,u):e);var t,n}function f(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",o),e.removeEventListener("error",r)},o=()=>{t(f(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",o),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&r.set(t,e)})).catch((()=>{})),a.set(t,e),t}(e);if(c.has(e))return c.get(e);const t=l(e);return t!==e&&(c.set(e,t),a.set(t,e)),t}const h=e=>a.get(e),v=["get","getKey","getAll","getAllKeys","count"],y=["put","add","delete","clear"],p=new Map;function k(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(p.get(t))return p.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,o=y.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!o&&!v.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,o?"readwrite":"readonly");let s=r.store;i&&(s=s.index(t.shift()));const d=await s[n](...t);return o&&await r.done,d};return p.set(t,r),r}var I;I=u,u={...I,get:(e,t,n)=>k(e,t)||I.get(e,t,n),has:(e,t)=>!!k(e,t)||I.has(e,t)};var g=n(600),m=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function d(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,d)}c((i=i.apply(e,t||[])).next())}))};const w="KontokorrentsStore",b="AppStateStore",z="AktionenStore";class D{withInitialized(e){return m(this,void 0,void 0,(function*(){let t=yield function(e,t,{blocked:n,upgrade:i,blocking:o,terminated:r}={}){const s=indexedDB.open(e,t),d=f(s);return i&&s.addEventListener("upgradeneeded",(e=>{i(f(s.result),e.oldVersion,e.newVersion,f(s.transaction))})),n&&s.addEventListener("blocked",(()=>n())),d.then((e=>{r&&e.addEventListener("close",(()=>r())),o&&e.addEventListener("versionchange",(()=>o()))})).catch((()=>{})),d}("kontokorrent-db",3,{upgrade(e,t,n){t<1&&e.createObjectStore(w,{keyPath:"id"}).createIndex("oeffentlicherName","oeffentlicherName"),t<2&&e.createObjectStore(b,{keyPath:"id"}).put({id:0,zuletztGesehenerKontokorrentId:null,accesstokens:[],accountinfo:null}),t<3&&e.createObjectStore(z,{keyPath:["laufendeNummer","kontokorrentId"]}).createIndex("kontokorrentId","kontokorrentId")}});try{return yield e(t)}finally{t.close()}}))}getKontokorrents(){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>m(this,void 0,void 0,(function*(){return(0,g.T)(yield e.getAll(w),(e=>e.name))}))))}))}addAktionen(e,t){return m(this,void 0,void 0,(function*(){if(t.length)return yield this.withInitialized((n=>m(this,void 0,void 0,(function*(){const i=n.transaction(z,"readwrite");let o=t.map((t=>Object.assign(Object.assign({},t),{kontokorrentId:e}))).map((e=>i.store.add(e)));yield Promise.all(o),yield i.done}))))}))}getZuletztGesehenerKontokorrentId(){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>m(this,void 0,void 0,(function*(){let t=yield e.get(b,0);if(t.zuletztGesehenerKontokorrentId)return t.zuletztGesehenerKontokorrentId;{let e=yield yield this.getKontokorrents();return e.length?e[0].id:null}}))))}))}setZuletztGesehenerKontokorrentId(e){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>m(this,void 0,void 0,(function*(){let n=yield t.get(b,0);n.zuletztGesehenerKontokorrentId=e,yield t.put(b,n)}))))}))}setKontokorrents(e){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>m(this,void 0,void 0,(function*(){let n=yield t.getAll(w);for(let i of n.filter((t=>!e.some((e=>t.id===e.id)))))yield t.delete(w,i.id);let i=[];for(let o of e){let e=n.find((e=>e.id==o.id));e||i.push(o.id);let r=Object.assign(Object.assign({},e),{name:o.name,personen:o.personen,id:o.id,oeffentlicherName:o.oeffentlicherName});yield t.put(w,r)}return i}))))}))}addKontokorrent(e){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>m(this,void 0,void 0,(function*(){(yield t.get(w,e.id))||(yield t.add(w,e))}))))}))}getKontokorrent(e){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>m(this,void 0,void 0,(function*(){return yield t.get(w,e)}))))}))}getPerOeffentlichName(e){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>m(this,void 0,void 0,(function*(){return yield t.getFromIndex(w,"oeffentlicherName",e)}))))}))}getAktionen(e){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>m(this,void 0,void 0,(function*(){return yield t.getAllFromIndex(z,"kontokorrentId",e)}))))}))}clear(){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>m(this,void 0,void 0,(function*(){yield e.clear(z),yield e.clear(w),yield e.put(b,{id:0,zuletztGesehenerKontokorrentId:null,accesstokens:[],accountinfo:null})}))))}))}getAccessToken(e){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>m(this,void 0,void 0,(function*(){return((yield t.get(b,0)).accesstokens||[]).find((t=>t.type===e))}))))}))}updateAccessTokenIfNewer(e,t,n){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((i=>m(this,void 0,void 0,(function*(){const o=i.transaction(b,"readwrite",{durability:"strict"});let r=yield o.store.get(0);r.accesstokens||(r.accesstokens=[]);let s=r.accesstokens.find((t=>t.type===e));if(s){if(s.timestamp!=n)return console.error(`The accesstoken of type ${e} was already updated since reading.`),yield o.done,!1;s.value=t,s.timestamp++}else r.accesstokens.push({timestamp:1,type:e,value:t});return yield o.store.put(r),yield o.done,!0}))))}))}setAccountInfo(e){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>m(this,void 0,void 0,(function*(){const n=t.transaction(b,"readwrite");let i=yield n.store.get(0);i.accountinfo=e,yield n.store.put(i),yield n.done}))))}))}getAccountInfo(){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>m(this,void 0,void 0,(function*(){const t=e.transaction(b,"readonly");let n=yield t.store.get(0);return null==n?void 0:n.accountinfo}))))}))}clearAccountInfo(){return m(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>m(this,void 0,void 0,(function*(){const t=e.transaction(b,"readwrite");let n=yield t.store.get(0);n.accountinfo=null,n.accesstokens=[],yield t.store.put(n),yield t.done}))))}))}}},600:(e,t,n)=>{"use strict";function i(e,t){return e.sort(((e,n)=>t(e).toLowerCase().localeCompare(t(n).toLowerCase())))}n.d(t,{T:()=>i})}}]);
//# sourceMappingURL=529e9af6319bac30dd65.bundle.js.map