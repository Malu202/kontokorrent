(()=>{"use strict";var e,t={2948:(e,t,n)=>{var i=n(9870);function o(e,t){const n=new Map;return e.forEach((e=>{const i=e[t],o=n.get(i);o?o.push(e):n.set(i,[e])})),n}class r{constructor(e,t,n){this.wert=e,this.empfaengerAnzahl=t,this.isEmpfaenger=n}}class d{constructor(e){this.db=e}erweitern(e,t,n){let i=1;for(let e of n)e!=t&&(i*=e);return e*i}calculateBalance(e){return t=this,n=void 0,d=function*(){let t=function(e){let t={},n=e.sort(((e,t)=>e.laufendeNummer-t.laufendeNummer));for(let e of n)e.bearbeiteteBezahlungId&&delete t[e.bearbeiteteBezahlungId],e.geloeschteBezahlungId?delete t[e.geloeschteBezahlungId]:t[e.bezahlung.id]=e.bezahlung;return Object.values(t)}(yield this.db.getAktionen(e)),n=[...yield this.db.getZwischengespeicherteBezahlungenForKontokorrent(e),...t],i=yield this.db.getKontokorrent(e),d={};for(let e of i.personen)d[e.id]=[];for(let e of n)for(let t of e.empfaengerIds)d[t].push(new r(e.wert,e.empfaengerIds.length,!0)),d[e.bezahlendePersonId].push(new r(e.wert,e.empfaengerIds.length,!1));let s={};for(let e of i.personen){let t=o(d[e.id],"empfaengerAnzahl"),n=Array.from(t.keys()),i=Array.from(t.keys()).reduce(((e,t)=>e*t),1);if(i<362880){let o=0;for(let e of t.keys()){let i=t.get(e).reduce(((e,t)=>e+(t.isEmpfaenger?t.wert:-t.wert)),0);o+=this.erweitern(i,e,n)}s[e.id]=o/i}else{let n=0;for(let e of t.keys())n+=t.get(e).reduce(((e,t)=>e+(t.isEmpfaenger?t.wert:-t.wert)),0)/e;s[e.id]=n}}return s},new((i=void 0)||(i=Promise))((function(e,o){function r(e){try{l(d.next(e))}catch(e){o(e)}}function s(e){try{l(d.throw(e))}catch(e){o(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,s)}l((d=d.apply(t,n||[])).next())}));var t,n,i,d}}var s=n(3032),l=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function d(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,s)}l((i=i.apply(e,t||[])).next())}))};const u="KontokorrentsStore",c="AppStateStore",a="AktionenStore",h="NeueBezahlungenStore";class f{constructor(e){this.db=e}getLaufendeNummer(e){return t=this,n=void 0,o=function*(){let t,n=(yield this.db.getAktionen(e)).map((e=>e.laufendeNummer)).sort(((e,t)=>e-t));for(t=0;t<n.length-1&&n[t]+1===n[t+1];t++);return n[t]},new((i=void 0)||(i=Promise))((function(e,r){function d(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(d,s)}l((o=o.apply(t,n||[])).next())}));var t,n,i,o}}var v=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function d(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,s)}l((i=i.apply(e,t||[])).next())}))};const y=new class{withInitialized(e){return l(this,void 0,void 0,(function*(){let t=yield(0,s.X3)("kontokorrent-db",5,{upgrade(e,t,n){t<1&&e.createObjectStore(u,{keyPath:"id"}).createIndex("oeffentlicherName","oeffentlicherName"),t<2&&e.createObjectStore(c,{keyPath:"id"}).put({id:0,zuletztGesehenerKontokorrentId:null,accesstokens:[],accountinfo:null}),t<3&&e.createObjectStore(a,{keyPath:["laufendeNummer","kontokorrentId"]}).createIndex("kontokorrentId","kontokorrentId"),t<5&&(e.objectStoreNames.contains(h)&&e.deleteObjectStore(h),e.createObjectStore(h,{keyPath:"id"}).createIndex("kontokorrentId","kontokorrentId"))}});try{return yield e(t)}finally{t.close()}}))}getKontokorrents(){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>l(this,void 0,void 0,(function*(){return t=yield e.getAll(u),n=e=>e.name,t.sort(((e,t)=>n(e).toLowerCase().localeCompare(n(t).toLowerCase())));var t,n}))))}))}addAktionen(e,t){return l(this,void 0,void 0,(function*(){if(!t.length)return;let n=t.map((t=>Object.assign(Object.assign({},t),{kontokorrentId:e})));return yield this.withInitialized((t=>{const i=(0,s.Wg)(t);return new Promise(((t,o)=>{const r=i.transaction(a,"readwrite");r.onerror=e=>{console.error("addAktionen failed",e,r.error),o(r.error)},r.oncomplete=()=>{t()};for(let t of n){let n=r.objectStore(a).add(t);n.onerror=i=>{"ConstraintError"==n.error.name?(console.log(`Aktion ${t.laufendeNummer} für Kontokorrent ${e} bereits gespeichert.`,i,n.error),i.preventDefault(),i.stopPropagation()):console.error(`Aktion ${t.laufendeNummer} für Kontokorrent ${e} konnte nicht gespeichert werden.`,i,n.error)}}}))}))}))}getZuletztGesehenerKontokorrentId(){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>l(this,void 0,void 0,(function*(){let t=yield e.get(c,0);if(t.zuletztGesehenerKontokorrentId)return t.zuletztGesehenerKontokorrentId;{let e=yield yield this.getKontokorrents();return e.length?e[0].id:null}}))))}))}setZuletztGesehenerKontokorrentId(e){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>l(this,void 0,void 0,(function*(){let n=yield t.get(c,0);n.zuletztGesehenerKontokorrentId=e,yield t.put(c,n)}))))}))}setKontokorrents(e){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>l(this,void 0,void 0,(function*(){let n=yield t.getAll(u);for(let i of n.filter((t=>!e.some((e=>t.id===e.id)))))yield t.delete(u,i.id);let i=[];for(let o of e){let e=n.find((e=>e.id==o.id));e||i.push(o.id);let r=Object.assign(Object.assign({},e),{name:o.name,personen:o.personen,id:o.id,oeffentlicherName:o.oeffentlicherName});yield t.put(u,r)}return i}))))}))}addKontokorrent(e){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>l(this,void 0,void 0,(function*(){(yield t.get(u,e.id))||(yield t.add(u,e))}))))}))}getKontokorrent(e){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>l(this,void 0,void 0,(function*(){return yield t.get(u,e)}))))}))}getPerOeffentlichName(e){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>l(this,void 0,void 0,(function*(){return yield t.getFromIndex(u,"oeffentlicherName",e)}))))}))}getAktionen(e){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>l(this,void 0,void 0,(function*(){return yield t.getAllFromIndex(a,"kontokorrentId",e)}))))}))}clear(){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>l(this,void 0,void 0,(function*(){yield e.clear(a),yield e.clear(u),yield e.put(c,{id:0,zuletztGesehenerKontokorrentId:null,accesstokens:[],accountinfo:null})}))))}))}getAccessToken(e){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>l(this,void 0,void 0,(function*(){return((yield t.get(c,0)).accesstokens||[]).find((t=>t.type===e))}))))}))}updateAccessTokenIfNewer(e,t,n){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((i=>l(this,void 0,void 0,(function*(){const o=i.transaction(c,"readwrite",{durability:"strict"});let r=yield o.store.get(0);r.accesstokens||(r.accesstokens=[]);let d=r.accesstokens.find((t=>t.type===e));if(d){if(d.timestamp!=n)return console.error(`The accesstoken of type ${e} was already updated since reading.`),yield o.done,!1;d.value=t,d.timestamp++}else r.accesstokens.push({timestamp:1,type:e,value:t});return yield o.store.put(r),yield o.done,!0}))))}))}setAccountInfo(e){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>l(this,void 0,void 0,(function*(){const n=t.transaction(c,"readwrite");let i=yield n.store.get(0);i.accountinfo=e,yield n.store.put(i),yield n.done}))))}))}getAccountInfo(){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>l(this,void 0,void 0,(function*(){const t=e.transaction(c,"readonly");let n=yield t.store.get(0);return null==n?void 0:n.accountinfo}))))}))}clearAccountInfo(){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>l(this,void 0,void 0,(function*(){const t=e.transaction(c,"readwrite");let n=yield t.store.get(0);n.accountinfo=null,n.accesstokens=[],yield t.store.put(n),yield t.done}))))}))}getZwischengespeicherteBezahlungen(){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>l(this,void 0,void 0,(function*(){return e.getAll(h)}))))}))}getZwischengespeicherteBezahlungenForKontokorrent(e){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>l(this,void 0,void 0,(function*(){return yield t.getAllFromIndex(h,"kontokorrentId",e)}))))}))}bezahlungZwischenspeichern(e){return l(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>l(this,void 0,void 0,(function*(){t.add(h,e)}))))}))}zwischengespeicherteBezahlungErledigt(e){return l(this,void 0,void 0,(function*(){yield this.withInitialized((t=>l(this,void 0,void 0,(function*(){t.delete(h,e)}))))}))}},g={calculateBalance:function(e){return v(this,void 0,void 0,(function*(){return yield new d(y).calculateBalance(e)}))},getLaufendeNummer:function(e){return v(this,void 0,void 0,(function*(){return yield new f(y).getLaufendeNummer(e)}))}};(0,i.Jj)(g,self)}},n={};function i(e){if(n[e])return n[e].exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.m=t,i.x=()=>{i(2948)},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>"23bd790fa21acbb423d0.bundle.js",i.miniCssF=e=>e+"."+{803:"31d6cfe0d16ae931b73c"}[e]+".css",i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=i.x,i.x=()=>i.e(803).then(e),i.p="/v2/",(()=>{var e={948:1};i.f.i=(t,n)=>{e[t]||importScripts(""+i.u(t))};var t=self.webpackChunkkontokorrent=self.webpackChunkkontokorrent||[],n=t.push.bind(t);t.push=t=>{var[o,r,d]=t;for(var s in r)i.o(r,s)&&(i.m[s]=r[s]);for(d&&d(i);o.length;)e[o.pop()]=1;n(t)}})(),i.x()})();
//# sourceMappingURL=89c57533dec2e6048bc3.bundle.js.map