(()=>{var e,t,n,o,r={9199:e=>{e.exports="<h1>Speicherzugriff benötigt</h1> Kontokorrent speichert die Zahlungen und weitere Informationen im lokalen Speicher dieses Geräts. Auf diese Weise kann man für einige Tage eingeloggt bleiben, und die Anwendung auch verwenden, wenn die Internetverbindung schlecht ist. In den meisten Browsern (Chrome, Edge) muss dazu der Webseite erlaubt werden <strong>Cookies</strong> zu speichern. Nachdem die Berechtigung erteilt wurde die Webseite neu laden."},105:(e,t,n)=>{"use strict";n.d(t,{G:()=>o});class o{}},7476:(e,t,n)=>{"use strict";n.d(t,{X:()=>o});class o{constructor(e){this.networkError=e}}},7030:(e,t,n)=>{"use strict";var o;n.d(t,{Q:()=>o}),function(e){e.google="google",e.anonym="anonym"}(o||(o={}))},9717:(e,t,n)=>{"use strict";n.d(t,{l:()=>r});var o=n(4586);function r(){return new Promise(((e,t)=>{if("indexedDB"in window){const t=(0,o.Z)();let n=window.indexedDB.open(t,1);n.onsuccess=()=>{e({allPassed:!0}),n.result.close(),window.indexedDB.deleteDatabase(t)},n.onerror=()=>{e({allPassed:!1})}}else e({allPassed:!1})}))}},5965:(e,t,n)=>{"use strict";n.d(t,{W:()=>d,n:()=>c});var o=n(9199),r=n.n(o),i=n(9445),s=n(9717);class a extends HTMLElement{constructor(){super(),this.innerHTML=r()}addServices(e){this.routingActionCreator=(0,i.b)(e)}connectedCallback(){(0,s.l)().then((e=>{e.allPassed&&(this.routingActionCreator.navigateHome(),window.location.reload())}))}disconnectedCallback(){}}customElements.define("app-features-required",a);var c,u=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};!function(e){e.Login="login",e.Info="info",e.Home="",e.FeaturesRequired="features-required",e.Kontokorrents="kontokorrents",e.CreateEvent="create-event",e.BezahlungEintragen="eintragen"}(c||(c={}));class d extends EventTarget{constructor(e){super(),this.store=e}setServiceLocator(e){this.serviceLocator=e}getKontokorrentPageComponent(){return u(this,void 0,void 0,(function*(){const{KontokorrentPage:e}=yield n.e(634).then(n.bind(n,527));let t=new e;return t.addServices(this.serviceLocator),t}))}resolve(e,t,o){return u(this,void 0,void 0,(function*(){switch(t in c&&this.dispatchEvent(new CustomEvent("routedTo",{detail:{currentRoute:t}})),t){case c.Info:const{Info:e}=yield n.e(184).then(n.bind(n,2184));let t=new e;return t.addServices(this.serviceLocator),t;case c.FeaturesRequired:{let e=new a;return e.addServices(this.serviceLocator),e}case c.Login:{const{Login:e}=yield n.e(259).then(n.bind(n,1560));let t=new e;return t.addServices(this.serviceLocator),t}case c.CreateEvent:{const{CreateKontokorrent:e}=yield n.e(785).then(n.bind(n,6785));let t=new e;return t.addServices(this.serviceLocator),t}}if(!this.store.state.account.accountCreated)return!1;switch(t){case c.BezahlungEintragen:const{BezahlungEintragenPage:e}=yield n.e(988).then(n.bind(n,3450));let t=new e;return t.addServices(this.serviceLocator),t}let e=/^kontokorrents\/([a-zA-Z0-9\-]+)$/.exec(t);if(e){let t=e[1],n=yield this.getKontokorrentPageComponent();return n.setRouteParameters(t),n}let o=yield this.getKontokorrentPageComponent();return o.addServices(this.serviceLocator),o}))}}},7001:(e,t,n)=>{"use strict";var o;n.d(t,{Z:()=>o}),function(e){e.Zwischengespeichert="zwischengespeichert",e.Speichern="speichern",e.Gespeichert="gespeichert"}(o||(o={}))},6928:(e,t,n)=>{"use strict";n.d(t,{gg:()=>p});var o=n(4586),r=n(7030),i=n(9445),s=n(7476),a=n(105),c=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};class u{constructor(){this.type=0}}class d{constructor(){this.type=1}}class l{constructor(e){this.info=e,this.type=2}}class h{constructor(e){this.info=e,this.type=3}}class f{constructor(){this.type=4}}class g{constructor(){this.type=5}}class v{constructor(e,t,n,o,r){this.store=e,this.apiClient=t,this.accountInfoStore=n,this.routingActionCreator=o,this.db=r}initializeAccount(){return c(this,void 0,void 0,(function*(){let e=yield this.accountInfoStore.get();return!!e&&(this.store.dispatch(new h(e)),this.getUserInfo(),!0)}))}getUserInfo(){return c(this,void 0,void 0,(function*(){try{yield this.apiClient.getUserInfo()}catch(e){if(e instanceof s.X){let t=yield this.accountInfoStore.get();e.networkError||t.type!=r.Q.anonym||(yield this.accountInfoStore.clear(),window.location.reload())}else e instanceof a.G&&this.store.dispatch(new g)}}))}ensureAccount(){return c(this,void 0,void 0,(function*(){if(!this.store.state.account.accountCreated){let e={id:(0,o.Z)(),secret:(0,o.Z)(),type:r.Q.anonym};this.store.dispatch(new u);let t=yield this.apiClient.neuerBenutzer(e.id,e.secret);return t.success?(this.store.dispatch(new l(e)),yield this.accountInfoStore.set(e)):this.store.dispatch(new d),t.success}return!0}))}logout(){return c(this,void 0,void 0,(function*(){yield this.accountInfoStore.clear(),yield this.db.clear(),this.store.dispatch(new f),this.routingActionCreator.navigateLogin()}))}}function p(e){return e.get("AccountActionCreator",(e=>new v(e.store,e.apiClient,e.accountInfoStore,(0,i.b)(e),e.db)))}},9114:(e,t,n)=>{"use strict";n.d(t,{d8:()=>d});var o=n(105),r=n(9445),i=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};class s{constructor(){this.type=11}}class a{constructor(e){this.kontokorrents=e,this.type=12}}class c{constructor(e){this.interactionRequired=e,this.type=13}}class u{constructor(e,t,n,o){this.store=e,this.apiClient=t,this.routingActionCreator=n,this.db=o}navigiereZuLetztGesehenem(e){return i(this,void 0,void 0,(function*(){let t=yield this.db.getZuletztGesehenerKontokorrentId();return!!t&&(this.routingActionCreator.navigateKontokorrent(t,e),!0)}))}syncKontokorrentListe(){return i(this,void 0,void 0,(function*(){this.store.dispatch(new s);const e=this.apiClient.kontokorrentsAuflisten();let t=yield this.db.getKontokorrents();this.store.dispatch(new a(t));try{let t=yield e;yield this.db.setKontokorrents(t.map((e=>({id:e.id,name:e.name,personen:e.personen,oeffentlicherName:e.oeffentlicherName})))),this.store.dispatch(new a(t))}catch(e){e instanceof o.G?this.store.dispatch(new c(!0)):this.store.dispatch(new c(!1))}}))}}function d(e){return e.get("KontokorrentListenActionCreator",(e=>new u(e.store,e.apiClient,(0,r.b)(e),e.db)))}},9445:(e,t,n)=>{"use strict";n.d(t,{b:()=>i});var o=n(5965);class r{constructor(e){this.router=e}navigateHome(){this.router.navigate(o.n.Home,null)}navigateLogin(e){this.router.navigate(o.n.Login,null,e)}navigateFeaturesRequired(){this.router.navigate(o.n.FeaturesRequired,null)}navigate(e){this.router.navigate(e,null)}navigateKontokorrent(e,t){this.router.navigate(`${o.n.Kontokorrents}/${e}`,null,t)}}function i(e){return e.get("RoutingActionCreator",(e=>new r(e.router)))}},6600:(e,t,n)=>{"use strict";function o(e,t){return e.sort(((e,n)=>t(e).toLowerCase().localeCompare(t(n).toLowerCase())))}n.d(t,{T:()=>o})},4586:(e,t,n)=>{"use strict";var o;n.d(t,{Z:()=>d});var r=new Uint8Array(16);function i(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(r)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&s.test(e)};for(var c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));const d=function(e,t,n){var o=(e=e||{}).random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=o[r];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n}(o)}}},i={};function s(e){if(i[e])return i[e].exports;var t=i[e]={exports:{}};return r[e](t,t.exports,s),t.exports}s.m=r,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,n)=>(s.f[n](e,t),t)),[])),s.u=e=>({184:"5f5bc5c843166cc2fda7",259:"69f671b230c52504b30e",634:"583d88bc4e2cfbd0084b",785:"3a9f99de5185674238cc",948:"89c57533dec2e6048bc3",988:"a824d3a21ad185629c7f"}[e]+".bundle.js"),s.miniCssF=e=>(826===e?"index":e)+"."+{184:"31d6cfe0d16ae931b73c",259:"cbdb2e7b4f859e70a8da",634:"185d56889bc9dc7bab20",785:"31d6cfe0d16ae931b73c",948:"31d6cfe0d16ae931b73c",988:"4c6d8ebaade5139cbd65"}[e]+".css",s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="kontokorrent:",s.l=(n,o,r)=>{if(e[n])e[n].push(o);else{var i,a;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+r){i=d;break}}i||(a=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,s.nc&&i.setAttribute("nonce",s.nc),i.setAttribute("data-webpack",t+r),i.src=n),e[n]=[o];var l=(t,o)=>{i.onerror=i.onload=null,clearTimeout(h);var r=e[n];if(delete e[n],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach((e=>e(o))),t)return t(o)},h=setTimeout(l.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=l.bind(null,i.onerror),i.onload=l.bind(null,i.onload),a&&document.head.appendChild(i)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="/v2/",n=e=>new Promise(((t,n)=>{var o=s.miniCssF(e),r=s.p+o;if(((e,t)=>{for(var n=document.getElementsByTagName("link"),o=0;o<n.length;o++){var r=(s=n[o]).getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(r===e||r===t))return s}var i=document.getElementsByTagName("style");for(o=0;o<i.length;o++){var s;if((r=(s=i[o]).getAttribute("data-href"))===e||r===t)return s}})(o,r))return t();((e,t,n,o)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.onerror=r.onload=i=>{if(r.onerror=r.onload=null,"load"===i.type)n();else{var s=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=s,c.request=a,r.parentNode.removeChild(r),o(c)}},r.href=t,document.head.appendChild(r)})(e,r,t,n)})),o={826:0},s.f.miniCss=(e,t)=>{o[e]?t.push(o[e]):0!==o[e]&&{259:1,634:1,988:1}[e]&&t.push(o[e]=n(e).then((()=>{o[e]=0}),(t=>{throw delete o[e],t})))},(()=>{s.b=document.baseURI||self.location.href;var e={826:0};s.f.j=(t,n)=>{var o=s.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var r=new Promise(((n,r)=>{o=e[t]=[n,r]}));n.push(o[2]=r);var i=s.p+s.u(t),a=new Error;s.l(i,(n=>{if(s.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var r=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+r+": "+i+")",a.name="ChunkLoadError",a.type=r,a.request=i,o[1](a)}}),"chunk-"+t)}};var t=(t,n)=>{for(var o,r,[i,a,c]=n,u=0,d=[];u<i.length;u++)r=i[u],s.o(e,r)&&e[r]&&d.push(e[r][0]),e[r]=0;for(o in a)s.o(a,o)&&(s.m[o]=a[o]);for(c&&c(s),t&&t(n);d.length;)d.shift()()},n=self.webpackChunkkontokorrent=self.webpackChunkkontokorrent||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";class e{constructor(e,t){this.routeResolver=e,this.routeRenderer=t,this.lastRoute=null,this.popStateListener=this.handlePopState.bind(this)}handlePopState(e){this.doRouting(window.location.pathname)}run(){let e=document.querySelector("base");this.basePrefix=e.getAttribute("href"),this.baseHref=e.href,window.addEventListener("popstate",this.popStateListener),this.doRouting(window.location.pathname)}destroy(){window.removeEventListener("popstate",this.popStateListener)}doRouting(e){let t=this.getRoute(e);return Promise.resolve(this.routeResolver.resolve(this.lastRoute,t,this)).then((e=>!!e&&(this.routeRenderer.render(e),this.lastRoute=t,!0)))}getRoute(e){let t=e===this.baseHref,n=e.substr(0,this.basePrefix.length)===this.basePrefix;return t?"/":n?e.substring(this.basePrefix.length):e}navigate(e,t,n){let o=new URL(e,this.baseHref);this.doRouting(o.pathname).then((e=>{e&&(n?window.history.replaceState({},t||document.title,o.href):window.history.pushState({},t||document.title,o.href))}))}}class t{constructor(){this.currentComponent=null}render(e){e&&(this.currentComponent&&document.body.removeChild(this.currentComponent),document.body.appendChild(e),this.currentComponent=e)}}var n=s(5965);class o extends class{constructor(e){this.subscriptions=[],this.reducerSubscriptions=[],this.state=e()}subscribe(e,t){let n={area:e,call:t};return this.subscriptions.push(n),()=>{this.subscriptions.splice(this.subscriptions.indexOf(n),1)}}addReducer(e,t){this.reducerSubscriptions.push({area:e,reducer:t})}dispatch(e){let t=[];for(let n of this.reducerSubscriptions){let o;o=n.area?e=>{this.state[n.area]=e(this.state[n.area]),t.push(n.area)}:e=>{this.state=e(this.state),t.push("")};try{n.reducer.onDispatch(e,o)}catch(t){console.error(`Error while dispatching ${e.type}.`,t)}}if(t.length)for(let n of this.subscriptions)if(!n.area||t.indexOf(n.area)>-1)try{n.call(this.state)}catch(t){console.error(`Error while updating on ${n.area||"global"} after ${e.type}.`,t)}}}{}class r{constructor(e,t,n,o,r){this.store=e,this.router=t,this.apiClient=n,this.db=o,this.accountInfoStore=r,this.services={}}get(e,t){return this.services[e]||(this.services[e]=t(this)),this.services[e]}}var i=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};class a{constructor(e){this.db=e}set(e){return i(this,void 0,void 0,(function*(){yield this.db.setAccountInfo(e)}))}get(){return i(this,void 0,void 0,(function*(){return yield this.db.getAccountInfo()}))}clear(){return i(this,void 0,void 0,(function*(){yield this.db.clearAccountInfo()}))}getAccessToken(e){return i(this,void 0,void 0,(function*(){return yield this.db.getAccessToken(e)}))}updateAccessTokenIfNewer(e,t,n){return i(this,void 0,void 0,(function*(){return yield this.db.updateAccessTokenIfNewer(e,t,n)}))}}function c(e,t,n){return o=this,r=void 0,s=function*(){let o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)};return n&&(o.headers=Object.assign(Object.assign({},o.headers),{Authorization:`Bearer ${n}`})),yield fetch(e,o)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,r||[])).next())}));var o,r,i,s}var u=s(7030),d=s(7476),l=s(105);class h{}let f;f="https://kontokorrent.azurewebsites.net";const g="https://kontokorrent.azurewebsites.net";class v{}var p=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const k=g;class b{constructor(e){this.accountInfoStore=e}neuerBenutzer(e,t){return p(this,void 0,void 0,(function*(){try{return(yield c(`${k}/api/v2/accounts`,{id:e,secret:t})).ok?{success:!0}:{success:!1}}catch(e){return{success:!1}}}))}getUserInfo(){return p(this,void 0,void 0,(function*(){let e=yield fetch(`${k}/api/v2/userinfo`,{headers:yield this.getAuthHeader()});return yield e.json()}))}getAuthHeader(){return p(this,void 0,void 0,(function*(){return{Authorization:`Bearer ${yield this.getAccessToken()}`}}))}kontokorrentHinzufuegen(e,t){return p(this,void 0,void 0,(function*(){let n="";n=e?`oeffentlicherName=${encodeURIComponent(e)}`:`einladungsCode=${encodeURIComponent(t)}`;let o=yield this.getAuthHeader(),r=yield fetch(`${k}/api/v2/kontokorrents?${n}`,{method:"PUT",headers:o});return 404==r.status?null:yield r.json()}))}kontokorrentsAuflisten(){return p(this,void 0,void 0,(function*(){let e=yield fetch(`${k}/api/v2/kontokorrents`,{headers:yield this.getAuthHeader()});if(!e.ok)throw new h;return yield e.json()}))}neuerKontokorrent(e){return p(this,void 0,void 0,(function*(){let t=yield c(`${k}/api/v2/kontokorrents`,e,yield this.getAccessToken());return 422==t.status?{success:!1,exists:!0}:t.ok?{success:!0}:{success:!1}}))}getAktionen(e,t){return p(this,void 0,void 0,(function*(){let n=t?`?ab=${t}`:"",o=yield fetch(`${k}/api/v2/kontokorrents/${e}/aktionen${n}`,{headers:yield this.getAuthHeader()});if(404==o.status)return{success:!1,notfound:!0};if(o.ok){let e=yield o.json();return{success:!0,aktionen:this.mapAktionen(e)}}}))}mapAktionen(e){for(let t of e)t.bezahlung&&(t.bezahlung.zeitpunkt=new Date(t.bezahlung.zeitpunkt));return e}neueBezahlung(e,t){return p(this,void 0,void 0,(function*(){let n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/vnd+kontokorrent.hinzufuegenaktion+json",Authorization:`Bearer ${yield this.getAccessToken()}`},body:JSON.stringify(t)},o=yield fetch(`${k}/api/v2/kontokorrents/${e}/aktionen`,n);if(o.ok){let e=yield o.json();return this.mapAktionen([e])[0]}throw new v}))}getAccessToken(){return p(this,void 0,void 0,(function*(){let e=yield this.accountInfoStore.get();if(null==e)throw new Error("Keine Account Information gespeichert.");if(e.type==u.Q.anonym){let t,n=yield this.accountInfoStore.getAccessToken("anonymous");if(null!=n){let{token:e,expires:t}=JSON.parse(n.value);if(e&&t&&t>=+new Date)return e}try{let n=yield c(`${k}/api/v2/token`,{id:e.id,secret:e.secret});if(!n.ok)throw new d.X(!1);t=yield n.json()}catch(e){throw new d.X(!0)}return yield this.accountInfoStore.updateAccessTokenIfNewer("anonymous",JSON.stringify(t),null==n?void 0:n.timestamp),t.token}throw e.type==u.Q.google?new l.G:new Error(`Account Typ ${e.type} unbekannt`)}))}}class y{onDispatch(e,t){switch(e.type){case 0:t((e=>Object.assign(Object.assign({},e),{accountCreating:!0,accountCreationFailed:!1})));break;case 2:t((t=>Object.assign(Object.assign({},t),{accountCreating:!1,accountCreated:!0,accountInfo:e.info})));break;case 1:t((e=>Object.assign(Object.assign({},e),{accountCreationFailed:!0,accountCreating:!1,accountCreated:!1})));break;case 3:t((t=>Object.assign(Object.assign({},t),{accountCreated:!0,accountInfo:e.info})));break;case 4:t((e=>Object.assign(Object.assign({},e),{accountCreated:!1})));break;case 5:t((e=>Object.assign(Object.assign({},e),{loginExpired:!0})));break;case 13:e.interactionRequired&&t((e=>Object.assign(Object.assign({},e),{loginExpired:!0})))}}}var w=s(7001);class m{onDispatch(e,t){switch(e.type){case 11:t((e=>Object.assign(Object.assign({},e),{listeLaden:!0})));break;case 13:t((e=>Object.assign(Object.assign({},e),{listeLaden:!1})));break;case 12:t((t=>Object.assign(Object.assign({},t),{kontokorrents:this.extendMap(t.kontokorrents,e.kontokorrents)})));break;case 10:t((e=>Object.assign(Object.assign({},e),{hinzufuegen:!0})));break;case 9:t((t=>Object.assign(Object.assign({},t),{hinzufuegen:!1,hinzufuegenFailed:{kontokorrentNotFound:e.notFound}})));break;case 20:t((t=>Object.assign(Object.assign({},t),{hinzufuegen:!1,kontokorrents:this.extendMap(t.kontokorrents,e.kontokorrents)})));case 8:t((e=>Object.assign(Object.assign({},e),{creating:!0,creationFailed:null})));break;case 7:t((t=>Object.assign(Object.assign({},t),{creating:!1,creationFailed:{exists:e.exists}})));break;case 21:t((t=>Object.assign(Object.assign({},t),{creating:!1,kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrent.id]:{id:e.kontokorrent.id,name:e.kontokorrent.name,synchronisieren:!1,personen:e.kontokorrent.personen.map((e=>Object.assign({balance:0},e))),bezahlungen:[],bezahlungAnlegen:null}})})));break;case 14:t((t=>Object.assign(Object.assign({},t),{activeKontokorrentId:e.id})));break;case 15:t((t=>Object.assign(Object.assign({},t),{kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrentId]:Object.assign(Object.assign({},t.kontokorrents[e.kontokorrentId]),{bezahlungen:e.bezahlungen})})})));break;case 16:t((t=>Object.assign(Object.assign({},t),{kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrentId]:Object.assign(Object.assign({},t.kontokorrents[e.kontokorrentId]),{synchronisieren:!0})})})));break;case 19:t((t=>Object.assign(Object.assign({},t),{kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrentId]:Object.assign(Object.assign({},t.kontokorrents[e.kontokorrentId]),{synchronisieren:!1})})})));break;case 17:t((t=>this.extendPersonenInfo(t,e.kontokorrentId,Object.entries(e.balance).map((e=>({id:e[0],balance:e[1]}))))));break;case 18:t((e=>Object.assign(Object.assign({},e),{hinzufuegen:!1,hinzufuegenFailed:null})));break;case 4:t((e=>Object.assign(Object.assign({},e),{activeKontokorrentId:null,kontokorrents:{}})));break;case 6:t((t=>this.updateKontokorrentStatus(Object.assign(Object.assign({},t),{activeKontokorrentId:e.kontokorrentId}),e.kontokorrentId,{bezahlungAnlegen:null})));break;case 22:t((t=>this.updateKontokorrentStatus(t,e.kontokorrentId,{bezahlungAnlegen:0})));break;case 24:t((t=>this.updateKontokorrentStatus(t,e.kontokorrentId,{bezahlungAnlegen:2})));break;case 23:t((t=>this.updateKontokorrentStatus(t,e.kontokorrentId,{bezahlungAnlegen:1}))),t((t=>this.upsertBezahlung(t,e.kontokorrentId,e.bezahlung)));break;case 25:t((t=>this.upsertBezahlung(t,e.kontokorrentId,{status:w.Z.Speichern,id:e.bezahlungId})));break;case 26:t((t=>this.upsertBezahlung(t,e.kontokorrentId,{status:w.Z.Gespeichert,id:e.bezahlungId})))}}updateKontokorrentStatus(e,t,n){return Object.assign(Object.assign({},e),{kontokorrents:Object.assign(Object.assign({},e.kontokorrents),{[t]:Object.assign(Object.assign({},e.kontokorrents[t]),n)})})}upsertBezahlung(e,t,n){var o;let r=(null===(o=e.kontokorrents[t])||void 0===o?void 0:o.bezahlungen)||[],i=r.find((e=>n.id==e.id));return i&&r.splice(r.indexOf(i),1),r.push(Object.assign(Object.assign({},i),n)),Object.assign(Object.assign({},e),{kontokorrents:Object.assign(Object.assign({},e.kontokorrents),{[t]:Object.assign(Object.assign({},e.kontokorrents[t]),{bezahlungen:r})})})}extendPersonenInfo(e,t,n){var o;let r=new Map(((null===(o=e.kontokorrents[t])||void 0===o?void 0:o.personen)||[]).map((e=>[e.id,e])));for(let e of n)r.set(e.id,Object.assign(Object.assign({},r.get(e.id)),e));return Object.assign(Object.assign({},e),{kontokorrents:Object.assign(Object.assign({},e.kontokorrents),{[t]:Object.assign(Object.assign({},e.kontokorrents[t]),{personen:Array.from(r.values())})})})}extendMap(e,t){let n={};for(let o of t){let t=Object.assign(Object.assign(Object.assign(Object.assign({},o),{synchronisieren:!1,bezahlungen:[]}),e[o.id]),{personen:o.personen.map((t=>{var n,r;let i=null===(r=null===(n=e[o.id])||void 0===n?void 0:n.personen)||void 0===r?void 0:r.find((e=>e.id==t.id));return Object.assign(Object.assign(Object.assign({},t),{balance:0}),i)}))});n[o.id]=t}return n}}let j,I;const O=new WeakMap,z=new WeakMap,A=new WeakMap,C=new WeakMap,S=new WeakMap;let x={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return z.get(e);if("objectStoreNames"===t)return e.objectStoreNames||A.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return L(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function E(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(I||(I=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(P(this),e),L(O.get(this))}:function(...e){return L(t.apply(P(this),e))}:function(e,...n){const o=t.call(P(this),e,...n);return A.set(o,e.sort?e.sort():[e]),L(o)}:(e instanceof IDBTransaction&&function(e){if(z.has(e))return;const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),o()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));z.set(e,t)}(e),n=e,(j||(j=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,x):e);var t,n}function L(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(L(e.result)),o()},i=()=>{n(e.error),o()};e.addEventListener("success",r),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&O.set(t,e)})).catch((()=>{})),S.set(t,e),t}(e);if(C.has(e))return C.get(e);const t=E(e);return t!==e&&(C.set(e,t),S.set(t,e)),t}const P=e=>S.get(e),K=["get","getKey","getAll","getAllKeys","count"],B=["put","add","delete","clear"],T=new Map;function D(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(T.get(t))return T.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,r=B.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!r&&!K.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let s=i.store;o&&(s=s.index(t.shift()));const a=await s[n](...t);return r&&await i.done,a};return T.set(t,i),i}var N;N=x,x={...N,get:(e,t,n)=>D(e,t)||N.get(e,t,n),has:(e,t)=>!!D(e,t)||N.has(e,t)};var R=s(6600),$=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const F="KontokorrentsStore",Z="AppStateStore",G="AktionenStore",H="NeueBezahlungenStore";class M{withInitialized(e){return $(this,void 0,void 0,(function*(){let t=yield function(e,t,{blocked:n,upgrade:o,blocking:r,terminated:i}={}){const s=indexedDB.open(e,t),a=L(s);return o&&s.addEventListener("upgradeneeded",(e=>{o(L(s.result),e.oldVersion,e.newVersion,L(s.transaction))})),n&&s.addEventListener("blocked",(()=>n())),a.then((e=>{i&&e.addEventListener("close",(()=>i())),r&&e.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}("kontokorrent-db",5,{upgrade(e,t,n){t<1&&e.createObjectStore(F,{keyPath:"id"}).createIndex("oeffentlicherName","oeffentlicherName"),t<2&&e.createObjectStore(Z,{keyPath:"id"}).put({id:0,zuletztGesehenerKontokorrentId:null,accesstokens:[],accountinfo:null}),t<3&&e.createObjectStore(G,{keyPath:["laufendeNummer","kontokorrentId"]}).createIndex("kontokorrentId","kontokorrentId"),t<5&&(e.objectStoreNames.contains(H)&&e.deleteObjectStore(H),e.createObjectStore(H,{keyPath:"id"}).createIndex("kontokorrentId","kontokorrentId"))}});try{return yield e(t)}finally{t.close()}}))}getKontokorrents(){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>$(this,void 0,void 0,(function*(){return(0,R.T)(yield e.getAll(F),(e=>e.name))}))))}))}addAktionen(e,t){return $(this,void 0,void 0,(function*(){if(!t.length)return;let n=t.map((t=>Object.assign(Object.assign({},t),{kontokorrentId:e})));return yield this.withInitialized((t=>{const o=P(t);return new Promise(((t,r)=>{const i=o.transaction(G,"readwrite");i.onerror=e=>{console.error("addAktionen failed",e,i.error),r(i.error)},i.oncomplete=()=>{t()};for(let t of n){let n=i.objectStore(G).add(t);n.onerror=o=>{"ConstraintError"==n.error.name?(console.log(`Aktion ${t.laufendeNummer} für Kontokorrent ${e} bereits gespeichert.`,o,n.error),o.preventDefault(),o.stopPropagation()):console.error(`Aktion ${t.laufendeNummer} für Kontokorrent ${e} konnte nicht gespeichert werden.`,o,n.error)}}}))}))}))}getZuletztGesehenerKontokorrentId(){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>$(this,void 0,void 0,(function*(){let t=yield e.get(Z,0);if(t.zuletztGesehenerKontokorrentId)return t.zuletztGesehenerKontokorrentId;{let e=yield yield this.getKontokorrents();return e.length?e[0].id:null}}))))}))}setZuletztGesehenerKontokorrentId(e){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>$(this,void 0,void 0,(function*(){let n=yield t.get(Z,0);n.zuletztGesehenerKontokorrentId=e,yield t.put(Z,n)}))))}))}setKontokorrents(e){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>$(this,void 0,void 0,(function*(){let n=yield t.getAll(F);for(let o of n.filter((t=>!e.some((e=>t.id===e.id)))))yield t.delete(F,o.id);let o=[];for(let r of e){let e=n.find((e=>e.id==r.id));e||o.push(r.id);let i=Object.assign(Object.assign({},e),{name:r.name,personen:r.personen,id:r.id,oeffentlicherName:r.oeffentlicherName});yield t.put(F,i)}return o}))))}))}addKontokorrent(e){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>$(this,void 0,void 0,(function*(){(yield t.get(F,e.id))||(yield t.add(F,e))}))))}))}getKontokorrent(e){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>$(this,void 0,void 0,(function*(){return yield t.get(F,e)}))))}))}getPerOeffentlichName(e){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>$(this,void 0,void 0,(function*(){return yield t.getFromIndex(F,"oeffentlicherName",e)}))))}))}getAktionen(e){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>$(this,void 0,void 0,(function*(){return yield t.getAllFromIndex(G,"kontokorrentId",e)}))))}))}clear(){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>$(this,void 0,void 0,(function*(){yield e.clear(G),yield e.clear(F),yield e.put(Z,{id:0,zuletztGesehenerKontokorrentId:null,accesstokens:[],accountinfo:null})}))))}))}getAccessToken(e){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>$(this,void 0,void 0,(function*(){return((yield t.get(Z,0)).accesstokens||[]).find((t=>t.type===e))}))))}))}updateAccessTokenIfNewer(e,t,n){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((o=>$(this,void 0,void 0,(function*(){const r=o.transaction(Z,"readwrite",{durability:"strict"});let i=yield r.store.get(0);i.accesstokens||(i.accesstokens=[]);let s=i.accesstokens.find((t=>t.type===e));if(s){if(s.timestamp!=n)return console.error(`The accesstoken of type ${e} was already updated since reading.`),yield r.done,!1;s.value=t,s.timestamp++}else i.accesstokens.push({timestamp:1,type:e,value:t});return yield r.store.put(i),yield r.done,!0}))))}))}setAccountInfo(e){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>$(this,void 0,void 0,(function*(){const n=t.transaction(Z,"readwrite");let o=yield n.store.get(0);o.accountinfo=e,yield n.store.put(o),yield n.done}))))}))}getAccountInfo(){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>$(this,void 0,void 0,(function*(){const t=e.transaction(Z,"readonly");let n=yield t.store.get(0);return null==n?void 0:n.accountinfo}))))}))}clearAccountInfo(){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>$(this,void 0,void 0,(function*(){const t=e.transaction(Z,"readwrite");let n=yield t.store.get(0);n.accountinfo=null,n.accesstokens=[],yield t.store.put(n),yield t.done}))))}))}getZwischengespeicherteBezahlungen(){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>$(this,void 0,void 0,(function*(){return e.getAll(H)}))))}))}getZwischengespeicherteBezahlungenForKontokorrent(e){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>$(this,void 0,void 0,(function*(){return yield t.getAllFromIndex(H,"kontokorrentId",e)}))))}))}bezahlungZwischenspeichern(e){return $(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>$(this,void 0,void 0,(function*(){t.add(H,e)}))))}))}zwischengespeicherteBezahlungErledigt(e){return $(this,void 0,void 0,(function*(){yield this.withInitialized((t=>$(this,void 0,void 0,(function*(){t.delete(H,e)}))))}))}}var W=s(9445),q=s(9717),U=s(6928),V=s(9114);class _{constructor(e,t,n,o,r){this.store=e,this.routingActionCreator=t,this.accountActionCreator=n,this.kontokorrentsActionCreator=o,this.router=r}initializeApplication(){return e=this,t=void 0,r=function*(){if(!(yield(0,q.l)()).allPassed)return this.router.run(),void this.routingActionCreator.navigateFeaturesRequired();let e=yield this.accountActionCreator.initializeAccount();e||window.history.replaceState({},document.title,n.n.Login),this.router.run(),e&&(yield this.kontokorrentsActionCreator.syncKontokorrentListe())},new((o=void 0)||(o=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}));var e,t,o,r}}var Q=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};"serviceWorker"in navigator&&window.addEventListener("load",(()=>Q(void 0,void 0,void 0,(function*(){navigator.serviceWorker.register("./sw.js").then((e=>{console.log("SW registered: ",e)})).catch((e=>{console.log("SW registration failed: ",e)}))})))),function(){return Q(this,void 0,void 0,(function*(){const i=new o((()=>({account:{accountCreated:!1,accountCreating:!1,accountCreationFailed:!1,loginExpired:!1,accountInfo:null},kontokorrents:{hinzufuegen:!1,hinzufuegenFailed:null,creating:!1,creationFailed:null,kontokorrents:{},listeLaden:!1,activeKontokorrentId:null}})));"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",(e=>{var t;if("statedispatch"==(null===(t=e.data)||void 0===t?void 0:t.type)){let t=e.data.msg;i.dispatch(t)}}));const s=new n.W(i),c=new e(s,new t),u=new M;i.addReducer("account",new y),i.addReducer("kontokorrents",new m);const d=new a(u),l=new b(d),h=new r(i,c,l,u,d);s.setServiceLocator(h),yield function(e){return e.get("InitializationActionCreator",(e=>new _(e.store,(0,W.b)(e),(0,U.gg)(e),(0,V.d8)(e),e.router)))}(h).initializeApplication()}))}().catch((e=>console.error(e)))})()})();
//# sourceMappingURL=de24d53830324687d833.bundle.js.map