(()=>{"use strict";const e=Symbol("Comlink.proxy"),t=Symbol("Comlink.endpoint"),n=Symbol("Comlink.releaseProxy"),r=Symbol("Comlink.thrown"),o=e=>"object"==typeof e&&null!==e||"function"==typeof e,i=new Map([["proxy",{canHandle:t=>o(t)&&t[e],serialize(e){const{port1:t,port2:n}=new MessageChannel;return a(e,t),[n,[n]]},deserialize:e=>(e.start(),u(e,[],undefined))}],["throw",{canHandle:e=>o(e)&&r in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function a(t,n=self){n.addEventListener("message",(function o(i){if(!i||!i.data)return;const{id:c,type:u,path:d}=Object.assign({path:[]},i.data),p=(i.data.argumentList||[]).map(h);let v;try{const n=d.slice(0,-1).reduce(((e,t)=>e[t]),t),r=d.reduce(((e,t)=>e[t]),t);switch(u){case 0:v=r;break;case 1:n[d.slice(-1)[0]]=h(i.data.value),v=!0;break;case 2:v=r.apply(n,p);break;case 3:v=function(t){return Object.assign(t,{[e]:!0})}(new r(...p));break;case 4:{const{port1:e,port2:n}=new MessageChannel;a(t,n),v=function(e,t){return l.set(e,t),e}(e,[e])}break;case 5:v=void 0}}catch(e){v={value:e,[r]:0}}Promise.resolve(v).catch((e=>({value:e,[r]:0}))).then((e=>{const[t,r]=f(e);n.postMessage(Object.assign(Object.assign({},t),{id:c}),r),5===u&&(n.removeEventListener("message",o),s(n))}))})),n.start&&n.start()}function s(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function c(e){if(e)throw new Error("Proxy has been released and is not useable")}function u(e,r=[],o=function(){}){let i=!1;const a=new Proxy(o,{get(t,o){if(c(i),o===n)return()=>p(e,{type:5,path:r.map((e=>e.toString()))}).then((()=>{s(e),i=!0}));if("then"===o){if(0===r.length)return{then:()=>a};const t=p(e,{type:0,path:r.map((e=>e.toString()))}).then(h);return t.then.bind(t)}return u(e,[...r,o])},set(t,n,o){c(i);const[a,s]=f(o);return p(e,{type:1,path:[...r,n].map((e=>e.toString())),value:a},s).then(h)},apply(n,o,a){c(i);const s=r[r.length-1];if(s===t)return p(e,{type:4}).then(h);if("bind"===s)return u(e,r.slice(0,-1));const[l,f]=d(a);return p(e,{type:2,path:r.map((e=>e.toString())),argumentList:l},f).then(h)},construct(t,n){c(i);const[o,a]=d(n);return p(e,{type:3,path:r.map((e=>e.toString())),argumentList:o},a).then(h)}});return a}function d(e){const t=e.map(f);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const l=new WeakMap;function f(e){for(const[t,n]of i)if(n.canHandle(e)){const[r,o]=n.serialize(e);return[{type:3,name:t,value:r},o]}return[{type:0,value:e},l.get(e)||[]]}function h(e){switch(e.type){case 3:return i.get(e.name).deserialize(e.value);case 0:return e.value}}function p(e,t,n){return new Promise((r=>{const o=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===o&&(e.removeEventListener("message",t),r(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:o},t),n)}))}function v(e,t){const n=new Map;return e.forEach((e=>{const r=e[t],o=n.get(r);o?o.push(e):n.set(r,[e])})),n}class y{constructor(e,t,n){this.wert=e,this.empfaengerAnzahl=t,this.isEmpfaenger=n}}class m{constructor(e){this.db=e}erweitern(e,t,n){let r=1;for(let e of n)e!=t&&(r*=e);return e*r}calculateBalance(e){return t=this,n=void 0,o=function*(){let t=function(e){let t={},n=e.sort(((e,t)=>e.laufendeNummer-t.laufendeNummer));for(let e of n)e.bearbeiteteBezahlungId&&delete t[e.bearbeiteteBezahlungId],e.geloeschteBezahlungId?delete t[e.geloeschteBezahlungId]:t[e.bezahlung.id]=e.bezahlung;return Object.values(t)}(yield this.db.getAktionen(e)),n=yield this.db.getKontokorrent(e),r={};for(let e of n.personen)r[e.id]=[];for(let e of t)for(let t of e.empfaengerIds)r[t].push(new y(e.wert,e.empfaengerIds.length,!0)),r[e.bezahlendePersonId].push(new y(e.wert,e.empfaengerIds.length,!1));let o={};for(let e of n.personen){let t=v(r[e.id],"empfaengerAnzahl"),n=Array.from(t.keys()),i=Array.from(t.keys()).reduce(((e,t)=>e*t),1);if(i<362880){let r=0;for(let e of t.keys()){let o=t.get(e).reduce(((e,t)=>e+(t.isEmpfaenger?t.wert:-t.wert)),0);r+=this.erweitern(o,e,n)}o[e.id]=r/i}else{let n=0;for(let e of t.keys())n+=t.get(e).reduce(((e,t)=>e+(t.isEmpfaenger?t.wert:-t.wert)),0)/e;o[e.id]=n}}return o},new((r=void 0)||(r=Promise))((function(e,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((o=o.apply(t,n||[])).next())}));var t,n,r,o}}let g,w;const b=new WeakMap,k=new WeakMap,I=new WeakMap,z=new WeakMap,E=new WeakMap;let B={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return k.get(e);if("objectStoreNames"===t)return e.objectStoreNames||I.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return S(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function L(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(w||(w=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(x(this),e),S(b.get(this))}:function(...e){return S(t.apply(x(this),e))}:function(e,...n){const r=t.call(x(this),e,...n);return I.set(r,e.sort?e.sort():[e]),S(r)}:(e instanceof IDBTransaction&&function(e){if(k.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)}));k.set(e,t)}(e),n=e,(g||(g=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,B):e);var t,n}function S(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(S(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&b.set(t,e)})).catch((()=>{})),E.set(t,e),t}(e);if(z.has(e))return z.get(e);const t=L(e);return t!==e&&(z.set(e,t),E.set(t,e)),t}const x=e=>E.get(e),j=["get","getKey","getAll","getAllKeys","count"],D=["put","add","delete","clear"],A=new Map;function N(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(A.get(t))return A.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=D.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!j.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,o?"readwrite":"readonly");let a=i.store;r&&(a=a.index(t.shift()));const s=await a[n](...t);return o&&await i.done,s};return A.set(t,i),i}var P;P=B,B={...P,get:(e,t,n)=>N(e,t)||P.get(e,t,n),has:(e,t)=>!!N(e,t)||P.has(e,t)};var M=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};const O="KontokorrentsStore",K="AppStateStore",C="AktionenStore";class G{constructor(e){this.db=e}getLaufendeNummer(e){return t=this,n=void 0,o=function*(){let t=yield this.db.getAktionen(e);return Math.max(...t.map((e=>e.laufendeNummer)))},new((r=void 0)||(r=Promise))((function(e,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((o=o.apply(t,n||[])).next())}));var t,n,r,o}}var T=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};const W=new class{withInitialized(e){return M(this,void 0,void 0,(function*(){let t=yield function(e,t,{blocked:n,upgrade:r,blocking:o,terminated:i}={}){const a=indexedDB.open(e,t),s=S(a);return r&&a.addEventListener("upgradeneeded",(e=>{r(S(a.result),e.oldVersion,e.newVersion,S(a.transaction))})),n&&a.addEventListener("blocked",(()=>n())),s.then((e=>{i&&e.addEventListener("close",(()=>i())),o&&e.addEventListener("versionchange",(()=>o()))})).catch((()=>{})),s}("kontokorrent-db",3,{upgrade(e,t,n){t<1&&e.createObjectStore(O,{keyPath:"id"}).createIndex("oeffentlicherName","oeffentlicherName"),t<2&&e.createObjectStore(K,{keyPath:"id"}).put({id:0,zuletztGesehenerKontokorrentId:null}),t<3&&e.createObjectStore(C,{keyPath:["laufendeNummer","kontokorrentId"]}).createIndex("kontokorrentId","kontokorrentId")}});try{return yield e(t)}finally{t.close()}}))}getKontokorrents(){return M(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>M(this,void 0,void 0,(function*(){return t=yield e.getAll(O),n=e=>e.name,t.sort(((e,t)=>n(e).toLowerCase().localeCompare(n(t).toLowerCase())));var t,n}))))}))}addAktionen(e,t){return M(this,void 0,void 0,(function*(){if(t.length)return yield this.withInitialized((n=>M(this,void 0,void 0,(function*(){const r=n.transaction(C,"readwrite");let o=t.map((t=>Object.assign(Object.assign({},t),{kontokorrentId:e}))).map((e=>r.store.add(e)));yield Promise.all(o),yield r.done}))))}))}getZuletztGesehenerKontokorrentId(){return M(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>M(this,void 0,void 0,(function*(){let t=yield e.get(K,0);if(t.zuletztGesehenerKontokorrentId)return t.zuletztGesehenerKontokorrentId;{let e=yield yield this.getKontokorrents();return e.length?e[0].id:null}}))))}))}setZuletztGesehenerKontokorrentId(e){return M(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>M(this,void 0,void 0,(function*(){let n=yield t.get(K,0);n.zuletztGesehenerKontokorrentId=e,yield t.put(K,n)}))))}))}setKontokorrents(e){return M(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>M(this,void 0,void 0,(function*(){let n=yield t.getAll(O);for(let r of n.filter((t=>!e.some((e=>t.id===e.id)))))yield t.delete(O,r.id);let r=[];for(let o of e){let e=n.find((e=>e.id==o.id));e||r.push(o.id);let i=Object.assign(Object.assign({},e),{name:o.name,personen:o.personen,id:o.id,oeffentlicherName:o.oeffentlicherName});yield t.put(O,i)}return r}))))}))}addKontokorrent(e){return M(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>M(this,void 0,void 0,(function*(){(yield t.get(O,e.id))||(yield t.add(O,e))}))))}))}getKontokorrent(e){return M(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>M(this,void 0,void 0,(function*(){return yield t.get(O,e)}))))}))}getPerOeffentlichName(e){return M(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>M(this,void 0,void 0,(function*(){return yield t.getFromIndex(O,"oeffentlicherName",e)}))))}))}getAktionen(e){return M(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>M(this,void 0,void 0,(function*(){return yield t.getAllFromIndex(C,"kontokorrentId",e)}))))}))}clear(){return M(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>M(this,void 0,void 0,(function*(){yield e.clear(C),yield e.clear(O),yield e.put(K,{id:0,zuletztGesehenerKontokorrentId:null})}))))}))}};a({calculateBalance:function(e){return T(this,void 0,void 0,(function*(){return yield new m(W).calculateBalance(e)}))},getLaufendeNummer:function(e){return T(this,void 0,void 0,(function*(){return yield new G(W).getLaufendeNummer(e)}))}},self)})();
//# sourceMappingURL=cf9de2b3741d605bb5f7.bundle.js.map