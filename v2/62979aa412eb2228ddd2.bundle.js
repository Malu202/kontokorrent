(()=>{var e,t,n,r,o={199:e=>{e.exports="<h1>Speicherzugriff benötigt</h1> Kontokorrent speichert die Zahlungen und weitere Informationen im lokalen Speicher dieses Geräts. Auf diese Weise kann man für einige Tage eingeloggt bleiben, und die Anwendung auch verwenden, wenn die Internetverbindung schlecht ist. In den meisten Browsern (Chrome, Edge) muss dazu der Webseite erlaubt werden <strong>Cookies</strong> zu speichern. Nachdem die Berechtigung erteilt wurde die Webseite neu laden."},105:(e,t,n)=>{"use strict";n.d(t,{G:()=>r});class r{}},476:(e,t,n)=>{"use strict";n.d(t,{X:()=>r});class r{constructor(e){this.networkError=e}}},30:(e,t,n)=>{"use strict";var r;n.d(t,{Q:()=>r}),function(e){e.google="google",e.anonym="anonym"}(r||(r={}))},717:(e,t,n)=>{"use strict";n.d(t,{l:()=>o});var r=n(586);function o(){return new Promise(((e,t)=>{if("indexedDB"in window){const t=(0,r.Z)();let n=window.indexedDB.open(t,1);n.onsuccess=()=>{e({allPassed:!0}),n.result.close(),window.indexedDB.deleteDatabase(t)},n.onerror=()=>{e({allPassed:!1})}}else e({allPassed:!1})}))}},965:(e,t,n)=>{"use strict";n.d(t,{W:()=>u,n:()=>r});var r,o=n(199),s=n.n(o),a=n(445),i=n(717);class c extends HTMLElement{constructor(){super(),this.innerHTML=s()}addServices(e){this.routingActionCreator=(0,a.b)(e)}connectedCallback(){(0,i.l)().then((e=>{e.allPassed&&(this.routingActionCreator.navigateHome(),window.location.reload())}))}disconnectedCallback(){}}customElements.define("app-features-required",c),function(e){e.Login="login",e.Info="info",e.Home="",e.FeaturesRequired="features-required",e.Kontokorrents="kontokorrents",e.CreateEvent="create-event",e.BezahlungEintragen="eintragen"}(r||(r={}));class u extends EventTarget{constructor(e){super(),this.store=e}setServiceLocator(e){this.serviceLocator=e}async getKontokorrentPageComponent(){const{KontokorrentPage:e}=await n.e(634).then(n.bind(n,527));let t=new e;return t.addServices(this.serviceLocator),t}async resolve(e,t,o){switch(t in r&&this.dispatchEvent(new CustomEvent("routedTo",{detail:{currentRoute:t}})),t){case r.Info:const{Info:e}=await n.e(184).then(n.bind(n,184));let t=new e;return t.addServices(this.serviceLocator),t;case r.FeaturesRequired:{let e=new c;return e.addServices(this.serviceLocator),e}case r.Login:{const{Login:e}=await n.e(259).then(n.bind(n,560));let t=new e;return t.addServices(this.serviceLocator),t}case r.CreateEvent:{const{CreateKontokorrent:e}=await n.e(785).then(n.bind(n,785));let t=new e;return t.addServices(this.serviceLocator),t}}if(!this.store.state.account.accountCreated)return!1;switch(t){case r.BezahlungEintragen:const{BezahlungEintragenPage:e}=await n.e(988).then(n.bind(n,450));let t=new e;return t.addServices(this.serviceLocator),t}let s=/^kontokorrents\/([a-zA-Z0-9\-]+)$/.exec(t);if(s){let e=s[1],t=await this.getKontokorrentPageComponent();return t.setRouteParameters(e),t}let a=await this.getKontokorrentPageComponent();return a.addServices(this.serviceLocator),a}}},1:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>r}),function(e){e.Zwischengespeichert="zwischengespeichert",e.Speichern="speichern",e.Gespeichert="gespeichert"}(r||(r={}))},928:(e,t,n)=>{"use strict";n.d(t,{gg:()=>p});var r=n(586),o=n(30),s=n(445),a=n(476),i=n(105);class c{constructor(){this.type=0}}class u{constructor(){this.type=1}}class d{constructor(e){this.info=e,this.type=2}}class l{constructor(e){this.info=e,this.type=3}}class h{constructor(){this.type=4}}class g{constructor(){this.type=5}}class k{constructor(e,t,n,r,o){this.store=e,this.apiClient=t,this.accountInfoStore=n,this.routingActionCreator=r,this.db=o}async initializeAccount(){let e=await this.accountInfoStore.get();return!!e&&(this.store.dispatch(new l(e)),this.getUserInfo(),!0)}async getUserInfo(){try{await this.apiClient.getUserInfo()}catch(e){if(e instanceof a.X){let t=await this.accountInfoStore.get();e.networkError||t.type!=o.Q.anonym||(await this.accountInfoStore.clear(),window.location.reload())}else e instanceof i.G&&this.store.dispatch(new g)}}async ensureAccount(){if(!this.store.state.account.accountCreated){let e={id:(0,r.Z)(),secret:(0,r.Z)(),type:o.Q.anonym};this.store.dispatch(new c);let t=await this.apiClient.neuerBenutzer(e.id,e.secret);return t.success?(this.store.dispatch(new d(e)),await this.accountInfoStore.set(e)):this.store.dispatch(new u),t.success}return!0}async logout(){await this.accountInfoStore.clear(),await this.db.clear(),this.store.dispatch(new h),this.routingActionCreator.navigateLogin()}}function p(e){return e.get("AccountActionCreator",(e=>new k(e.store,e.apiClient,e.accountInfoStore,(0,s.b)(e),e.db)))}},114:(e,t,n)=>{"use strict";n.d(t,{d8:()=>u});var r=n(105),o=n(445);class s{constructor(){this.type=11}}class a{constructor(e){this.kontokorrents=e,this.type=12}}class i{constructor(e){this.interactionRequired=e,this.type=13}}class c{constructor(e,t,n,r){this.store=e,this.apiClient=t,this.routingActionCreator=n,this.db=r}async navigiereZuLetztGesehenem(e){let t=await this.db.getZuletztGesehenerKontokorrentId();return!!t&&(this.routingActionCreator.navigateKontokorrent(t,e),!0)}async syncKontokorrentListe(){this.store.dispatch(new s);const e=this.apiClient.kontokorrentsAuflisten();let t=await this.db.getKontokorrents();this.store.dispatch(new a(t));try{let t=await e;await this.db.setKontokorrents(t.map((e=>({id:e.id,name:e.name,personen:e.personen,oeffentlicherName:e.oeffentlicherName})))),this.store.dispatch(new a(t))}catch(e){e instanceof r.G?this.store.dispatch(new i(!0)):this.store.dispatch(new i(!1))}}}function u(e){return e.get("KontokorrentListenActionCreator",(e=>new c(e.store,e.apiClient,(0,o.b)(e),e.db)))}},445:(e,t,n)=>{"use strict";n.d(t,{b:()=>s});var r=n(965);class o{constructor(e){this.router=e}navigateHome(){this.router.navigate(r.n.Home,null)}navigateLogin(e){this.router.navigate(r.n.Login,null,e)}navigateFeaturesRequired(){this.router.navigate(r.n.FeaturesRequired,null)}navigate(e){this.router.navigate(e,null)}navigateKontokorrent(e,t){this.router.navigate(`${r.n.Kontokorrents}/${e}`,null,t)}}function s(e){return e.get("RoutingActionCreator",(e=>new o(e.router)))}},600:(e,t,n)=>{"use strict";function r(e,t){return e.sort(((e,n)=>t(e).toLowerCase().localeCompare(t(n).toLowerCase())))}n.d(t,{T:()=>r})},586:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>d});var o=new Uint8Array(16);function s(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}const a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,i=function(e){return"string"==typeof e&&a.test(e)};for(var c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));const d=function(e,t,n){var r=(e=e||{}).random||(e.rng||s)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!i(n))throw TypeError("Stringified UUID is invalid");return n}(r)}}},s={};function a(e){if(s[e])return s[e].exports;var t=s[e]={exports:{}};return o[e](t,t.exports,a),t.exports}a.m=o,a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,n)=>(a.f[n](e,t),t)),[])),a.u=e=>({184:"39b40067ec9688fa767d",259:"6c221b1e04349286a495",634:"2544eac3d05ba7044328",726:"25ae1cc2139bf1bb9844",785:"84249958d19040f9ee4f",988:"f5b1496a7ea51061cefb"}[e]+".bundle.js"),a.miniCssF=e=>(826===e?"index":e)+"."+{184:"31d6cfe0d16ae931b73c",259:"cbdb2e7b4f859e70a8da",634:"185d56889bc9dc7bab20",726:"31d6cfe0d16ae931b73c",785:"31d6cfe0d16ae931b73c",988:"4c6d8ebaade5139cbd65"}[e]+".css",a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="kontokorrent:",a.l=(n,r,o)=>{if(e[n])e[n].push(r);else{var s,i;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+o){s=d;break}}s||(i=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",t+o),s.src=n),e[n]=[r];var l=(t,r)=>{s.onerror=s.onload=null,clearTimeout(h);var o=e[n];if(delete e[n],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((e=>e(r))),t)return t(r)},h=setTimeout(l.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=l.bind(null,s.onerror),s.onload=l.bind(null,s.onload),i&&document.head.appendChild(s)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="/v2/",n=e=>new Promise(((t,n)=>{var r=a.miniCssF(e),o=a.p+r;if(((e,t)=>{for(var n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var o=(a=n[r]).getAttribute("data-href")||a.getAttribute("href");if("stylesheet"===a.rel&&(o===e||o===t))return a}var s=document.getElementsByTagName("style");for(r=0;r<s.length;r++){var a;if((o=(a=s[r]).getAttribute("data-href"))===e||o===t)return a}})(r,o))return t();((e,t,n,r)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.onerror=o.onload=s=>{if(o.onerror=o.onload=null,"load"===s.type)n();else{var a=s&&("load"===s.type?"missing":s.type),i=s&&s.target&&s.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+i+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=a,c.request=i,o.parentNode.removeChild(o),r(c)}},o.href=t,document.head.appendChild(o)})(e,o,t,n)})),r={826:0},a.f.miniCss=(e,t)=>{r[e]?t.push(r[e]):0!==r[e]&&{259:1,634:1,988:1}[e]&&t.push(r[e]=n(e).then((()=>{r[e]=0}),(t=>{throw delete r[e],t})))},(()=>{a.b=document.baseURI||self.location.href;var e={826:0};a.f.j=(t,n)=>{var r=a.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,o)=>{r=e[t]=[n,o]}));n.push(r[2]=o);var s=a.p+a.u(t),i=new Error;a.l(s,(n=>{if(a.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;i.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",i.name="ChunkLoadError",i.type=o,i.request=s,r[1](i)}}),"chunk-"+t)}};var t=(t,n)=>{for(var r,o,[s,i,c]=n,u=0,d=[];u<s.length;u++)o=s[u],a.o(e,o)&&e[o]&&d.push(e[o][0]),e[o]=0;for(r in i)a.o(i,r)&&(a.m[r]=i[r]);for(c&&c(a),t&&t(n);d.length;)d.shift()()},n=self.webpackChunkkontokorrent=self.webpackChunkkontokorrent||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";class e{constructor(e,t){this.routeResolver=e,this.routeRenderer=t,this.lastRoute=null,this.popStateListener=this.handlePopState.bind(this)}handlePopState(e){this.doRouting(window.location.pathname)}run(){let e=document.querySelector("base");this.basePrefix=e.getAttribute("href"),this.baseHref=e.href,window.addEventListener("popstate",this.popStateListener),this.doRouting(window.location.pathname)}destroy(){window.removeEventListener("popstate",this.popStateListener)}doRouting(e){let t=this.getRoute(e);return Promise.resolve(this.routeResolver.resolve(this.lastRoute,t,this)).then((e=>!!e&&(this.routeRenderer.render(e),this.lastRoute=t,!0)))}getRoute(e){let t=e===this.baseHref,n=e.substr(0,this.basePrefix.length)===this.basePrefix;return t?"/":n?e.substring(this.basePrefix.length):e}navigate(e,t,n){let r=new URL(e,this.baseHref);this.doRouting(r.pathname).then((e=>{e&&(n?window.history.replaceState({},t||document.title,r.href):window.history.pushState({},t||document.title,r.href))}))}}class t{constructor(){this.currentComponent=null}render(e){e&&(this.currentComponent&&document.body.removeChild(this.currentComponent),document.body.appendChild(e),this.currentComponent=e)}}var n=a(965);class r extends class{constructor(e){this.subscriptions=[],this.reducerSubscriptions=[],this.state=e()}subscribe(e,t){let n={area:e,call:t};return this.subscriptions.push(n),()=>{this.subscriptions.splice(this.subscriptions.indexOf(n),1)}}addReducer(e,t){this.reducerSubscriptions.push({area:e,reducer:t})}dispatch(e){let t=[];for(let n of this.reducerSubscriptions){let r;r=n.area?e=>{this.state[n.area]=e(this.state[n.area]),t.push(n.area)}:e=>{this.state=e(this.state),t.push("")};try{n.reducer.onDispatch(e,r)}catch(t){console.error(`Error while dispatching ${e.type}.`,t)}}if(t.length)for(let n of this.subscriptions)if(!n.area||t.indexOf(n.area)>-1)try{n.call(this.state)}catch(t){console.error(`Error while updating on ${n.area||"global"} after ${e.type}.`,t)}}}{}class o{constructor(e,t,n,r,o){this.store=e,this.router=t,this.apiClient=n,this.db=r,this.accountInfoStore=o,this.services={}}get(e,t){return this.services[e]||(this.services[e]=t(this)),this.services[e]}}class s{constructor(e){this.db=e}async set(e){await this.db.setAccountInfo(e)}async get(){return await this.db.getAccountInfo()}async clear(){await this.db.clearAccountInfo()}async getAccessToken(e){return await this.db.getAccessToken(e)}async updateAccessTokenIfNewer(e,t,n){return await this.db.updateAccessTokenIfNewer(e,t,n)}}async function i(e,t,n){let r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)};return n&&(r.headers=Object.assign(Object.assign({},r.headers),{Authorization:`Bearer ${n}`})),await fetch(e,r)}var c=a(30),u=a(476),d=a(105);class l{}let h;h="https://kontokorrent.azurewebsites.net";const g="https://kontokorrent.azurewebsites.net";class k{}const p=g;class f{constructor(e){this.accountInfoStore=e}async neuerBenutzer(e,t){try{return(await i(`${p}/api/v2/accounts`,{id:e,secret:t})).ok?{success:!0}:{success:!1}}catch(e){return{success:!1}}}async getUserInfo(){let e=await fetch(`${p}/api/v2/userinfo`,{headers:await this.getAuthHeader()});return await e.json()}async getAuthHeader(){return{Authorization:`Bearer ${await this.getAccessToken()}`}}async kontokorrentHinzufuegen(e,t){let n="";n=e?`oeffentlicherName=${encodeURIComponent(e)}`:`einladungsCode=${encodeURIComponent(t)}`;let r=await this.getAuthHeader(),o=await fetch(`${p}/api/v2/kontokorrents?${n}`,{method:"PUT",headers:r});return 404==o.status?null:await o.json()}async kontokorrentsAuflisten(){let e=await fetch(`${p}/api/v2/kontokorrents`,{headers:await this.getAuthHeader()});if(!e.ok)throw new l;return await e.json()}async neuerKontokorrent(e){let t=await i(`${p}/api/v2/kontokorrents`,e,await this.getAccessToken());return 422==t.status?{success:!1,exists:!0}:t.ok?{success:!0}:{success:!1}}async getAktionen(e,t){let n=t?`?ab=${t}`:"",r=await fetch(`${p}/api/v2/kontokorrents/${e}/aktionen${n}`,{headers:await this.getAuthHeader()});if(404==r.status)return{success:!1,notfound:!0};if(r.ok){let e=await r.json();return{success:!0,aktionen:this.mapAktionen(e)}}}mapAktionen(e){for(let t of e)t.bezahlung&&(t.bezahlung.zeitpunkt=new Date(t.bezahlung.zeitpunkt));return e}async neueBezahlung(e,t){let n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/vnd+kontokorrent.hinzufuegenaktion+json",Authorization:`Bearer ${await this.getAccessToken()}`},body:JSON.stringify(t)},r=await fetch(`${p}/api/v2/kontokorrents/${e}/aktionen`,n);if(r.ok){let e=await r.json();return this.mapAktionen([e])[0]}throw new k}async getAccessToken(){let e=await this.accountInfoStore.get();if(null==e)throw new Error("Keine Account Information gespeichert.");if(e.type==c.Q.anonym){let t,n=await this.accountInfoStore.getAccessToken("anonymous");if(null!=n){let{token:e,expires:t}=JSON.parse(n.value);if(e&&t&&t>=+new Date)return e}try{let n=await i(`${p}/api/v2/token`,{id:e.id,secret:e.secret});if(!n.ok)throw new u.X(!1);t=await n.json()}catch(e){throw new u.X(!0)}return await this.accountInfoStore.updateAccessTokenIfNewer("anonymous",JSON.stringify(t),null==n?void 0:n.timestamp),t.token}throw e.type==c.Q.google?new d.G:new Error(`Account Typ ${e.type} unbekannt`)}}class b{onDispatch(e,t){switch(e.type){case 0:t((e=>Object.assign(Object.assign({},e),{accountCreating:!0,accountCreationFailed:!1})));break;case 2:t((t=>Object.assign(Object.assign({},t),{accountCreating:!1,accountCreated:!0,accountInfo:e.info})));break;case 1:t((e=>Object.assign(Object.assign({},e),{accountCreationFailed:!0,accountCreating:!1,accountCreated:!1})));break;case 3:t((t=>Object.assign(Object.assign({},t),{accountCreated:!0,accountInfo:e.info})));break;case 4:t((e=>Object.assign(Object.assign({},e),{accountCreated:!1})));break;case 5:t((e=>Object.assign(Object.assign({},e),{loginExpired:!0})));break;case 13:e.interactionRequired&&t((e=>Object.assign(Object.assign({},e),{loginExpired:!0})))}}}var w=a(1);class y{onDispatch(e,t){switch(e.type){case 11:t((e=>Object.assign(Object.assign({},e),{listeLaden:!0})));break;case 13:t((e=>Object.assign(Object.assign({},e),{listeLaden:!1})));break;case 12:t((t=>Object.assign(Object.assign({},t),{kontokorrents:this.extendMap(t.kontokorrents,e.kontokorrents)})));break;case 10:t((e=>Object.assign(Object.assign({},e),{hinzufuegen:!0})));break;case 9:t((t=>Object.assign(Object.assign({},t),{hinzufuegen:!1,hinzufuegenFailed:{kontokorrentNotFound:e.notFound}})));break;case 20:t((t=>Object.assign(Object.assign({},t),{hinzufuegen:!1,kontokorrents:this.extendMap(t.kontokorrents,e.kontokorrents)})));case 8:t((e=>Object.assign(Object.assign({},e),{creating:!0,creationFailed:null})));break;case 7:t((t=>Object.assign(Object.assign({},t),{creating:!1,creationFailed:{exists:e.exists}})));break;case 21:t((t=>Object.assign(Object.assign({},t),{creating:!1,kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrent.id]:{id:e.kontokorrent.id,name:e.kontokorrent.name,synchronisieren:!1,personen:e.kontokorrent.personen.map((e=>Object.assign({balance:0},e))),bezahlungen:[],bezahlungAnlegen:null}})})));break;case 14:t((t=>Object.assign(Object.assign({},t),{activeKontokorrentId:e.id})));break;case 15:t((t=>Object.assign(Object.assign({},t),{kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrentId]:Object.assign(Object.assign({},t.kontokorrents[e.kontokorrentId]),{bezahlungen:e.bezahlungen})})})));break;case 16:t((t=>Object.assign(Object.assign({},t),{kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrentId]:Object.assign(Object.assign({},t.kontokorrents[e.kontokorrentId]),{synchronisieren:!0})})})));break;case 19:t((t=>Object.assign(Object.assign({},t),{kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrentId]:Object.assign(Object.assign({},t.kontokorrents[e.kontokorrentId]),{synchronisieren:!1})})})));break;case 17:t((t=>this.extendPersonenInfo(t,e.kontokorrentId,Object.entries(e.balance).map((e=>({id:e[0],balance:e[1]}))))));break;case 18:t((e=>Object.assign(Object.assign({},e),{hinzufuegen:!1,hinzufuegenFailed:null})));break;case 4:t((e=>Object.assign(Object.assign({},e),{activeKontokorrentId:null,kontokorrents:{}})));break;case 6:t((t=>this.updateKontokorrentStatus(Object.assign(Object.assign({},t),{activeKontokorrentId:e.kontokorrentId}),e.kontokorrentId,{bezahlungAnlegen:null})));break;case 22:t((t=>this.updateKontokorrentStatus(t,e.kontokorrentId,{bezahlungAnlegen:0})));break;case 24:t((t=>this.updateKontokorrentStatus(t,e.kontokorrentId,{bezahlungAnlegen:2})));break;case 23:t((t=>this.updateKontokorrentStatus(t,e.kontokorrentId,{bezahlungAnlegen:1}))),t((t=>this.upsertBezahlung(t,e.kontokorrentId,e.bezahlung)));break;case 25:t((t=>this.upsertBezahlung(t,e.kontokorrentId,{status:w.Z.Speichern,id:e.bezahlungId})));break;case 26:t((t=>this.upsertBezahlung(t,e.kontokorrentId,{status:w.Z.Gespeichert,id:e.bezahlungId})))}}updateKontokorrentStatus(e,t,n){return Object.assign(Object.assign({},e),{kontokorrents:Object.assign(Object.assign({},e.kontokorrents),{[t]:Object.assign(Object.assign({},e.kontokorrents[t]),n)})})}upsertBezahlung(e,t,n){var r;let o=(null===(r=e.kontokorrents[t])||void 0===r?void 0:r.bezahlungen)||[],s=o.find((e=>n.id==e.id));return s&&o.splice(o.indexOf(s),1),o.push(Object.assign(Object.assign({},s),n)),Object.assign(Object.assign({},e),{kontokorrents:Object.assign(Object.assign({},e.kontokorrents),{[t]:Object.assign(Object.assign({},e.kontokorrents[t]),{bezahlungen:o})})})}extendPersonenInfo(e,t,n){var r;let o=new Map(((null===(r=e.kontokorrents[t])||void 0===r?void 0:r.personen)||[]).map((e=>[e.id,e])));for(let e of n)o.set(e.id,Object.assign(Object.assign({},o.get(e.id)),e));return Object.assign(Object.assign({},e),{kontokorrents:Object.assign(Object.assign({},e.kontokorrents),{[t]:Object.assign(Object.assign({},e.kontokorrents[t]),{personen:Array.from(o.values())})})})}extendMap(e,t){let n={};for(let r of t){let t=Object.assign(Object.assign(Object.assign(Object.assign({},r),{synchronisieren:!1,bezahlungen:[]}),e[r.id]),{personen:r.personen.map((t=>{var n,o;let s=null===(o=null===(n=e[r.id])||void 0===n?void 0:n.personen)||void 0===o?void 0:o.find((e=>e.id==t.id));return Object.assign(Object.assign(Object.assign({},t),{balance:0}),s)}))});n[r.id]=t}return n}}let v,m;const j=new WeakMap,I=new WeakMap,O=new WeakMap,z=new WeakMap,A=new WeakMap;let C={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return I.get(e);if("objectStoreNames"===t)return e.objectStoreNames||O.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return E(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function S(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(m||(m=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(L(this),e),E(j.get(this))}:function(...e){return E(t.apply(L(this),e))}:function(e,...n){const r=t.call(L(this),e,...n);return O.set(r,e.sort?e.sort():[e]),E(r)}:(e instanceof IDBTransaction&&function(e){if(I.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)}));I.set(e,t)}(e),n=e,(v||(v=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,C):e);var t,n}function E(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{t(E(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&j.set(t,e)})).catch((()=>{})),A.set(t,e),t}(e);if(z.has(e))return z.get(e);const t=S(e);return t!==e&&(z.set(e,t),A.set(t,e)),t}const L=e=>A.get(e),K=["get","getKey","getAll","getAllKeys","count"],x=["put","add","delete","clear"],B=new Map;function P(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(B.get(t))return B.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=x.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!K.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,o?"readwrite":"readonly");let a=s.store;r&&(a=a.index(t.shift()));const i=await a[n](...t);return o&&await s.done,i};return B.set(t,s),s}var T;T=C,C={...T,get:(e,t,n)=>P(e,t)||T.get(e,t,n),has:(e,t)=>!!P(e,t)||T.has(e,t)};var D=a(600);const N="KontokorrentsStore",R="AppStateStore",$="AktionenStore",F="NeueBezahlungenStore";class Z{async withInitialized(e){let t=await function(e,t,{blocked:n,upgrade:r,blocking:o,terminated:s}={}){const a=indexedDB.open(e,t),i=E(a);return r&&a.addEventListener("upgradeneeded",(e=>{r(E(a.result),e.oldVersion,e.newVersion,E(a.transaction))})),n&&a.addEventListener("blocked",(()=>n())),i.then((e=>{s&&e.addEventListener("close",(()=>s())),o&&e.addEventListener("versionchange",(()=>o()))})).catch((()=>{})),i}("kontokorrent-db",5,{upgrade(e,t,n){t<1&&e.createObjectStore(N,{keyPath:"id"}).createIndex("oeffentlicherName","oeffentlicherName"),t<2&&e.createObjectStore(R,{keyPath:"id"}).put({id:0,zuletztGesehenerKontokorrentId:null,accesstokens:[],accountinfo:null}),t<3&&e.createObjectStore($,{keyPath:["laufendeNummer","kontokorrentId"]}).createIndex("kontokorrentId","kontokorrentId"),t<5&&(e.objectStoreNames.contains(F)&&e.deleteObjectStore(F),e.createObjectStore(F,{keyPath:"id"}).createIndex("kontokorrentId","kontokorrentId"))}});try{return await e(t)}finally{t.close()}}async getKontokorrents(){return await this.withInitialized((async e=>(0,D.T)(await e.getAll(N),(e=>e.name))))}async addAktionen(e,t){if(!t.length)return;let n=t.map((t=>Object.assign(Object.assign({},t),{kontokorrentId:e})));return await this.withInitialized((t=>{const r=L(t);return new Promise(((t,o)=>{const s=r.transaction($,"readwrite");s.onerror=e=>{console.error("addAktionen failed",e,s.error),o(s.error)},s.oncomplete=()=>{t()};for(let t of n){let n=s.objectStore($).add(t);n.onerror=r=>{"ConstraintError"==n.error.name?(console.log(`Aktion ${t.laufendeNummer} für Kontokorrent ${e} bereits gespeichert.`,r,n.error),r.preventDefault(),r.stopPropagation()):console.error(`Aktion ${t.laufendeNummer} für Kontokorrent ${e} konnte nicht gespeichert werden.`,r,n.error)}}}))}))}async getZuletztGesehenerKontokorrentId(){return await this.withInitialized((async e=>{let t=await e.get(R,0);if(t.zuletztGesehenerKontokorrentId)return t.zuletztGesehenerKontokorrentId;{let e=await await this.getKontokorrents();return e.length?e[0].id:null}}))}async setZuletztGesehenerKontokorrentId(e){return await this.withInitialized((async t=>{let n=await t.get(R,0);n.zuletztGesehenerKontokorrentId=e,await t.put(R,n)}))}async setKontokorrents(e){return await this.withInitialized((async t=>{let n=await t.getAll(N);for(let r of n.filter((t=>!e.some((e=>t.id===e.id)))))await t.delete(N,r.id);let r=[];for(let o of e){let e=n.find((e=>e.id==o.id));e||r.push(o.id);let s=Object.assign(Object.assign({},e),{name:o.name,personen:o.personen,id:o.id,oeffentlicherName:o.oeffentlicherName});await t.put(N,s)}return r}))}async addKontokorrent(e){return await this.withInitialized((async t=>{await t.get(N,e.id)||await t.add(N,e)}))}async getKontokorrent(e){return await this.withInitialized((async t=>await t.get(N,e)))}async getPerOeffentlichName(e){return await this.withInitialized((async t=>await t.getFromIndex(N,"oeffentlicherName",e)))}async getAktionen(e){return await this.withInitialized((async t=>await t.getAllFromIndex($,"kontokorrentId",e)))}async clear(){return await this.withInitialized((async e=>{await e.clear($),await e.clear(N),await e.put(R,{id:0,zuletztGesehenerKontokorrentId:null,accesstokens:[],accountinfo:null})}))}async getAccessToken(e){return await this.withInitialized((async t=>((await t.get(R,0)).accesstokens||[]).find((t=>t.type===e))))}async updateAccessTokenIfNewer(e,t,n){return await this.withInitialized((async r=>{const o=r.transaction(R,"readwrite",{durability:"strict"});let s=await o.store.get(0);s.accesstokens||(s.accesstokens=[]);let a=s.accesstokens.find((t=>t.type===e));if(a){if(a.timestamp!=n)return console.error(`The accesstoken of type ${e} was already updated since reading.`),await o.done,!1;a.value=t,a.timestamp++}else s.accesstokens.push({timestamp:1,type:e,value:t});return await o.store.put(s),await o.done,!0}))}async setAccountInfo(e){return await this.withInitialized((async t=>{const n=t.transaction(R,"readwrite");let r=await n.store.get(0);r.accountinfo=e,await n.store.put(r),await n.done}))}async getAccountInfo(){return await this.withInitialized((async e=>{const t=e.transaction(R,"readonly");let n=await t.store.get(0);return null==n?void 0:n.accountinfo}))}async clearAccountInfo(){return await this.withInitialized((async e=>{const t=e.transaction(R,"readwrite");let n=await t.store.get(0);n.accountinfo=null,n.accesstokens=[],await t.store.put(n),await t.done}))}async getZwischengespeicherteBezahlungen(){return await this.withInitialized((async e=>e.getAll(F)))}async getZwischengespeicherteBezahlungenForKontokorrent(e){return await this.withInitialized((async t=>await t.getAllFromIndex(F,"kontokorrentId",e)))}async bezahlungZwischenspeichern(e){return await this.withInitialized((async t=>{t.add(F,e)}))}async zwischengespeicherteBezahlungErledigt(e){await this.withInitialized((async t=>{t.delete(F,e)}))}}var G=a(445),H=a(717),M=a(928),W=a(114);class q{constructor(e,t,n,r,o){this.store=e,this.routingActionCreator=t,this.accountActionCreator=n,this.kontokorrentsActionCreator=r,this.router=o}async initializeApplication(){if(!(await(0,H.l)()).allPassed)return this.router.run(),void this.routingActionCreator.navigateFeaturesRequired();let e=await this.accountActionCreator.initializeAccount();e||window.history.replaceState({},document.title,n.n.Login),this.router.run(),e&&await this.kontokorrentsActionCreator.syncKontokorrentListe()}}"serviceWorker"in navigator&&window.addEventListener("load",(async()=>{navigator.serviceWorker.register("./sw.js").then((e=>{console.log("SW registered: ",e)})).catch((e=>{console.log("SW registration failed: ",e)}))})),async function(){const a=new r((()=>({account:{accountCreated:!1,accountCreating:!1,accountCreationFailed:!1,loginExpired:!1,accountInfo:null},kontokorrents:{hinzufuegen:!1,hinzufuegenFailed:null,creating:!1,creationFailed:null,kontokorrents:{},listeLaden:!1,activeKontokorrentId:null}})));"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",(e=>{var t;if("statedispatch"==(null===(t=e.data)||void 0===t?void 0:t.type)){let t=e.data.msg;a.dispatch(t)}}));const i=new n.W(a),c=new e(i,new t),u=new Z;a.addReducer("account",new b),a.addReducer("kontokorrents",new y);const d=new s(u),l=new f(d),h=new o(a,c,l,u,d);i.setServiceLocator(h),await function(e){return e.get("InitializationActionCreator",(e=>new q(e.store,(0,G.b)(e),(0,M.gg)(e),(0,W.d8)(e),e.router)))}(h).initializeApplication()}().catch((e=>console.error(e)))})()})();
//# sourceMappingURL=62979aa412eb2228ddd2.bundle.js.map