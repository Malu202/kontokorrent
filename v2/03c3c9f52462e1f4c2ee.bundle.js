(()=>{var e,t,n,o,r={199:e=>{e.exports="<h1>Speicherzugriff benötigt</h1> Kontokorrent speichert die Zahlungen und weitere Informationen im lokalen Speicher dieses Geräts. Auf diese Weise kann man für einige Tage eingeloggt bleiben, und die Anwendung auch verwenden, wenn die Internetverbindung schlecht ist. In den meisten Browsern (Chrome, Edge) muss dazu der Webseite erlaubt werden <strong>Cookies</strong> zu speichern. Nachdem die Berechtigung erteilt wurde die Webseite neu laden."},105:(e,t,n)=>{"use strict";n.d(t,{G:()=>o});class o{}},476:(e,t,n)=>{"use strict";n.d(t,{X:()=>o});class o{constructor(e){this.networkError=e}}},30:(e,t,n)=>{"use strict";var o;n.d(t,{Q:()=>o}),function(e){e.google="google",e.anonym="anonym"}(o||(o={}))},717:(e,t,n)=>{"use strict";function o(){let e="indexedDB"in window,t="localStorage"in window,n=null;try{localStorage.setItem("test","1"),n=!0}catch(e){n=!1}return{allPassed:e&&t&&n,indexedDBEnabled:e,localStorageEnabled:t,storageAllowed:n}}n.d(t,{l:()=>o})},965:(e,t,n)=>{"use strict";n.d(t,{W:()=>d,n:()=>c});var o=n(199),r=n.n(o),i=n(445),s=n(717);class a extends HTMLElement{constructor(){super(),this.innerHTML=r()}addServices(e){this.routingActionCreator=(0,i.b)(e)}connectedCallback(){(0,s.l)().allPassed&&(this.routingActionCreator.navigateHome(),window.location.reload())}disconnectedCallback(){}}customElements.define("app-features-required",a);var c,u=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};!function(e){e.Login="login",e.Info="info",e.Home="",e.FeaturesRequired="features-required",e.Kontokorrents="kontokorrents",e.CreateEvent="create-event",e.BezahlungEintragen="eintragen"}(c||(c={}));class d extends EventTarget{constructor(e){super(),this.store=e}setServiceLocator(e){this.serviceLocator=e}getKontokorrentPageComponent(){return u(this,void 0,void 0,(function*(){const{KontokorrentPage:e}=yield n.e(634).then(n.bind(n,527));let t=new e;return t.addServices(this.serviceLocator),t}))}resolve(e,t,o){return u(this,void 0,void 0,(function*(){switch(t in c&&this.dispatchEvent(new CustomEvent("routedTo",{detail:{currentRoute:t}})),t){case c.Info:const{Info:e}=yield n.e(184).then(n.bind(n,184));let t=new e;return t.addServices(this.serviceLocator),t;case c.FeaturesRequired:{let e=new a;return e.addServices(this.serviceLocator),e}case c.Login:{const{Login:e}=yield n.e(259).then(n.bind(n,560));let t=new e;return t.addServices(this.serviceLocator),t}case c.CreateEvent:{const{CreateKontokorrent:e}=yield n.e(785).then(n.bind(n,785));let t=new e;return t.addServices(this.serviceLocator),t}}if(!this.store.state.account.accountCreated)return!1;switch(t){case c.BezahlungEintragen:const{BezahlungEintragenPage:e}=yield n.e(999).then(n.bind(n,528));let t=new e;return t.addServices(this.serviceLocator),t}let e=/^kontokorrents\/([a-zA-Z0-9\-]+)$/.exec(t);if(e){let t=e[1],n=yield this.getKontokorrentPageComponent();return n.setRouteParameters(t),n}let o=yield this.getKontokorrentPageComponent();return o.addServices(this.serviceLocator),o}))}}},928:(e,t,n)=>{"use strict";n.d(t,{gg:()=>p});var o=n(586),r=n(30),i=n(445),s=n(476),a=n(105),c=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};class u{constructor(){this.type=0}}class d{constructor(){this.type=1}}class l{constructor(e){this.info=e,this.type=2}}class h{constructor(e){this.info=e,this.type=3}}class f{constructor(){this.type=4}}class g{constructor(){this.type=5}}class v{constructor(e,t,n,o,r){this.store=e,this.apiClient=t,this.accountInfoStore=n,this.routingActionCreator=o,this.db=r}initializeAccount(){return c(this,void 0,void 0,(function*(){let e=yield this.accountInfoStore.get();return!!e&&(this.store.dispatch(new h(e)),this.getUserInfo(),!0)}))}getUserInfo(){return c(this,void 0,void 0,(function*(){try{yield this.apiClient.getUserInfo()}catch(e){if(e instanceof s.X){let t=yield this.accountInfoStore.get();e.networkError||t.type!=r.Q.anonym||(yield this.accountInfoStore.clear(),window.location.reload())}else e instanceof a.G&&this.store.dispatch(new g)}}))}ensureAccount(){return c(this,void 0,void 0,(function*(){if(!this.store.state.account.accountCreated){let e={id:(0,o.Z)(),secret:(0,o.Z)(),type:r.Q.anonym};this.store.dispatch(new u);let t=yield this.apiClient.neuerBenutzer(e.id,e.secret);return t.success?(this.store.dispatch(new l(e)),yield this.accountInfoStore.set(e)):this.store.dispatch(new d),t.success}return!0}))}logout(){return c(this,void 0,void 0,(function*(){yield this.accountInfoStore.clear(),yield this.db.clear(),this.store.dispatch(new f),this.routingActionCreator.navigateLogin()}))}}function p(e){return e.get("AccountActionCreator",(e=>new v(e.store,e.apiClient,e.accountInfoStore,(0,i.b)(e),e.db)))}},114:(e,t,n)=>{"use strict";n.d(t,{d8:()=>d});var o=n(105),r=n(445),i=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};class s{constructor(){this.type=11}}class a{constructor(e){this.kontokorrents=e,this.type=12}}class c{constructor(e){this.interactionRequired=e,this.type=13}}class u{constructor(e,t,n,o){this.store=e,this.apiClient=t,this.routingActionCreator=n,this.db=o}navigiereZuLetztGesehenem(e){return i(this,void 0,void 0,(function*(){let t=yield this.db.getZuletztGesehenerKontokorrentId();return!!t&&(this.routingActionCreator.navigateKontokorrent(t,e),!0)}))}syncKontokorrentListe(){return i(this,void 0,void 0,(function*(){this.store.dispatch(new s);const e=this.apiClient.kontokorrentsAuflisten();let t=yield this.db.getKontokorrents();this.store.dispatch(new a(t));try{let t=yield e;yield this.db.setKontokorrents(t.map((e=>({id:e.id,name:e.name,personen:e.personen,oeffentlicherName:e.oeffentlicherName})))),this.store.dispatch(new a(t))}catch(e){e instanceof o.G?this.store.dispatch(new c(!0)):this.store.dispatch(new c(!1))}}))}}function d(e){return e.get("KontokorrentListenActionCreator",(e=>new u(e.store,e.apiClient,(0,r.b)(e),e.db)))}},445:(e,t,n)=>{"use strict";n.d(t,{b:()=>i});var o=n(965);class r{constructor(e){this.router=e}navigateHome(){this.router.navigate(o.n.Home,null)}navigateLogin(e){this.router.navigate(o.n.Login,null,e)}navigateFeaturesRequired(){this.router.navigate(o.n.FeaturesRequired,null)}navigate(e){this.router.navigate(e,null)}navigateKontokorrent(e,t){this.router.navigate(`${o.n.Kontokorrents}/${e}`,null,t)}}function i(e){return e.get("RoutingActionCreator",(e=>new r(e.router)))}},600:(e,t,n)=>{"use strict";function o(e,t){return e.sort(((e,n)=>t(e).toLowerCase().localeCompare(t(n).toLowerCase())))}n.d(t,{T:()=>o})},586:(e,t,n)=>{"use strict";var o;n.d(t,{Z:()=>d});var r=new Uint8Array(16);function i(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(r)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&s.test(e)};for(var c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));const d=function(e,t,n){var o=(e=e||{}).random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=o[r];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n}(o)}}},i={};function s(e){if(i[e])return i[e].exports;var t=i[e]={exports:{}};return r[e](t,t.exports,s),t.exports}s.m=r,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,n)=>(s.f[n](e,t),t)),[])),s.u=e=>({184:"bfd624d282d55c7f9e81",259:"8ff0302d3691a67a7fbc",634:"2728da83ee943723ea6c",726:"ac8c69467dc9345a14c6",785:"0e52d5a16071d41e18f2",999:"de10269831a391d41ae2"}[e]+".bundle.js"),s.miniCssF=e=>(826===e?"index":e)+"."+{184:"31d6cfe0d16ae931b73c",259:"cbdb2e7b4f859e70a8da",634:"b3cc1658d5842bfd7edb",726:"31d6cfe0d16ae931b73c",785:"31d6cfe0d16ae931b73c",999:"1dede58dbffb1a3b238e"}[e]+".css",s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="kontokorrent:",s.l=(n,o,r)=>{if(e[n])e[n].push(o);else{var i,a;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+r){i=d;break}}i||(a=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,s.nc&&i.setAttribute("nonce",s.nc),i.setAttribute("data-webpack",t+r),i.src=n),e[n]=[o];var l=(t,o)=>{i.onerror=i.onload=null,clearTimeout(h);var r=e[n];if(delete e[n],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach((e=>e(o))),t)return t(o)},h=setTimeout(l.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=l.bind(null,i.onerror),i.onload=l.bind(null,i.onload),a&&document.head.appendChild(i)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="/v2/",n=e=>new Promise(((t,n)=>{var o=s.miniCssF(e),r=s.p+o;if(((e,t)=>{for(var n=document.getElementsByTagName("link"),o=0;o<n.length;o++){var r=(s=n[o]).getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(r===e||r===t))return s}var i=document.getElementsByTagName("style");for(o=0;o<i.length;o++){var s;if((r=(s=i[o]).getAttribute("data-href"))===e||r===t)return s}})(o,r))return t();((e,t,n,o)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.onerror=r.onload=i=>{if(r.onerror=r.onload=null,"load"===i.type)n();else{var s=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=s,c.request=a,r.parentNode.removeChild(r),o(c)}},r.href=t,document.head.appendChild(r)})(e,r,t,n)})),o={826:0},s.f.miniCss=(e,t)=>{o[e]?t.push(o[e]):0!==o[e]&&{259:1,634:1,999:1}[e]&&t.push(o[e]=n(e).then((()=>{o[e]=0}),(t=>{throw delete o[e],t})))},(()=>{s.b=document.baseURI||self.location.href;var e={826:0};s.f.j=(t,n)=>{var o=s.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var r=new Promise(((n,r)=>{o=e[t]=[n,r]}));n.push(o[2]=r);var i=s.p+s.u(t),a=new Error;s.l(i,(n=>{if(s.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var r=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+r+": "+i+")",a.name="ChunkLoadError",a.type=r,a.request=i,o[1](a)}}),"chunk-"+t)}};var t=(t,n)=>{for(var o,r,[i,a,c]=n,u=0,d=[];u<i.length;u++)r=i[u],s.o(e,r)&&e[r]&&d.push(e[r][0]),e[r]=0;for(o in a)s.o(a,o)&&(s.m[o]=a[o]);for(c&&c(s),t&&t(n);d.length;)d.shift()()},n=self.webpackChunkkontokorrent=self.webpackChunkkontokorrent||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";class e{constructor(e,t){this.routeResolver=e,this.routeRenderer=t,this.lastRoute=null,this.popStateListener=this.handlePopState.bind(this)}handlePopState(e){this.doRouting(window.location.pathname)}run(){let e=document.querySelector("base");this.basePrefix=e.getAttribute("href"),this.baseHref=e.href,window.addEventListener("popstate",this.popStateListener),this.doRouting(window.location.pathname)}destroy(){window.removeEventListener("popstate",this.popStateListener)}doRouting(e){let t=this.getRoute(e);return Promise.resolve(this.routeResolver.resolve(this.lastRoute,t,this)).then((e=>!!e&&(this.routeRenderer.render(e),this.lastRoute=t,!0)))}getRoute(e){let t=e===this.baseHref,n=e.substr(0,this.basePrefix.length)===this.basePrefix;return t?"/":n?e.substring(this.basePrefix.length):e}navigate(e,t,n){let o=new URL(e,this.baseHref);this.doRouting(o.pathname).then((e=>{e&&(n?window.history.replaceState({},t||document.title,o.href):window.history.pushState({},t||document.title,o.href))}))}}class t{constructor(){this.currentComponent=null}render(e){e&&(this.currentComponent&&document.body.removeChild(this.currentComponent),document.body.appendChild(e),this.currentComponent=e)}}var n=s(965);class o extends class{constructor(e){this.subscriptions=[],this.reducerSubscriptions=[],this.state=e()}subscribe(e,t){let n={area:e,call:t};return this.subscriptions.push(n),()=>{this.subscriptions.splice(this.subscriptions.indexOf(n),1)}}addReducer(e,t){this.reducerSubscriptions.push({area:e,reducer:t})}dispatch(e){let t=[];for(let n of this.reducerSubscriptions){let o;o=n.area?e=>{this.state[n.area]=e(this.state[n.area]),t.push(n.area)}:e=>{this.state=e(this.state),t.push("")};try{n.reducer.onDispatch(e,o)}catch(t){console.error(`Error while dispatching ${e.type}.`,t)}}if(t.length)for(let n of this.subscriptions)if(!n.area||t.indexOf(n.area)>-1)try{n.call(this.state)}catch(t){console.error(`Error while updating on ${n.area||"global"} after ${e.type}.`,t)}}}{}class r{constructor(e,t,n,o,r){this.store=e,this.router=t,this.apiClient=n,this.db=o,this.accountInfoStore=r,this.services={}}get(e,t){return this.services[e]||(this.services[e]=t(this)),this.services[e]}}var i=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};class a{constructor(e){this.db=e}set(e){return i(this,void 0,void 0,(function*(){localStorage.setItem("account_info",JSON.stringify(e))}))}get(){return i(this,void 0,void 0,(function*(){let e=localStorage.getItem("account_info");return null==e?null:JSON.parse(e)}))}clear(){return i(this,void 0,void 0,(function*(){localStorage.removeItem("account_info"),localStorage.removeItem("access_token_anonymous"),localStorage.removeItem("access_token_google")}))}getAccessToken(e){return i(this,void 0,void 0,(function*(){return yield this.db.getAccessToken(e)}))}updateAccessTokenIfNewer(e,t,n){return i(this,void 0,void 0,(function*(){return yield this.db.updateAccessTokenIfNewer(e,t,n)}))}}function c(e,t,n){return o=this,r=void 0,s=function*(){let o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)};return n&&(o.headers=Object.assign(Object.assign({},o.headers),{Authorization:`Bearer ${n}`})),yield fetch(e,o)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,r||[])).next())}));var o,r,i,s}var u=s(30),d=s(476),l=s(105);class h{}let f;f="https://kontokorrent-v2.azurewebsites.net";var g=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const v="https://kontokorrent-v2.azurewebsites.net";class p{constructor(e){this.accountInfoStore=e}neuerBenutzer(e,t){return g(this,void 0,void 0,(function*(){try{return(yield c(`${v}/api/v2/accounts`,{id:e,secret:t})).ok?{success:!0}:{success:!1}}catch(e){return{success:!1}}}))}getUserInfo(){return g(this,void 0,void 0,(function*(){let e=yield fetch(`${v}/api/v2/userinfo`,{headers:yield this.getAuthHeader()});return yield e.json()}))}getAuthHeader(){return g(this,void 0,void 0,(function*(){return{Authorization:`Bearer ${yield this.getAccessToken()}`}}))}kontokorrentHinzufuegen(e,t){return g(this,void 0,void 0,(function*(){let n="";n=e?`oeffentlicherName=${encodeURIComponent(e)}`:`einladungsCode=${encodeURIComponent(t)}`;let o=yield this.getAuthHeader(),r=yield fetch(`${v}/api/v2/kontokorrents?${n}`,{method:"PUT",headers:o});return 404==r.status?null:yield r.json()}))}kontokorrentsAuflisten(){return g(this,void 0,void 0,(function*(){let e=yield fetch(`${v}/api/v2/kontokorrents`,{headers:yield this.getAuthHeader()});if(!e.ok)throw new h;return yield e.json()}))}neuerKontokorrent(e){return g(this,void 0,void 0,(function*(){let t=yield c(`${v}/api/v2/kontokorrents`,e,yield this.getAccessToken());return 422==t.status?{success:!1,exists:!0}:t.ok?{success:!0}:{success:!1}}))}getAktionen(e,t){return g(this,void 0,void 0,(function*(){let n=t?`?ab=${t}`:"",o=yield fetch(`${v}/api/v2/kontokorrents/${e}/aktionen${n}`,{headers:yield this.getAuthHeader()});if(404==o.status)return{success:!1,notfound:!0};if(o.ok){let e=yield o.json();for(let t of e)t.bezahlung&&(t.bezahlung.zeitpunkt=new Date(t.bezahlung.zeitpunkt));return{success:!0,aktionen:e}}}))}getAccessToken(){return g(this,void 0,void 0,(function*(){let e=yield this.accountInfoStore.get();if(null==e)throw new Error("Keine Account Information gespeichert.");if(e.type==u.Q.anonym){let t,n=yield this.accountInfoStore.getAccessToken("anonymous");if(null!=n){let{token:e,expires:t}=JSON.parse(n.value);if(e&&t&&t>=+new Date)return e}try{let n=yield c(`${v}/api/v2/token`,{id:e.id,secret:e.secret});if(!n.ok)throw new d.X(!1);t=yield n.json()}catch(e){throw new d.X(!0)}return yield this.accountInfoStore.updateAccessTokenIfNewer("anonymous",JSON.stringify(t),null==n?void 0:n.timestamp),t.token}throw e.type==u.Q.google?new l.G:new Error(`Account Typ ${e.type} unbekannt`)}))}}class k{onDispatch(e,t){switch(e.type){case 0:t((e=>Object.assign(Object.assign({},e),{accountCreating:!0,accountCreationFailed:!1})));break;case 2:t((t=>Object.assign(Object.assign({},t),{accountCreating:!1,accountCreated:!0,accountInfo:e.info})));break;case 1:t((e=>Object.assign(Object.assign({},e),{accountCreationFailed:!0,accountCreating:!1,accountCreated:!1})));break;case 3:t((t=>Object.assign(Object.assign({},t),{accountCreated:!0,accountInfo:e.info})));break;case 4:t((e=>Object.assign(Object.assign({},e),{accountCreated:!1})));break;case 5:t((e=>Object.assign(Object.assign({},e),{loginExpired:!0})));break;case 13:e.interactionRequired&&t((e=>Object.assign(Object.assign({},e),{loginExpired:!0})))}}}class b{onDispatch(e,t){switch(e.type){case 11:t((e=>Object.assign(Object.assign({},e),{listeLaden:!0})));break;case 13:t((e=>Object.assign(Object.assign({},e),{listeLaden:!1})));break;case 12:t((t=>Object.assign(Object.assign({},t),{kontokorrents:this.extendMap(t.kontokorrents,e.kontokorrents)})));break;case 10:t((e=>Object.assign(Object.assign({},e),{hinzufuegen:!0})));break;case 9:t((t=>Object.assign(Object.assign({},t),{hinzufuegen:!1,hinzufuegenFailed:{kontokorrentNotFound:e.notFound}})));break;case 20:t((t=>Object.assign(Object.assign({},t),{hinzufuegen:!1,kontokorrents:this.extendMap(t.kontokorrents,e.kontokorrents)})));case 8:t((e=>Object.assign(Object.assign({},e),{creating:!0,creationFailed:null})));break;case 7:t((t=>Object.assign(Object.assign({},t),{creating:!1,creationFailed:{exists:e.exists}})));break;case 21:t((t=>Object.assign(Object.assign({},t),{creating:!1,kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrent.id]:{id:e.kontokorrent.id,name:e.kontokorrent.name,synchronisieren:!1,personen:e.kontokorrent.personen.map((e=>Object.assign({balance:0},e))),bezahlungen:[]}})})));break;case 14:t((t=>Object.assign(Object.assign({},t),{activeKontokorrentId:e.id})));break;case 15:t((t=>Object.assign(Object.assign({},t),{kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrentId]:Object.assign(Object.assign({},t.kontokorrents[e.kontokorrentId]),{bezahlungen:e.bezahlungen})})})));break;case 16:t((t=>Object.assign(Object.assign({},t),{kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrentId]:Object.assign(Object.assign({},t.kontokorrents[e.kontokorrentId]),{synchronisieren:!0})})})));break;case 19:t((t=>Object.assign(Object.assign({},t),{kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrentId]:Object.assign(Object.assign({},t.kontokorrents[e.kontokorrentId]),{synchronisieren:!1})})})));break;case 17:t((t=>Object.assign(Object.assign({},t),{kontokorrents:Object.assign(Object.assign({},t.kontokorrents),{[e.kontokorrentId]:Object.assign(Object.assign({},t.kontokorrents[e.kontokorrentId]),{personen:t.kontokorrents[e.kontokorrentId].personen.map((t=>Object.assign(Object.assign({},t),{balance:e.balance[t.id]})))})})})));break;case 18:t((e=>Object.assign(Object.assign({},e),{hinzufuegen:!1,hinzufuegenFailed:null})));break;case 4:t((e=>Object.assign(Object.assign({},e),{activeKontokorrentId:null,kontokorrents:{}})));break;case 6:t((t=>Object.assign(Object.assign({},t),{activeKontokorrentId:e.kontokorrentId})))}}extendMap(e,t){let n={};for(let o of t){let t=Object.assign(Object.assign(Object.assign(Object.assign({},o),{synchronisieren:!1,bezahlungen:[]}),e[o.id]),{personen:o.personen.map((t=>{var n,r;let i=null===(r=null===(n=e[o.id])||void 0===n?void 0:n.personen)||void 0===r?void 0:r.find((e=>e.id==t.id));return Object.assign(Object.assign(Object.assign({},t),{balance:0}),i)}))});n[o.id]=t}return n}}let y,m;const w=new WeakMap,j=new WeakMap,I=new WeakMap,O=new WeakMap,C=new WeakMap;let S={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return j.get(e);if("objectStoreNames"===t)return e.objectStoreNames||I.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return z(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function A(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(m||(m=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(x(this),e),z(w.get(this))}:function(...e){return z(t.apply(x(this),e))}:function(e,...n){const o=t.call(x(this),e,...n);return I.set(o,e.sort?e.sort():[e]),z(o)}:(e instanceof IDBTransaction&&function(e){if(j.has(e))return;const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),o()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));j.set(e,t)}(e),n=e,(y||(y=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,S):e);var t,n}function z(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(z(e.result)),o()},i=()=>{n(e.error),o()};e.addEventListener("success",r),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&w.set(t,e)})).catch((()=>{})),C.set(t,e),t}(e);if(O.has(e))return O.get(e);const t=A(e);return t!==e&&(O.set(e,t),C.set(t,e)),t}const x=e=>C.get(e),E=["get","getKey","getAll","getAllKeys","count"],L=["put","add","delete","clear"],P=new Map;function K(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(P.get(t))return P.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,r=L.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!r&&!E.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let s=i.store;o&&(s=s.index(t.shift()));const a=await s[n](...t);return r&&await i.done,a};return P.set(t,i),i}var R;R=S,S={...R,get:(e,t,n)=>K(e,t)||R.get(e,t,n),has:(e,t)=>!!K(e,t)||R.has(e,t)};var T=s(600),B=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const D="KontokorrentsStore",N="AppStateStore",$="AktionenStore";class F{withInitialized(e){return B(this,void 0,void 0,(function*(){let t=yield function(e,t,{blocked:n,upgrade:o,blocking:r,terminated:i}={}){const s=indexedDB.open(e,t),a=z(s);return o&&s.addEventListener("upgradeneeded",(e=>{o(z(s.result),e.oldVersion,e.newVersion,z(s.transaction))})),n&&s.addEventListener("blocked",(()=>n())),a.then((e=>{i&&e.addEventListener("close",(()=>i())),r&&e.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}("kontokorrent-db",3,{upgrade(e,t,n){t<1&&e.createObjectStore(D,{keyPath:"id"}).createIndex("oeffentlicherName","oeffentlicherName"),t<2&&e.createObjectStore(N,{keyPath:"id"}).put({id:0,zuletztGesehenerKontokorrentId:null,accesstokens:[]}),t<3&&e.createObjectStore($,{keyPath:["laufendeNummer","kontokorrentId"]}).createIndex("kontokorrentId","kontokorrentId")}});try{return yield e(t)}finally{t.close()}}))}getKontokorrents(){return B(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>B(this,void 0,void 0,(function*(){return(0,T.T)(yield e.getAll(D),(e=>e.name))}))))}))}addAktionen(e,t){return B(this,void 0,void 0,(function*(){if(t.length)return yield this.withInitialized((n=>B(this,void 0,void 0,(function*(){const o=n.transaction($,"readwrite");let r=t.map((t=>Object.assign(Object.assign({},t),{kontokorrentId:e}))).map((e=>o.store.add(e)));yield Promise.all(r),yield o.done}))))}))}getZuletztGesehenerKontokorrentId(){return B(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>B(this,void 0,void 0,(function*(){let t=yield e.get(N,0);if(t.zuletztGesehenerKontokorrentId)return t.zuletztGesehenerKontokorrentId;{let e=yield yield this.getKontokorrents();return e.length?e[0].id:null}}))))}))}setZuletztGesehenerKontokorrentId(e){return B(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>B(this,void 0,void 0,(function*(){let n=yield t.get(N,0);n.zuletztGesehenerKontokorrentId=e,yield t.put(N,n)}))))}))}setKontokorrents(e){return B(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>B(this,void 0,void 0,(function*(){let n=yield t.getAll(D);for(let o of n.filter((t=>!e.some((e=>t.id===e.id)))))yield t.delete(D,o.id);let o=[];for(let r of e){let e=n.find((e=>e.id==r.id));e||o.push(r.id);let i=Object.assign(Object.assign({},e),{name:r.name,personen:r.personen,id:r.id,oeffentlicherName:r.oeffentlicherName});yield t.put(D,i)}return o}))))}))}addKontokorrent(e){return B(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>B(this,void 0,void 0,(function*(){(yield t.get(D,e.id))||(yield t.add(D,e))}))))}))}getKontokorrent(e){return B(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>B(this,void 0,void 0,(function*(){return yield t.get(D,e)}))))}))}getPerOeffentlichName(e){return B(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>B(this,void 0,void 0,(function*(){return yield t.getFromIndex(D,"oeffentlicherName",e)}))))}))}getAktionen(e){return B(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>B(this,void 0,void 0,(function*(){return yield t.getAllFromIndex($,"kontokorrentId",e)}))))}))}clear(){return B(this,void 0,void 0,(function*(){return yield this.withInitialized((e=>B(this,void 0,void 0,(function*(){yield e.clear($),yield e.clear(D),yield e.put(N,{id:0,zuletztGesehenerKontokorrentId:null,accesstokens:[]})}))))}))}getAccessToken(e){return B(this,void 0,void 0,(function*(){return yield this.withInitialized((t=>B(this,void 0,void 0,(function*(){return((yield t.get(N,0)).accesstokens||[]).find((t=>t.type===e))}))))}))}updateAccessTokenIfNewer(e,t,n){return B(this,void 0,void 0,(function*(){return yield this.withInitialized((o=>B(this,void 0,void 0,(function*(){const r=o.transaction(N,"readwrite",{durability:"strict"});let i=yield r.store.get(0);i.accesstokens||(i.accesstokens=[]);let s=i.accesstokens.find((t=>t.type===e));if(s){if(s.timestamp!=n)return console.error(`The accesstoken of type ${e} was already updated since reading.`),yield r.done,!1;s.value=t,s.timestamp++}else i.accesstokens.push({timestamp:1,type:e,value:t});return yield r.store.put(i),yield r.done,!0}))))}))}}var H=s(445),M=s(717),G=s(928),W=s(114);class _{constructor(e,t,n,o,r){this.store=e,this.routingActionCreator=t,this.accountActionCreator=n,this.kontokorrentsActionCreator=o,this.router=r}initializeApplication(){return e=this,t=void 0,r=function*(){if(!(0,M.l)().allPassed)return this.router.run(),void this.routingActionCreator.navigateFeaturesRequired();let e=yield this.accountActionCreator.initializeAccount();e||window.history.replaceState({},document.title,n.n.Login),this.router.run(),e&&(yield this.kontokorrentsActionCreator.syncKontokorrentListe())},new((o=void 0)||(o=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}));var e,t,o,r}}var q=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};"serviceWorker"in navigator&&window.addEventListener("load",(()=>q(void 0,void 0,void 0,(function*(){navigator.serviceWorker.register("./sw.js").then((e=>{console.log("SW registered: ",e)})).catch((e=>{console.log("SW registration failed: ",e)}))})))),function(){return q(this,void 0,void 0,(function*(){const i=new o((()=>({account:{accountCreated:!1,accountCreating:!1,accountCreationFailed:!1,loginExpired:!1,accountInfo:null},kontokorrents:{hinzufuegen:!1,hinzufuegenFailed:null,creating:!1,creationFailed:null,kontokorrents:{},listeLaden:!1,activeKontokorrentId:null}}))),s=new n.W(i),c=new e(s,new t),u=new F;i.addReducer("account",new k),i.addReducer("kontokorrents",new b);const d=new a(u),l=new p(d),h=new r(i,c,l,u,d);s.setServiceLocator(h),yield function(e){return e.get("InitializationActionCreator",(e=>new _(e.store,(0,H.b)(e),(0,G.gg)(e),(0,W.d8)(e),e.router)))}(h).initializeApplication()}))}().catch((e=>console.error(e)))})()})();
//# sourceMappingURL=03c3c9f52462e1f4c2ee.bundle.js.map