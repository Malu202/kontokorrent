{"version":3,"sources":["webpack://kontokorrent/./src/components/MultiBezahlungZeile/MultiBezahlungZeile.ts","webpack://kontokorrent/./src/components/MultiBezahlungEintragenPage/MultiBezahlungEintragenPage.ts","webpack://kontokorrent/./src/utils/formatCurrency.ts","webpack://kontokorrent/./src/utils/round.ts","webpack://kontokorrent/./src/components/MultiBezahlungEintragenPage/MultiBezahlungEintragenPage.html","webpack://kontokorrent/./src/components/MultiBezahlungZeile/MultiBezahlungZeile.html"],"names":["MultiBezahlungZeile","HTMLElement","super","this","innerHTML","datumText","querySelector","betreff","betragText","removeBtn","status","removeClickListener","removeClick","addEventListener","dispatchEvent","CustomEvent","removeEventListener","d","innerText","formatCurrency","betrag","Intl","DateTimeFormat","format","datum","value","error","done","customElements","define","schema","name","seperator","mappings","typ","column","parse","s","replace","Date","locale","de","parseFloat","MultiBezahlungEintragenPage","appBar","AppBar","serviceLocator","store","routingActionCreator","bezahlungActionCreator","addServices","bezahlungenTable","bezahlungenRenderer","ArrayToElementRenderer","b","id","e","bezahlungen","splice","indexOf","renderBezahlungen","getData","zahlendePersonRenderer","p","BezahlendePersonRadioButton","kontokorrentsSubscription","subscribe","applyStoreState","bezahlungEintragenKontokorrentChanged","detail","bezahlungEintragenGeoeffnet","state","onPasteHandler","ev","onPaste","saveHandler","save","saveBtn","form","document","convertLinks","bezahlungDirektHinzufuegen","kontokorrentId","bezahlendePerson","empfaenger","personen","map","console","text","clipboardData","lines","split","mappedBySchema","l","columns","length","sort","a","res","m","val","isNaN","getTime","filter","v","update","setData","kontokorrents","activeKontokorrentId","element","person","radioName","wert","valueString","indexOfE","indexOfe","power","Betrag","toString","substring","Number","Math","round","Kommaindex","module","exports"],"mappings":"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","file":"24b273290aace2310bf2.bundle.js","sourcesContent":["import { formatCurrency } from \"../../utils/formatCurrency\";\nimport template from \"./MultiBezahlungZeile.html\";\nimport \"./MultiBezahlungZeile.scss\";\n\nexport class MultiBezahlungZeile extends HTMLElement {\n    private datumText: HTMLSpanElement;\n    private betreff: HTMLInputElement;\n    private betragText: HTMLSpanElement;\n    private removeBtn: HTMLButtonElement;\n    private removeClickListener: () => void;\n    private status: HTMLSpanElement;\n\n    constructor() {\n        super();\n        this.innerHTML = template;\n        this.datumText = this.querySelector(`[data-ref=\"datum\"]`);\n        this.betreff = this.querySelector(`[data-ref=\"betreff\"]`);\n        this.betragText = this.querySelector(`[data-ref=\"betrag\"]`);\n        this.removeBtn = this.querySelector(`[data-ref=\"remove\"]`);\n        this.status = this.querySelector(`[data-ref=\"status\"]`);\n    }\n\n    connectedCallback() {\n        this.removeClickListener = () => this.removeClick();\n        this.removeBtn.addEventListener(\"click\", this.removeClickListener);\n    }\n\n    removeClick() {\n        this.dispatchEvent(new CustomEvent(\"removebezahlung\"));\n    }\n\n    disconnectedCallback() {\n        this.removeBtn.removeEventListener(\"click\", this.removeClickListener);\n    }\n\n    setData(d: { betreff?: string; betrag?: number; datum?: Date; done: boolean, error: boolean }) {\n        this.betragText.innerText = formatCurrency(d.betrag);\n        this.datumText.innerText = new Intl.DateTimeFormat().format(d.datum);\n        this.betreff.value = d.betreff;\n        this.status.innerText = d.error ? \"Fehler\" : (d.done ? \"gespeichert\" : \"\");\n    }\n\n    getData() {\n        return { betreff: this.betreff.value };\n    }\n}\n\ncustomElements.define(\"multi-bezahlung-zeile\", MultiBezahlungZeile);\n","import template from \"./MultiBezahlungEintragenPage.html\";\nimport { Store } from \"../../state/Store\";\nimport { ServiceLocator } from \"../../ServiceLocator\";\nimport { RoutingActionCreator, routingActionCreatorFactory } from \"../../state/actions/RoutingActionCreator\";\nimport { AppBar, AppBarTagName } from \"../AppBar/AppBar\";\nimport \"./MultiBezahlungEintragenPage.scss\";\nimport { BezahlungActionCreator, bezahlungActionCreatorFactory } from \"../../state/actions/BezahlungActionCreator\";\nimport { Person, State } from \"../../state/State\";\nimport \"../BezahlungEintragenForm/BezahlungEintragenForm\";\nimport { parse } from \"date-fns\";\nimport { de } from \"date-fns/locale\";\nimport { ArrayToElementRenderer } from \"../../utils/ArrayToElementRenderer\";\nimport { convertLinks } from \"../convertLinks\";\nimport { MultiBezahlungZeile } from \"../MultiBezahlungZeile/MultiBezahlungZeile\";\nimport { BezahlendePersonRadioButton } from \"../BezahlendePersonRadioButton/BezahlendePersonRadioButton\";\n\nconst schema: {\n    name: string,\n    seperator: RegExp,\n    mappings: ({ typ: \"betreff\", column: number, parse: (s: string) => string }\n        | { typ: \"datum\", column: number, parse: (s: string) => Date }\n        | { typ: \"betrag\", column: number, parse: (s: string) => number })[]\n}[] = [{\n    name: \"BAWAG\",\n    seperator: /\\t/g,\n    mappings: [\n        {\n            typ: \"betreff\", column: 1, parse: (s: string) => {\n                return s.replace(/\\d{2,}/g, \"\").replace(/\\s+/g, \" \");\n            }\n        },\n        { typ: \"datum\", column: 2, parse: (s: string) => parse(s, \"P\", new Date(), { locale: de }) },\n        { typ: \"betrag\", column: 4, parse: (s: string) => -parseFloat(s.replace(\".\", \"\").replace(\",\", \".\").replace(/ /g, \"\")) }\n    ]\n}];\n\nexport class MultiBezahlungEintragenPage extends HTMLElement {\n    private store: Store;\n    private kontokorrentsSubscription: () => void;\n    private routingActionCreator: RoutingActionCreator;\n    private appBar: AppBar;\n    private bezahlungActionCreator: BezahlungActionCreator;\n    private kontokorrentId: string;\n    private onPasteHandler: (ev: ClipboardEvent) => void;\n    private bezahlungenTable: HTMLTableElement;\n    private bezahlungen: { id: number, betreff?: string; betrag?: number; datum?: Date; done: boolean; error: boolean; }[];\n    private bezahlungenRenderer: ArrayToElementRenderer<{ id: number, betreff?: string; betrag?: number; datum?: Date; done: boolean; error: boolean; }, MultiBezahlungZeile, number>;\n    zahlendePersonRenderer: ArrayToElementRenderer<any, any, string>;\n    private saveHandler: () => void;\n    private saveBtn: HTMLButtonElement;\n    private form: HTMLFormElement;\n    private personen: Person[];\n\n    constructor() {\n        super();\n        this.innerHTML = template;\n        this.appBar = this.querySelector(AppBarTagName);\n    }\n\n    addServices(serviceLocator: ServiceLocator) {\n        this.store = serviceLocator.store;\n        this.routingActionCreator = routingActionCreatorFactory(serviceLocator);\n        this.bezahlungActionCreator = bezahlungActionCreatorFactory(serviceLocator);\n        this.appBar.addServices(serviceLocator);\n    }\n\n    connectedCallback() {\n        this.bezahlungenTable = this.querySelector(\"#bezahlungen-table\");\n        this.bezahlungenRenderer = new ArrayToElementRenderer(this.bezahlungenTable,\n            b => b.id,\n            b => {\n                let e = new MultiBezahlungZeile();\n                e.addEventListener(\"removebezahlung\", () => {\n                    this.bezahlungen.splice(this.bezahlungen.indexOf(b), 1);\n                    this.renderBezahlungen();\n                });\n                e.addEventListener(\"change\", () => {\n                    b.betreff = e.getData().betreff;\n                });\n                return e;\n            });\n        this.zahlendePersonRenderer = new ArrayToElementRenderer<Person, BezahlendePersonRadioButton, string>(\n            this.querySelector(\"#zahlende-person-auswahl\"),\n            p => p.id,\n            p => new BezahlendePersonRadioButton());\n        this.kontokorrentsSubscription = this.store.subscribe(\"kontokorrents\", s => this.applyStoreState(s));\n        this.appBar.addEventListener(\"gotokontokorrent\", (e: CustomEvent) => {\n            this.bezahlungActionCreator.bezahlungEintragenKontokorrentChanged(e.detail);\n        });\n        this.bezahlungActionCreator.bezahlungEintragenGeoeffnet();\n        this.applyStoreState(this.store.state);\n        this.onPasteHandler = (ev: ClipboardEvent) => this.onPaste(ev);\n        this.saveHandler = () => this.save();\n        this.saveBtn = this.querySelector(\"#save\");\n        this.form = this.querySelector(\"#multi-bezahlung-form\");\n        this.saveBtn.addEventListener(\"click\", this.saveHandler);\n        document.addEventListener(\"paste\", this.onPasteHandler);\n        convertLinks([this.querySelector(\"#zurueck-zum-kontokorrent\")], this.routingActionCreator);\n    }\n    async save() {\n        for (let b of this.bezahlungen) {\n            try {\n                await this.bezahlungActionCreator.bezahlungDirektHinzufuegen(this.kontokorrentId, {\n                    betrag: b.betrag,\n                    betreff: b.betreff,\n                    bezahlendePerson: this.form[\"bezahlende-person\"].value,\n                    datum: b.datum,\n                    empfaenger: this.personen.map(p => p.id)\n                });\n                b.done = true;\n            } catch (error) {\n                b.error = true;\n                console.error(error);\n            }\n            this.renderBezahlungen();\n        }\n    }\n\n    private onPaste(ev: ClipboardEvent) {\n        let text = ev.clipboardData.getData(\"text/plain\");\n        if (text) {\n            let lines = text.split(/\\r\\n|\\n|\\r/g);\n            var mappedBySchema = schema.map(s => {\n                let id = 0;\n                return lines.map(l => {\n                    let columns = l.split(s.seperator);\n                    if (columns.length < s.mappings.map(s => s.column).sort((a, b) => b - a)[0]) {\n                        return null;\n                    }\n                    let res: any = {};\n                    for (let m of s.mappings) {\n                        let val = m.parse(columns[m.column]);\n                        switch (typeof val) {\n                            case \"number\":\n                                if (isNaN(val)) {\n                                    return null;\n                                }\n                                break;\n                            case \"object\":\n                                if (isNaN(val.getTime())) {\n                                    return null;\n                                }\n                                break;\n                            default: break;\n                        }\n                        res[m.typ] = val;\n                    }\n                    let ret: { id: number, betreff?: string; betrag?: number; datum?: Date; done: boolean, error: boolean } = { ...res, id: ++id, done: false, error: false };\n                    return ret;\n                }).filter(v => null != v);\n            }).filter(v => v.length > 0);\n            if (mappedBySchema.length > 0) {\n                this.bezahlungen = mappedBySchema.sort((a, b) => b.length - a.length)[0];\n                this.renderBezahlungen();\n            }\n        }\n    }\n\n    private renderBezahlungen() {\n        this.bezahlungenRenderer.update(this.bezahlungen, (e, b) => {\n            e.setData(b);\n        });\n    }\n\n    private applyStoreState(s: State) {\n        if (s.kontokorrents.activeKontokorrentId) {\n\n        }\n        this.kontokorrentId = s.kontokorrents.activeKontokorrentId;\n        this.personen = this.kontokorrentId ? s.kontokorrents.kontokorrents[this.kontokorrentId]?.personen : [];\n        if (this.personen) {\n            this.zahlendePersonRenderer.update(this.personen, (element, person) => {\n                element.person = person;\n                element.radioName = \"bezahlende-person\";\n            });\n        }\n    }\n\n    disconnectedCallback() {\n        this.kontokorrentsSubscription();\n        document.removeEventListener(\"paste\", this.onPasteHandler);\n        this.saveBtn.removeEventListener(\"click\", this.saveHandler);\n    }\n}\n\ncustomElements.define('multi-bezahlung-eintragen-page', MultiBezahlungEintragenPage);\n","import { round } from \"./round\";\n\nexport function formatCurrency(wert: number) {\n    var Betrag: string = \"\" + round(wert, 2);\n    var Kommaindex = Betrag.toString().indexOf(\".\");\n    var Nachkommastellen = 0;\n    if (Kommaindex != -1) {\n        Nachkommastellen = Betrag.toString().length - (Kommaindex + 1);\n        if (Nachkommastellen == 1)\n            Betrag += '0';\n    }\n    return Betrag;\n}\n","export function round(value: number, decimals: number) {\n\n    //Removing scientific notation if used:\n    var valueString = value.toString();\n    var indexOfE = valueString.indexOf(\"E\");\n    var indexOfe = valueString.indexOf(\"e\");\n    var power = 0;\n    if (indexOfe > -1) {\n        power = parseFloat(valueString.substring(indexOfe + 1));\n        valueString = valueString.substring(0, indexOfe)\n    } else if (indexOfE > -1) {\n        power = parseFloat(valueString.substring(indexOfE + 1));\n        valueString = valueString.substring(0, indexOfE)\n    }\n    //round\n    return Number(Math.round(Number(valueString + 'e' + (power + decimals))) + 'e-' + (decimals));\n}","// Module\nvar code = \"<app-bar></app-bar> <a id=\\\"zurueck-zum-kontokorrent\\\" class=\\\"button\\\"> <span class=\\\"material-icons\\\"> arrow_back </span> zurück </a> <form id=\\\"multi-bezahlung-form\\\" novalidate> <label for=\\\"zahlende-person\\\">Diese Person zahlt</label> <div id=\\\"zahlende-person-auswahl\\\"></div> </form> <div id=\\\"bezahlungen-table\\\"> </div> <button class=\\\"button\\\" title=\\\"speichern\\\" id=\\\"save\\\"> <span class=\\\"material-icons\\\"> save </span> alle speichern </button>\";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<button class=\\\"button\\\" data-ref=\\\"remove\\\">entfernen</button> <span data-ref=\\\"datum\\\"></span> <input type=\\\"text\\\" data-ref=\\\"betreff\\\"/> <span data-ref=\\\"betrag\\\"></span> <span data-ref=\\\"status\\\"></span>\";\n// Exports\nmodule.exports = code;"],"sourceRoot":""}