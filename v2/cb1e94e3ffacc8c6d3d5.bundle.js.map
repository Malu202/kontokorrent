{"version":3,"file":"cb1e94e3ffacc8c6d3d5.bundle.js","mappings":"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","sources":["webpack://kontokorrent/./src/components/KontokorrentNichtGefunden/KontokorrentNichtGefunden.ts","webpack://kontokorrent/./src/components/KontokorrentNichtGefunden/KontokorrentNichtGefunden.html","webpack://kontokorrent/./src/state/actions/KontokorrentHinzufuegenActionCreator.ts"],"sourcesContent":["import { OeffentlicherNameParam } from \"../../routing/KontokorrentRouteResolver\";\nimport { ServiceLocator } from \"../../ServiceLocator\";\nimport { RoutingActionCreator, routingActionCreatorFactory } from \"../../state/actions/RoutingActionCreator\";\nimport { Store } from \"../../state/Store\";\nimport { State } from \"../../state/State\";\nimport { AppBar, AppBarTagName } from \"../AppBar/AppBar\";\nimport template from \"./KontokorrentNichtGefunden.html\";\nimport \"./KontokorrentNichtGefunden.scss\";\nimport { KontokorrentHinzufuegenActionCreator, kontokorrentHinzufuegenActionCreatorFactory } from \"../../state/actions/KontokorrentHinzufuegenActionCreator\";\n\nexport class KontokorrentNichtGefunden extends HTMLElement {\n    private rendered = false;\n    private store: Store;\n    private routingActionCreator: RoutingActionCreator;\n    private serviceLocator: ServiceLocator;\n    private appBar: AppBar;\n    private oeffentlicherKontokorrentLabel: HTMLSpanElement;\n    private hinzufuegenBtn: HTMLButtonElement;\n    private oeffentlicherName: string;\n    private hinzufuegenClickListener: (e: MouseEvent) => void;\n    private subscription: () => void;\n    private kontokorrentHinzufuegenActionCreator: KontokorrentHinzufuegenActionCreator;\n    private notFoundError: HTMLDivElement;\n    private processing: HTMLDivElement;\n\n    constructor() {\n        super();\n    }\n\n    addServices(serviceLocator: ServiceLocator) {\n        this.store = serviceLocator.store;\n        this.routingActionCreator = routingActionCreatorFactory(serviceLocator);\n        this.kontokorrentHinzufuegenActionCreator = kontokorrentHinzufuegenActionCreatorFactory(serviceLocator);\n        this.serviceLocator = serviceLocator;\n    }\n\n    connectedCallback() {\n        if (!this.rendered) {\n            this.rendered = true;\n            this.innerHTML = template;\n            this.oeffentlicherKontokorrentLabel = this.querySelector(\"#oeffentlicher-name\");\n            this.hinzufuegenBtn = this.querySelector(\"#hinzufuegen-btn\");\n            this.notFoundError = this.querySelector(\"#notFoundError\");\n            this.processing = this.querySelector(\"#hinzufuegen__progress\");\n            this.appBar = this.querySelector(AppBarTagName);\n            this.appBar.addServices(this.serviceLocator);\n            let searchParams = new URLSearchParams(window.location.search);\n            if (searchParams.has(OeffentlicherNameParam)) {\n                this.oeffentlicherName = searchParams.get(OeffentlicherNameParam).toLowerCase();\n                this.oeffentlicherKontokorrentLabel.innerText = this.oeffentlicherName;\n            }\n        }\n        this.appBar.addEventListener(\"gotokontokorrent\", async (e: CustomEvent) => {\n            await this.routingActionCreator.navigateKontokorrentById(e.detail);\n        });\n        this.hinzufuegenClickListener = () => this.hinzufuegen();\n        this.hinzufuegenBtn.addEventListener(\"click\", this.hinzufuegenClickListener);\n        this.subscription = this.store.subscribe(null, state => this.applyStoreState(state));\n        this.applyStoreState(this.store.state);\n        this.kontokorrentHinzufuegenActionCreator.nichtGefundenPageGeoeffnet();\n    }\n\n    private async hinzufuegen() {\n        let id = await this.kontokorrentHinzufuegenActionCreator.kontokorrentHinzufuegen(this.oeffentlicherName);\n        if (id) {\n            await this.routingActionCreator.navigateKontokorrentById(id);\n        };\n    }\n\n    private applyStoreState(state: State) {\n        this.notFoundError.style.display = !state.kontokorrents.hinzufuegen && state.kontokorrents.hinzufuegenFailed && state.kontokorrents.hinzufuegenFailed.kontokorrentNotFound ?\n            \"block\" : \"none\";\n        let processing = state.kontokorrents.hinzufuegen || state.account.accountCreating;\n        this.processing.style.display = processing ? \"flex\" : \"none\";\n        this.hinzufuegenBtn.style.display = !processing ? \"inline-flex\" : \"none\";\n    }\n\n    disconnectedCallback() {\n        this.subscription();\n        this.hinzufuegenBtn.removeEventListener(\"click\", this.hinzufuegenClickListener);\n    }\n}\n\ncustomElements.define(\"kontokorrent-nicht-gefunden\", KontokorrentNichtGefunden);\n","// Module\nvar code = \"<app-bar></app-bar> <div class=\\\"kontokorrent-hinzufuegen-section\\\"> Möchtest du den öffentlichen Kontokorrent zur Liste deiner Kontokorrents <strong><span id=\\\"oeffentlicher-name\\\"></span></strong> hinzufügen? </div> <div class=\\\"kontokorrent-hinzufuegen-section\\\"> <div id=\\\"notFoundError\\\" class=\\\"alert alert--error\\\" style=\\\"display:none\\\">Kontokorrent wurde nicht gefunden</div> <button class=\\\"button button--raised\\\" id=\\\"hinzufuegen-btn\\\"> hinzufügen </button> </div> <div class=\\\"hinzufuegen__progress\\\" id=\\\"hinzufuegen__progress\\\"> <span class=\\\"spinner\\\"></span> <span>wird hinzugefügt</span> </div>\";\n// Exports\nexport default code;","import { ApiClient } from \"../../api/ApiClient\";\nimport { KontokorrentInfo } from \"../../api/KontokorrentInfo\";\nimport { NeuerKontokorrentRequest } from \"../../api/NeuerKontokorrentRequest\";\nimport { KontokorrentDatabase } from \"../../lib/KontokorrentDatabase\";\nimport { ServiceLocator } from \"../../ServiceLocator\";\nimport { Action } from \"../lib/Action\";\nimport { Store } from \"../Store\";\nimport { ActionNames } from \"./ActionNames\";\nimport { v4 as uuid } from \"uuid\";\n\nexport class KontokorrentCreationFailed implements Action {\n    readonly type = ActionNames.KontokorrentCreationFailed;\n    constructor(public exists: boolean) {\n\n    }\n}\n\nexport class KontokorrentCreating implements Action {\n    readonly type = ActionNames.KontokorrentCreating;\n    constructor() {\n\n    }\n}\n\nexport class KontokorrentCreated implements Action {\n    readonly type = ActionNames.KontokorrentCreated;\n    constructor(public kontokorrent: KontokorrentInfo) {\n\n    }\n}\n\nexport class KontokorrentHinzufuegenFailed implements Action {\n    readonly type = ActionNames.KontokorrentHinzufuegenFailed;\n    constructor(public notFound: boolean) {\n\n    }\n}\n\nexport class KontokorrentHinzufuegen implements Action {\n    readonly type = ActionNames.KontokorrentHinzufuegen;\n    constructor() {\n\n    }\n}\n\nexport class KontokorrentHinzufuegenSuccess implements Action {\n    readonly type = ActionNames.KontokorrentHinzufuegenSuccess;\n    constructor(public kontokorrents: KontokorrentInfo[]) {\n\n    }\n}\n\nexport class LoginPageGeoeffnet implements Action {\n    readonly type = ActionNames.LoginPageGeoeffnet;\n    constructor() {\n\n    }\n}\n\nexport class NichtGefundenPageGeoeffnet implements Action {\n    readonly type = ActionNames.NichtGefundenPageGeoeffnet;\n    constructor() {\n\n    }\n}\n\nexport type KontokorrentHinzufuegenActions = KontokorrentCreationFailed\n    | KontokorrentCreating\n    | KontokorrentCreated\n    | KontokorrentHinzufuegenFailed\n    | KontokorrentHinzufuegen\n    | KontokorrentHinzufuegenSuccess\n    | LoginPageGeoeffnet\n    | NichtGefundenPageGeoeffnet;\n\nexport class KontokorrentHinzufuegenActionCreator {\n\n    constructor(private store: Store,\n        private apiClient: ApiClient,\n        private db: KontokorrentDatabase) {\n\n    }\n\n    loginPageGeoeffnet() {\n        this.store.dispatch(new LoginPageGeoeffnet());\n    }\n\n    nichtGefundenPageGeoeffnet() {\n        this.store.dispatch(new NichtGefundenPageGeoeffnet());\n    }\n\n    async kontokorrentErstellen(id: string, name: string, oeffentlicherName: string, personen: string[]) {\n        let request: NeuerKontokorrentRequest = {\n            name,\n            id,\n            oeffentlicherName,\n            personen: personen.map(v => { return { name: v, id: uuid() } })\n        };\n        this.store.dispatch(new KontokorrentCreating());\n        let res = await this.apiClient.neuerKontokorrent(request);\n        if (!res.success) {\n            this.store.dispatch(new KontokorrentCreationFailed(res.exists));\n        }\n        else {\n            await this.db.addKontokorrent({\n                id: id,\n                name: name,\n                personen: request.personen,\n                oeffentlicherName: oeffentlicherName\n            });\n            this.store.dispatch(new KontokorrentCreated({\n                id: id,\n                name: name,\n                personen: request.personen,\n                oeffentlicherName: oeffentlicherName\n            }));\n            return true;\n        }\n        return false;\n    }\n\n    async kontokorrentHinzufuegen(oeffentlicherName: string) {\n        let kk = await this.db.getPerOeffentlichName(oeffentlicherName);\n        if (null != kk) {\n            return kk.id;\n        }\n        this.store.dispatch(new KontokorrentHinzufuegen());\n        try {\n            let res = await this.apiClient.kontokorrentHinzufuegen(oeffentlicherName, null);\n            if (null == res) {\n                this.store.dispatch(new KontokorrentHinzufuegenFailed(true));\n            }\n            else {\n                let newIds = await this.db.setKontokorrents(res.map(v => {\n                    return {\n                        id: v.id,\n                        name: v.name,\n                        personen: v.personen,\n                        oeffentlicherName: v.oeffentlicherName\n                    };\n                }));\n                this.store.dispatch(new KontokorrentHinzufuegenSuccess(res));\n                return newIds[0];\n            }\n        }\n        catch (err) {\n            this.store.dispatch(new KontokorrentHinzufuegenFailed(false));\n        }\n        return false;\n    }\n}\n\nexport function kontokorrentHinzufuegenActionCreatorFactory(serviceLocator: ServiceLocator) {\n    return serviceLocator.get(\"KontokorrentHinzufuegenActionCreator\",\n        serviceLocator => new KontokorrentHinzufuegenActionCreator(\n            serviceLocator.store,\n            serviceLocator.apiClient,\n            serviceLocator.db\n        ));\n}"],"names":["KontokorrentNichtGefunden","HTMLElement","constructor","super","rendered","addServices","serviceLocator","this","store","routingActionCreator","kontokorrentHinzufuegenActionCreator","connectedCallback","innerHTML","oeffentlicherKontokorrentLabel","querySelector","hinzufuegenBtn","notFoundError","processing","appBar","AppBar","searchParams","URLSearchParams","window","location","search","has","oeffentlicherName","get","toLowerCase","innerText","addEventListener","async","navigateKontokorrentById","e","detail","hinzufuegenClickListener","hinzufuegen","subscription","subscribe","state","applyStoreState","nichtGefundenPageGeoeffnet","id","kontokorrentHinzufuegen","style","display","kontokorrents","hinzufuegenFailed","kontokorrentNotFound","account","accountCreating","disconnectedCallback","removeEventListener","customElements","define","KontokorrentCreationFailed","exists","type","KontokorrentCreating","KontokorrentCreated","kontokorrent","KontokorrentHinzufuegenFailed","notFound","KontokorrentHinzufuegen","KontokorrentHinzufuegenSuccess","LoginPageGeoeffnet","NichtGefundenPageGeoeffnet","KontokorrentHinzufuegenActionCreator","apiClient","db","loginPageGeoeffnet","dispatch","name","personen","request","map","v","res","neuerKontokorrent","success","addKontokorrent","kk","getPerOeffentlichName","newIds","setKontokorrents","err","kontokorrentHinzufuegenActionCreatorFactory"],"sourceRoot":""}